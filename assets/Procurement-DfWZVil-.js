import{R as e,P as c,u as K,n as Q,r as m,C as G}from"./index-CZbhyFiD.js";import{a as B}from"./index-xsH4HHeE.js";import{C as X}from"./CFormTextarea-Dmr0ihgI.js";import{C as z}from"./CFormSelect-D4tEM1WW.js";import{a as O}from"./CFormInput-Di6goj5o.js";import{c as E,a as C,b as l}from"./CRow-DAWJ6kQb.js";import{c as J,d as W,e as Y,g as Z,h as ee,j as I,k as R,l as te,m as w}from"./CTable-CR8nuKb2.js";import{C as ae,a as re}from"./CCardBody-D6vwvdO3.js";import{C as ne,a as le,b as se,c as oe,d as ce}from"./DefaultLayout-BP7cXl45.js";import"./CCloseButton-BPwTVHYG.js";import"./CForm-BM-D2erR.js";import"./index.esm-DQ49KZfQ.js";import"./CCardHeader-x-t8Qtni.js";import"./CAlert-D5Ki0zoC.js";import"./cil-user-Ddrdy7PS.js";import"./index-CoDMBhIy.js";const u=({label:s,type:b="text",name:p,value:n,onChange:i,placeholder:S="",required:y=!1,options:P=[],rows:D=3,disabled:f=!1})=>b==="textarea"?e.createElement(X,{label:s,name:p,value:n,onChange:i,placeholder:S,required:y,rows:D,disabled:f,"aria-label":s}):b==="select"?e.createElement(z,{label:s,name:p,value:n,onChange:i,required:y,disabled:f,"aria-label":s},e.createElement("option",{value:""},"Select ",s),P.map((g,A)=>e.createElement("option",{key:A,value:g},g))):e.createElement(O,{type:b,name:p,value:n,onChange:i,placeholder:S,label:s,required:y,disabled:f,"aria-label":s});u.propTypes={label:c.string.isRequired,type:c.oneOf(["text","number","date","textarea","select"]),name:c.string.isRequired,value:c.oneOfType([c.string,c.number]).isRequired,onChange:c.func.isRequired,placeholder:c.string,required:c.bool,options:c.arrayOf(c.string),rows:c.number,disabled:c.bool};const me="https://backend-log2.axleshift.com",M=`${me}/api/v1/procurement`,ue=()=>{const{accessToken:s,user:b}=K(),p=Q(),[n,i]=m.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[S,y]=m.useState([]),[P,D]=m.useState(!1),[f,g]=m.useState(!1),[A,F]=m.useState([]),[ie,de]=m.useState(!1),[pe,Ee]=m.useState(null),[T,_]=m.useState(""),[N,j]=m.useState("All"),H=A.filter(t=>{const r=t.title.toLowerCase().includes(T.toLowerCase())||t.department.toLowerCase().includes(T.toLowerCase())||t.status.toLowerCase().includes(T.toLowerCase()),a=N==="All"||t.status.toLowerCase()===N.toLowerCase();return r&&a});m.useEffect(()=>{(async()=>{if(s)try{const r=await B.get(M,{headers:{Authorization:`Bearer ${s}`}});F(r.data)}catch(r){console.error("Error fetching procurements:",r)}})()},[s]);const h=t=>{const{name:r,value:a}=t.target;i(o=>({...o,[r]:a}))},q=(t,r)=>{const{name:a,value:o}=r.target,d=[...n.products];d[t]={...d[t],[a]:a==="quantity"||a==="unitPrice"?o===""?"":parseFloat(o):o};const x=d.reduce((v,L)=>v+(L.unitPrice||0)*(L.quantity||0),0);i(v=>({...v,products:d,estimatedCost:parseFloat(x.toFixed(2))}))},U=()=>{i(t=>({...t,products:[...t.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},$=t=>{const r=n.products.filter((a,o)=>o!==t);i(a=>({...a,products:r,estimatedCost:r.reduce((o,d)=>o+(d.unitPrice*d.quantity||0),0)}))},V=async t=>{var r,a;if(t.preventDefault(),!P){D(!0);try{if(!s)throw new Error("Authentication error. Please log in again.");const o={Authorization:`Bearer ${s}`,"Content-Type":"application/json"},d={...n,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null},x=await B.post(M,d,{headers:o});F(v=>[...v,x.data]),i({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),g(!1),k("âœ… Procurement Request created successfully!","success")}catch(o){k(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{D(!1)}}},k=(t,r)=>{y(a=>[...a,{id:Date.now(),message:t,color:r}]),setTimeout(()=>y(a=>a.slice(1)),5e3)};return e.createElement(e.Fragment,null,e.createElement(E,{color:"primary",onClick:()=>g(!0),className:"mb-3"},"+ Create Procurement"),e.createElement(J,{visible:f,onClose:()=>g(!1),size:"lg"},e.createElement(W,null,"Create Procurement Request"),e.createElement(Y,null,e.createElement("form",{onSubmit:V},e.createElement(C,{className:"mb-3"},e.createElement(l,{md:6},e.createElement(u,{label:"Title",name:"title",value:n.title,onChange:h,required:!0})),e.createElement(l,{md:6},e.createElement(u,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:h,required:!0}))),e.createElement(u,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:h,required:!0,rows:3}),e.createElement(C,{className:"mb-3"},e.createElement(l,{md:6},e.createElement(u,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:h})),e.createElement(l,{md:6},e.createElement(u,{label:"Department",type:"select",name:"department",value:n.department,onChange:h,options:["HR","Finance","Logistics","IT","Procurement"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((t,r)=>e.createElement(C,{key:r,className:"mb-2"},e.createElement(l,{md:2},e.createElement(u,{label:"Product Name",name:"name",value:t.name,onChange:a=>q(r,a),required:!0})),e.createElement(l,{md:2},e.createElement(u,{label:"Quantity",type:"number",name:"quantity",value:t.quantity,min:"0",onChange:a=>q(r,a),required:!0})),e.createElement(l,{md:2},e.createElement(u,{label:"Unit",type:"select",name:"unit",value:t.unit,onChange:a=>q(r,a),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(l,{md:2},e.createElement(u,{label:"Unit Price",type:"number",name:"unitPrice",value:t.unitPrice,min:"0",onChange:a=>q(r,a),required:!0})),e.createElement(l,{md:2},e.createElement(E,{color:"danger",onClick:()=>$(r)},"Remove")))),e.createElement(C,{className:"mt-3"},e.createElement(l,{md:6},e.createElement(E,{color:"primary",onClick:U},"Add Product"))),e.createElement(C,{className:"mt-3 text-end"},e.createElement(l,null,e.createElement("h5",null,"Estimated Cost: ",n.estimatedCost.toFixed(2)))),e.createElement(C,{className:"mt-4"},e.createElement(l,{md:12,className:"text-center"},e.createElement(E,{color:"success",type:"submit",disabled:P},P?e.createElement(G,{size:"sm"}):"Submit")))))),e.createElement(ae,null,e.createElement(re,null,e.createElement("h5",null,"Procurement Requests"),e.createElement(C,{className:"mb-3"},e.createElement(l,{md:6},e.createElement(O,{type:"text",placeholder:"Search by title, department or status",value:T,onChange:t=>_(t.target.value)})),e.createElement(l,{md:3},e.createElement(z,{value:N,onChange:t=>j(t.target.value)},e.createElement("option",{value:"All"},"All Statuses"),e.createElement("option",{value:"Pending"},"Pending"),e.createElement("option",{value:"Approved"},"Approved"),e.createElement("option",{value:"Rejected"},"Rejected")))),e.createElement(Z,{responsive:!0},e.createElement(ee,null,e.createElement(I,null,e.createElement(R,null,"Title"),e.createElement(R,null,"Department"),e.createElement(R,null,"Status"),e.createElement(R,null,"Actions"))),e.createElement(te,null,H.map(t=>e.createElement(I,{key:t._id},e.createElement(w,null,t.title),e.createElement(w,null,t.department),e.createElement(w,null,e.createElement(ne,{color:t.status==="Approved"?"success":t.status==="Rejected"?"danger":"warning"},t.status)),e.createElement(w,{className:"text-center"},e.createElement(E,{color:"info",size:"sm",onClick:()=>p(`/procurement/${t._id}`)},"View")," ",t.status==="Approved"&&e.createElement(e.Fragment,null,e.createElement(E,{color:"primary",size:"sm",onClick:()=>p(`/rfq/create/${t._id}`)},"Create RFQ")," ",e.createElement(E,{color:"success",size:"sm",onClick:()=>p("/procurement/po-payments")},"Create PO"))))))))),e.createElement(le,{placement:"top-end"},S.map(t=>e.createElement(se,{key:t.id,autohide:!0,visible:!0,color:t.color},e.createElement(oe,{closeButton:!0},t.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(ce,null,t.message)))))},xe=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(ue,null));export{xe as default};
