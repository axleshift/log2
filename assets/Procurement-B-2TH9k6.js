import{r as u,_ as Z,j as Q,a as F,c as O,b as y,P as r,F as le,R as t,w as ue,A as de,k as me,C as fe}from"./index-C2RBCqsm.js";import{a as A}from"./index-DW_MHI2K.js";import{p as X,u as pe,q as ve}from"./CNavItem-BXq820in.js";import{u as he}from"./CCloseButton-CK9TUEEK.js";import{C as ge}from"./CFormControlWrapper-Cc2_n4DS.js";import{C as z,a as R}from"./CRow-ByaeGxm2.js";import{C as T}from"./CFormInput-CwG_Yb0d.js";import{C as ee}from"./CFormTextarea-ohoJ3pld.js";import{b as B}from"./CContainer-DysCb-Pj.js";import{C as be}from"./CForm-CMVnlzCC.js";import{C as ye,a as Ee,b as Ce,c as Re}from"./CToaster-BXpNipjg.js";var $=u.forwardRef(function(e,n){var o,c=e.className,l=e.id,m=e.invalid,v=e.label,s=e.reverse,i=e.size,a=e.type,h=a===void 0?"checkbox":a,g=e.valid,C=Z(e,["className","id","invalid","label","reverse","size","type","valid"]);return Q("div",{className:O("form-check form-switch",(o={"form-check-reverse":s},o["form-switch-".concat(i)]=i,o["is-invalid"]=m,o["is-valid"]=g,o),c),children:[F("input",{...y({type:h,className:O("form-check-input",{"is-invalid":m,"is-valid":g}),id:l},C,{ref:n})}),v&&F(ge,{...y({customClassName:"form-check-label"},l&&{htmlFor:l}),children:v})]})});$.propTypes={className:r.string,id:r.string,invalid:r.bool,label:r.oneOfType([r.string,r.node]),reverse:r.bool,size:r.oneOf(["lg","xl"]),type:r.oneOf(["checkbox","radio"]),valid:r.bool};$.displayName="CFormSwitch";var Pe=function(e){if(!e)return 0;var n=window.getComputedStyle(e),o=n.transitionDuration,c=n.transitionDelay,l=Number.parseFloat(o),m=Number.parseFloat(c);return!l&&!m?0:(o=o.split(",")[0],c=c.split(",")[0],(Number.parseFloat(o)+Number.parseFloat(c))*1e3)},Y=function(e){typeof e=="function"&&e()},qe=function(e){e.dispatchEvent(new Event("transitionend"))},Ne=function(e,n,o){if(o===void 0&&(o=!0),!o){Y(e);return}var c=5,l=Pe(n)+c,m=!1,v=function(s){var i=s.target;i===n&&(m=!0,n.removeEventListener("transitionend",v),Y(e))};n.addEventListener("transitionend",v),setTimeout(function(){m||qe(n)},l)},Te=function(e,n){switch(e){case"right":return X(n)?"left":"right";case"left":return X(n)?"right":"left";default:return e}},j=u.forwardRef(function(e,n){var o=e.children,c=e.animation,l=c===void 0?!0:c,m=e.className,v=e.container,s=e.content,i=e.delay,a=i===void 0?0:i,h=e.fallbackPlacements,g=h===void 0?["top","right","bottom","left"]:h,C=e.offset,f=C===void 0?[0,6]:C,d=e.onHide,p=e.onShow,b=e.placement,k=b===void 0?"top":b,P=e.popperConfig,D=e.trigger,E=D===void 0?["hover","focus"]:D,I=e.visible,ne=Z(e,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),q=u.useRef(null),N=u.useRef(null),oe=he(n,q),U="tooltip".concat(u.useId()),_=u.useState(!1),S=_[0],M=_[1],G=u.useState(I),w=G[0],J=G[1],L=pe(),ae=L.initPopper,ie=L.destroyPopper,se=L.updatePopper,K=typeof a=="number"?{show:a,hide:a}:a,W={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:g}},{name:"offset",options:{offset:f}}],placement:Te(k,N.current)},ce=y(y({},W),typeof P=="function"?P(W):P);u.useEffect(function(){if(I){x();return}V()},[I]),u.useEffect(function(){if(S&&N.current&&q.current){ae(N.current,q.current,ce),setTimeout(function(){J(!0)},K.show);return}!S&&N.current&&q.current&&ie()},[S]),u.useEffect(function(){!w&&N.current&&q.current&&Ne(function(){M(!1)},q.current)},[w]);var x=function(){M(!0),p&&p()},V=function(){setTimeout(function(){J(!1),d&&d()},K.hide)};return u.useEffect(function(){se()},[s]),Q(le,{children:[t.cloneElement(o,y(y(y(y(y({},w&&{"aria-describedby":U}),{ref:N}),(E==="click"||E.includes("click"))&&{onClick:function(){return w?V():x()}}),(E==="focus"||E.includes("focus"))&&{onFocus:function(){return x()},onBlur:function(){return V()}}),(E==="hover"||E.includes("hover"))&&{onMouseEnter:function(){return x()},onMouseLeave:function(){return V()}})),F(ve,{container:v,portal:!0,children:S&&Q("div",{...y({className:O("tooltip","bs-tooltip-auto",{fade:l,show:w},m),id:U,ref:oe,role:"tooltip"},ne),children:[F("div",{className:"tooltip-arrow"}),F("div",{className:"tooltip-inner",children:s})]})})]})});j.propTypes={animation:r.bool,children:r.node,container:r.any,content:r.oneOfType([r.string,r.node]),delay:r.oneOfType([r.number,r.shape({show:r.number.isRequired,hide:r.number.isRequired})]),fallbackPlacements:de,offset:r.any,onHide:r.func,onShow:r.func,placement:r.oneOf(["auto","top","right","bottom","left"]),popperConfig:r.oneOfType([r.func,r.object]),trigger:ue,visible:r.bool};j.displayName="CTooltip";const te=({id:e,label:n,checked:o,onChange:c,description:l=""})=>t.createElement("div",{className:"mb-3"},t.createElement(j,{content:l,placement:"right"},t.createElement($,{id:e,label:n,checked:o,onChange:c})),t.createElement("small",{className:"text-muted"},l));te.propTypes={id:r.string.isRequired,label:r.string.isRequired,checked:r.bool.isRequired,onChange:r.func.isRequired,description:r.string};const re=({rfqData:e,setRfqData:n})=>{const[o,c]=u.useState(!0),l=(s,i,a)=>{i==="quantity"&&(a=parseFloat(a)||0),n(h=>({...h,products:h.products.map((g,C)=>C===s?{...g,[i]:a}:g)}))},m=()=>{e.products.length>=10||n(s=>({...s,products:[...s.products,{name:"",quantity:1,specs:""}]}))},v=s=>{n(i=>({...i,products:i.products.filter((a,h)=>h!==s)}))};return t.createElement(t.Fragment,null,t.createElement("h5",{className:"mt-3"},"RFQ Details"),e.products.map((s,i)=>t.createElement(z,{key:i,className:"mb-3"},t.createElement(R,{md:4},t.createElement(T,{type:"text",placeholder:"Product Name",value:s.name,onChange:a=>l(i,"name",a.target.value),label:"Product Name",required:!0})),t.createElement(R,{md:4},t.createElement(ee,{placeholder:"Enter specifications...",value:s.specs,onChange:a=>l(i,"specs",a.target.value),label:"Specifications",rows:3})),t.createElement(R,{md:3},t.createElement(T,{type:"number",placeholder:"Quantity",value:s.quantity||"",onChange:a=>l(i,"quantity",a.target.value),label:"Quantity",required:!0})),t.createElement(R,{md:1,className:"d-flex align-items-end"},t.createElement(B,{color:"danger",size:"sm",onClick:()=>v(i)},"âœ•")))),t.createElement(B,{color:"primary",variant:"outline",size:"sm",onClick:m,disabled:e.products.length>=10},"+ Add Product"))};re.propTypes={rfqData:r.shape({products:r.arrayOf(r.shape({name:r.string.isRequired,quantity:r.number.isRequired,specs:r.string})).isRequired}).isRequired,setRfqData:r.func.isRequired};const H="https://backend-log2.axleshift.com",we=`${H}/api/v1/procurement`,Fe=`${H}/api/v1/rfq`,ke=`${H}/api/v1/vendor`,De=()=>{const{accessToken:e}=me(),[n,o]=u.useState({title:"",description:"",procurementDate:"",deliveryDate:"",status:"Pending",rfqRequired:!1,selectedVendorId:""}),[c,l]=u.useState({products:[],invitedVendors:[]}),[m,v]=u.useState([]),[s,i]=u.useState(!1);u.useEffect(()=>{e&&(async()=>{try{const d=await A.get(ke,{headers:{Authorization:`Bearer ${e}`}})}catch(d){console.error("âŒ Error fetching vendors:",d),g("ðŸš¨ Failed to load vendors.","danger")}})()},[e]);const a=f=>{const{name:d,value:p}=f.target;o(b=>({...b,[d]:p}))},h=()=>{o(f=>({...f,rfqRequired:!f.rfqRequired})),n.rfqRequired||l({products:[],invitedVendors:[]})},g=(f,d)=>{v(p=>[...p,{id:Date.now(),message:f,color:d}]),setTimeout(()=>v(p=>p.slice(1)),5e3)},C=async f=>{var d,p;if(f.preventDefault(),!s){i(!0);try{if(!e)throw new Error("Authentication error. Please log in again.");const b={Authorization:`Bearer ${e}`,"Content-Type":"application/json"},k={...n,products:n.rfqRequired?c.products:[],invitedVendors:n.rfqRequired?c.invitedVendors:[]};console.log("ðŸ” Submitting Procurement:",k);const P=await A.post(we,k,{headers:b});console.log("âœ… Procurement Created:",P.data);const D=P.data.rfqId;if(n.rfqRequired&&c.invitedVendors.length>0){const E={vendors:c.invitedVendors};console.log("ðŸ” Inviting Vendors to RFQ:",E),await A.post(`${Fe}/${D}/invite`,E,{headers:b}),console.log("âœ… Vendors Invited to RFQ")}o({title:"",description:"",procurementDate:"",deliveryDate:"",status:"Pending",rfqRequired:!1,selectedVendorId:""}),l({products:[],invitedVendors:[]}),g("ðŸŽ‰ Procurement successfully created and vendors invited!","success")}catch(b){console.error("âŒ Error creating procurement:",b.response||b),g(((p=(d=b.response)==null?void 0:d.data)==null?void 0:p.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{i(!1)}}};return t.createElement(be,{onSubmit:C},t.createElement(z,{className:"mb-3"},t.createElement(R,{md:6},t.createElement(T,{type:"text",name:"title",value:n.title,onChange:a,placeholder:"Title",label:"Title",required:!0})),t.createElement(R,{md:6},t.createElement(T,{type:"date",name:"procurementDate",value:n.procurementDate,onChange:a,label:"Procurement Date",required:!0}))),t.createElement(ee,{name:"description",value:n.description,onChange:a,placeholder:"Description",label:"Description",required:!0,rows:3}),t.createElement(z,{className:"mb-3"},t.createElement(R,{md:6},t.createElement(T,{type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:a,label:"Expected Delivery Date"})),t.createElement(R,{md:6},t.createElement(T,{type:"text",name:"status",value:"Pending",label:"Status",disabled:!0}))),t.createElement(te,{id:"rfqRequired",label:"Require RFQ (Bidding Process)",checked:n.rfqRequired,onChange:h,description:"Enable this option to require a Request for Quotation (RFQ) before proceeding with procurement."}),n.rfqRequired&&t.createElement(re,{rfqData:c,setRfqData:l}),t.createElement(B,{color:"success",type:"submit",disabled:s},s?t.createElement(fe,{size:"sm"}):"Create Procurement"),t.createElement(ye,{placement:"top-end"},m.map(({id:f,message:d,color:p})=>t.createElement(Ee,{key:f,color:p,autohide:!0,visible:!0},t.createElement(Ce,{closeButton:!0},"Notification"),t.createElement(Re,null,d)))))},je=()=>t.createElement("div",{className:"p-6"},t.createElement("h1",{className:"text-2xl font-bold mb-4"},"Procurement Process"),t.createElement(De,null));export{je as default};
