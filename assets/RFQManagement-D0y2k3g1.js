import{r,R as e,C as N,i as B,k as $}from"./index-CBDYk9Ao.js";import{a as A}from"./index-C88pvD_q.js";import{a as D,b as d}from"./CContainer-BVTxmlXV.js";import{C as M}from"./CAlert-B8vxpHEG.js";import{C as _,a as k,b as g,c as i,d as w,e as o}from"./CTable-Di3XAasM.js";import{C as T,a as Q}from"./CCardBody-E11mcyvL.js";import{C as H}from"./DefaultLayout-DGyvqXFF.js";import{C as R,a as S,b as P,c as F}from"./CModalHeader-BKFu_ZhO.js";import{C as U,a as z}from"./CRow-C6uQnZEq.js";import{C as J}from"./CCardHeader-BshgPxRz.js";import"./CCloseButton-DIWbhS5b.js";import"./index.esm-NRZ6HBye.js";import"./CNavItem-BCds_oRM.js";import"./cil-user-Ddrdy7PS.js";import"./index-Bor_YxxL.js";const V="https://backend-log2.axleshift.com/api/v1/rfq",j=()=>{const[a,c]=r.useState([]),[u,E]=r.useState(!0),[p,t]=r.useState(null);return r.useEffect(()=>{(async()=>{var m,f;try{const s=await A.get(V);console.log("Full API Response:",s.data),Array.isArray(s.data)?c(s.data):Array.isArray(s.data.rfqs)?c(s.data.rfqs):(c([]),t("Unexpected API response format"))}catch(s){console.error("Error fetching RFQs:",s),t(((f=(m=s.response)==null?void 0:m.data)==null?void 0:f.message)||"Failed to fetch RFQs")}finally{E(!1)}})()},[]),e.createElement(D,{className:"mt-4"},e.createElement("h2",{className:"mb-4"},"RFQ List"),u&&e.createElement(N,{color:"primary"}),p&&e.createElement(M,{color:"danger"},p),!u&&!p&&e.createElement(_,{hover:!0,responsive:!0,striped:!0,borderColor:"secondary"},e.createElement(k,{color:"dark"},e.createElement(g,null,e.createElement(i,null,"RFQ ID"),e.createElement(i,null,"Procurement"),e.createElement(i,null,"Deadline"),e.createElement(i,null,"Status"),e.createElement(i,null,"Actions"))),e.createElement(w,null,a.length>0?a.map(n=>{var m;return e.createElement(g,{key:n._id},e.createElement(o,null,n._id),e.createElement(o,null,((m=n.procurementId)==null?void 0:m.title)||"N/A"),e.createElement(o,null,n.deadline?new Date(n.deadline).toLocaleDateString():"No Deadline"),e.createElement(o,null,n.status||"Pending"),e.createElement(o,null,e.createElement(d,{color:"primary",href:`/rfq/${n._id}`,size:"sm"},"View")))}):e.createElement(g,null,e.createElement(o,{colSpan:"5",className:"text-center"},"No RFQs found")))))},x="https://backend-log2.axleshift.com/api/v1/procurement",K=()=>{const a=B(),{user:c}=$(),[u,E]=r.useState([]),[p,t]=r.useState(!0),[n,m]=r.useState(!1),[f,s]=r.useState(null),[I,y]=r.useState(!1),[v,q]=r.useState(null);r.useEffect(()=>{(async()=>{try{const C=await A.get(x);if(console.log("Procurements Data:",C.data),E(C.data),c){const h=C.data.find(L=>L.status==="Approved"&&L.createdBy===c._id),b=JSON.parse(sessionStorage.getItem("seenApprovals")||"{}");h&&!b[h._id]&&(s(h),m(!0),b[h._id]=!0,sessionStorage.setItem("seenApprovals",JSON.stringify(b)))}}catch(C){console.error("Error fetching procurements:",C)}finally{t(!1)}})()},[c]);const O=async()=>{if(v)try{await A.delete(`${x}/${v}`),E(u.filter(l=>l._id!==v)),y(!1)}catch(l){console.error("Error deleting procurement:",l),alert("Failed to delete procurement.")}};return e.createElement(T,null,e.createElement(Q,null,e.createElement("h5",null,"Procurement Requests"),e.createElement(_,{responsive:!0},e.createElement(k,null,e.createElement(g,null,e.createElement(i,null,"Title"),e.createElement(i,null,"Department"),e.createElement(i,null,"Status"),e.createElement(i,null,"Actions"))),e.createElement(w,null,u.map(l=>e.createElement(g,{key:l._id},e.createElement(o,null,l.title),e.createElement(o,null,l.department),e.createElement(o,null,e.createElement(H,{color:l.status==="Approved"?"success":"warning"},l.status)),e.createElement(o,{className:"text-center"},e.createElement(d,{color:"info",size:"sm",onClick:()=>a(`/procurement/${l._id}`)},"View")," ",e.createElement(d,{color:"danger",size:"sm",onClick:()=>{q(l._id),y(!0)}},"Delete"))))))),e.createElement(R,{visible:n,onClose:()=>m(!1)},e.createElement(S,null,"Procurement Approved"),e.createElement(P,null,"Your procurement request ",e.createElement("strong",null,f==null?void 0:f.title)," has been approved!"),e.createElement(F,null,e.createElement(d,{color:"primary",onClick:()=>m(!1)},"OK"))),e.createElement(R,{visible:I,onClose:()=>y(!1)},e.createElement(S,null,"Confirm Deletion"),e.createElement(P,null,"Are you sure you want to delete this procurement request?"),e.createElement(F,null,e.createElement(d,{color:"secondary",onClick:()=>y(!1)},"Cancel"),e.createElement(d,{color:"danger",onClick:O},"Delete"))))},ie=()=>{const[a,c]=r.useState("ProcurementList"),[u,E]=r.useState(!1),p=t=>{c(t),E(!0),setTimeout(()=>E(!1),1e3)};return e.createElement(D,null,e.createElement(U,{className:"mb-3"},e.createElement(z,null,e.createElement(T,null,e.createElement(J,{className:"d-flex justify-content-between align-items-center"},e.createElement("div",null,e.createElement(d,{color:a==="ProcurementList"?"primary":"secondary",onClick:()=>p("ProcurementList"),className:"ms-2",active:a==="ProcurementList",style:{transition:"all 0.3s ease",boxShadow:a==="ProcurementList"?"0 4px 6px rgba(0, 0, 0, 0.1)":"none"},onMouseOver:t=>t.target.style.transform="scale(1.05)",onMouseOut:t=>t.target.style.transform="scale(1)"},"Procurement List"),e.createElement(d,{color:a==="rfqList"?"primary":"secondary",onClick:()=>p("rfqList"),className:"ms-2",active:a==="rfqList",style:{transition:"all 0.3s ease",boxShadow:a==="rfqList"?"0 4px 6px rgba(0, 0, 0, 0.1)":"none"},onMouseOver:t=>t.target.style.transform="scale(1.05)",onMouseOut:t=>t.target.style.transform="scale(1)"},"RFQ List")),e.createElement("div",null,u&&e.createElement(N,{color:"primary"}))),e.createElement(Q,null,u?e.createElement(M,{color:"info"},"Loading data..."):e.createElement(e.Fragment,null,a==="ProcurementList"&&e.createElement(K,null),a==="rfqList"&&e.createElement(j,null)))))))};export{ie as default};
