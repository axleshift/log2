import{r as s,R as e,P as n,y as D,C as M}from"./index-orousf3n.js";import{a as k}from"./index-C88pvD_q.js";import{C as N,a as $,b as A,c as B}from"./CModalHeader-14qb34Th.js";import{C as U}from"./CModalTitle-DSthE3mA.js";import{C as x}from"./CForm-B4HzZd3e.js";import{C as L}from"./CFormControlWrapper-e0tBTbt4.js";import{C as I}from"./CFormInput-BoNg9utG.js";import{b as S}from"./CContainer-CTVIPSgE.js";import{C as T}from"./CAlert-BYRxqHeE.js";import{C as H,a as z}from"./CCardBody-BspyXba7.js";import{C as O}from"./CCardHeader-Dd5mLpOh.js";import{C as Y,a as j,b as F,c as Q,d as G,e as y}from"./CTable-JfxCDoVk.js";import"./CCloseButton-a1ZYsKWT.js";import"./CNavItem-BNwEcOtj.js";const q=({rfq:l,vendorId:o,onClose:d,onSuccess:b})=>{var f;const[u,E]=s.useState(l.products.map(t=>({product:t.name,pricePerUnit:"",deliveryTime:""}))),[i,g]=s.useState(!1),[p,m]=s.useState(null),h=(t,r,a)=>{const c=[...u];c[t][r]=a,E(c)},R=async()=>{var t,r;g(!0),m(null);try{const a=await k.post(`https://backend-log2.axleshift.com/api/v1/rfq/${l._id}/submit-quote`,{vendorId:o,quoteDetails:u});b(a.data),d()}catch(a){m(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to submit quote.")}finally{g(!1)}};return e.createElement(N,{visible:!0,onClose:d,backdrop:"static"},e.createElement($,null,e.createElement(U,null,"Submit Quote for ",(f=l.procurementId)==null?void 0:f.title)),e.createElement(A,null,e.createElement(x,null,u.map((t,r)=>e.createElement("div",{key:r,className:"mb-3"},e.createElement(L,null,t.product),e.createElement(I,{type:"number",placeholder:"Price Per Unit",value:t.pricePerUnit,onChange:a=>h(r,"pricePerUnit",a.target.value)}),e.createElement(I,{type:"text",placeholder:"Delivery Time",value:t.deliveryTime,onChange:a=>h(r,"deliveryTime",a.target.value)}))),p&&e.createElement("p",{style:{color:"red"}},p))),e.createElement(B,null,e.createElement(S,{color:"secondary",onClick:d,disabled:i},"Cancel"),e.createElement(S,{color:"primary",onClick:R,disabled:i},i?"Submitting...":"Submit Quote")))};q.propTypes={rfq:n.shape({_id:n.string.isRequired,products:n.arrayOf(n.shape({name:n.string.isRequired})).isRequired,procurementId:n.shape({title:n.string})}).isRequired,vendorId:n.string.isRequired,onClose:n.func.isRequired,onSuccess:n.func.isRequired};const J="https://backend-log2.axleshift.com",P=`${J}/api/v1/rfq`,de=()=>{var R,f;const{id:l}=D(),[o,d]=s.useState(null),[b,u]=s.useState(!0),[E,i]=s.useState(null),[g,p]=s.useState(!1),[m,h]=s.useState(null);return s.useEffect(()=>{if(console.log("Extracted RFQ ID:",l),!l){i("Invalid RFQ ID."),u(!1);return}(async()=>{var r,a;try{console.log(`Fetching RFQ from: ${P}/${l}`);const c=localStorage.getItem("token"),_=localStorage.getItem("vendorId"),w=c?{Authorization:`Bearer ${c}`}:{},C=await k.get(`${P}/${l}`,{headers:w});if(console.log("RFQ Response Data:",C.data),!C.data){console.warn("No RFQ found in response"),i("RFQ not found.");return}d(C.data),console.log("Invited Vendors:",C.data.invitedVendors);const v=C.data.invitedVendors.find(V=>V._id.toString()===_);v?(h(v._id),console.log("Vendor is invited:",v._id)):(console.warn("Vendor is not invited to this RFQ."),i("You are not authorized to view this RFQ."))}catch(c){console.error("Error fetching RFQ:",c.response),i(((a=(r=c.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch RFQ details.")}finally{u(!1)}})()},[l]),b?e.createElement(M,{color:"primary"}):E?e.createElement(T,{color:"danger"},E):o?e.createElement(H,null,e.createElement(O,null,e.createElement("h5",null,"RFQ Details - ",((R=o.procurementId)==null?void 0:R.title)||"N/A")),e.createElement(z,null,e.createElement(Y,{hover:!0,responsive:!0},e.createElement(j,null,e.createElement(F,null,e.createElement(Q,null,"Product Name"),e.createElement(Q,null,"Specifications"),e.createElement(Q,null,"Quantity"))),e.createElement(G,null,((f=o==null?void 0:o.products)==null?void 0:f.length)>0?o.products.map((t,r)=>e.createElement(F,{key:r},e.createElement(y,null,t.name||"No name"),e.createElement(y,null,t.specs||"No specs"),e.createElement(y,null,t.quantity||"N/A"))):e.createElement(F,null,e.createElement(y,{colSpan:"3"},"No products listed")))),o.status==="Open"&&m&&e.createElement(S,{color:"primary",onClick:()=>p(!0)},"Submit Quote")),g&&m&&e.createElement(q,{rfqId:o._id,vendorId:m,products:o.products,onClose:()=>p(!1),onSuccess:t=>d(t)})):e.createElement(T,{color:"warning"},"RFQ not found.")};export{de as default};
