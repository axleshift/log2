import{r as a,_ as k,R as g,a as T,c as A,P as t,b as le,y as X,i as ce,j as e,C as ee,h as de}from"./index-B9rQ-kmE.js";import{a as S}from"./index-DW_MHI2K.js";import{C as se}from"./CForm-Bi1jMJNo.js";import{C as L,a as N}from"./CRow-BN1XSdcy.js";import{C as q}from"./CFormInput-DeJQvQXs.js";import{C as ue}from"./CFormTextarea-BBW0NQq9.js";import{C as I,a as V}from"./CInputGroupText-D3-pjqlF.js";import{b as y,a as me}from"./CContainer-DdWdpS7d.js";import{p as he,f as fe,g as pe,h as xe,j as Ce,k as ve}from"./CNavItem-DMaIUZz7.js";import{u as je,T as be,C as te}from"./CCloseButton-r9Y6HIOX.js";import{C as ge}from"./CFormControlWrapper-Bjgrupxp.js";import{C as ye}from"./CFormSelect-CQUZux_d.js";import{C as re,a as ne}from"./CCardBody-Dywmzwhl.js";import{C as ae}from"./CCardHeader-C6ZKMTzh.js";import{C as Re,a as Ne,b as Y,c as $,d as Te,e as M}from"./CTable-DFh1XnVU.js";import{C as qe}from"./DefaultLayout-rva2Np-g.js";import{C as Fe,a as Z}from"./CTabPane-D7Jigavr.js";import"./index.esm-Bup3ZIdH.js";import"./cil-user-Ddrdy7PS.js";import"./index-C97SfXnT.js";var oe=a.createContext({}),P=a.forwardRef(function(s,n){var d=s.children,h=s.animation,r=h===void 0?!0:h,l=s.autohide,C=l===void 0?!0:l,v=s.className,c=s.color,f=s.delay,j=f===void 0?5e3:f,p=s.index,b=s.innerKey,R=s.visible,o=R===void 0?!1:R,u=s.onClose,i=s.onShow,m=k(s,["children","animation","autohide","className","color","delay","index","innerKey","visible","onClose","onShow"]),x=a.useRef(),B=je(n,x),z=a.useState(!1),F=z[0],E=z[1],Q=a.useRef();a.useEffect(function(){E(o)},[o]);var H={visible:F,setVisible:E};a.useEffect(function(){return function(){return clearTimeout(Q.current)}},[]),a.useEffect(function(){W()},[F]);var W=function(){C&&(clearTimeout(Q.current),Q.current=window.setTimeout(function(){E(!1)},j))};return g.createElement(be,{in:F,nodeRef:x,onEnter:function(){return i&&i(p??null)},onExited:function(){return u&&u(p??null)},timeout:250,unmountOnExit:!0},function(U){var w;return g.createElement(oe.Provider,{value:H},g.createElement("div",T({className:A("toast",(w={fade:r},w["bg-".concat(c)]=c,w["border-0"]=c,w["show showing"]=U==="entering"||U==="exiting",w.show=U==="entered",w),v),"aria-live":"assertive","aria-atomic":"true",role:"alert",onMouseEnter:function(){return clearTimeout(Q.current)},onMouseLeave:function(){return W()}},m,{key:b,ref:B}),d))})});P.propTypes={animation:t.bool,autohide:t.bool,children:t.node,className:t.string,color:le,delay:t.number,index:t.number,innerKey:t.oneOfType([t.number,t.string]),onClose:t.func,onShow:t.func,visible:t.bool};P.displayName="CToast";var D=a.forwardRef(function(s,n){var d=s.children,h=s.className,r=k(s,["children","className"]);return g.createElement("div",T({className:A("toast-body",h)},r,{ref:n}),d)});D.propTypes={children:t.node,className:t.string};D.displayName="CToastBody";var G=a.forwardRef(function(s,n){var d=s.children,h=s.as,r=k(s,["children","as"]),l=a.useContext(oe).setVisible;return h?g.createElement(h,T({onClick:function(){return l(!1)}},r,{ref:n}),d):g.createElement(te,T({onClick:function(){return l(!1)}},r,{ref:n}))});G.propTypes=T(T({},te.propTypes),{as:t.elementType});G.displayName="CToastClose";var _=a.forwardRef(function(s,n){var d=s.children,h=s.className,r=s.closeButton,l=k(s,["children","className","closeButton"]);return g.createElement("div",T({className:A("toast-header",h)},l,{ref:n}),d,r&&g.createElement(G,null))});_.propTypes={children:t.node,className:t.string,closeButton:t.bool};_.displayName="CToastHeader";var O=a.forwardRef(function(s,n){var d=s.children,h=s.className,r=s.placement,l=s.push,C=k(s,["children","className","placement","push"]),v=a.useState([]),c=v[0],f=v[1],j=a.useRef(0);a.useEffect(function(){j.current++,l&&p(l)},[l]);var p=function(b){f(function(R){return X(X([],R,!0),[g.cloneElement(b,{index:j.current,innerKey:j.current,onClose:function(o){return f(function(u){return u.filter(function(i){return i.props.index!==o})})}})],!1)})};return g.createElement(he,{portal:typeof r=="string"},c.length>0||d?g.createElement("div",T({className:A("toaster toast-container",{"position-fixed":r,"top-0":r&&r.includes("top"),"top-50 translate-middle-y":r&&r.includes("middle"),"bottom-0":r&&r.includes("bottom"),"start-0":r&&r.includes("start"),"start-50 translate-middle-x":r&&r.includes("center"),"end-0":r&&r.includes("end")},h)},C,{ref:n}),d,c.map(function(b){return g.cloneElement(b,{visible:!0})})):null)});O.propTypes={children:t.node,className:t.string,placement:t.oneOfType([t.string,t.oneOf(["top-start","top-center","top-end","middle-start","middle-center","middle-end","bottom-start","bottom-center","bottom-end"])]),push:t.any};O.displayName="CToaster";const Ee="https://backend-log2.axleshift.com/api/v1/rfq",we=()=>`RFQ-${Date.now()}-${Math.floor(1e3+Math.random()*9e3)}`,Se=()=>{const{accessToken:s}=ce(),[n,d]=a.useState({rfqNumber:we(),title:"",description:"",items:[{name:"",quantity:0,unit:""}],vendors:[],budget:0,deadline:""}),[h,r]=a.useState(!1),[l,C]=a.useState(""),[v,c]=a.useState(""),[f,j]=a.useState(!1),p=o=>{const{name:u,value:i}=o.target;d({...n,[u]:i})},b=(o,u)=>{const{name:i,value:m}=o.target,x=[...n.items];x[u][i]=m,d({...n,items:x})},R=async o=>{var u,i,m;o.preventDefault(),j(!0);try{if(!s){console.error("No authentication token found."),C("Authentication error. Please log in again."),c("danger"),r(!0),setTimeout(()=>r(!1),5e3),j(!1);return}const x={Authorization:`Bearer ${s}`,"Content-Type":"application/json"};console.log("Sending request with headers:",x),await S.post(Ee,n,{headers:x}),C("RFQ created successfully!"),c("success"),r(!0),setTimeout(()=>r(!1),5e3),d({rfqNumber:"",title:"",description:"",items:[{name:"",quantity:0,unit:""}],vendors:[],budget:0,deadline:""})}catch(x){console.error("Error creating RFQ:",((u=x.response)==null?void 0:u.data)||x.message),C(((m=(i=x.response)==null?void 0:i.data)==null?void 0:m.message)||"Error creating RFQ"),c("danger"),r(!0),setTimeout(()=>r(!1),5e3)}finally{j(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{onSubmit:R,children:[e.jsxs(L,{className:"mb-3",children:[e.jsx(N,{md:6,children:e.jsx(q,{type:"text",name:"rfqNumber",value:n.rfqNumber,onChange:p,placeholder:"RFQ Number",label:"RFQ Number",required:!0})}),e.jsx(N,{md:6,children:e.jsx(q,{type:"text",name:"title",value:n.title,onChange:p,placeholder:"Title",label:"Title",required:!0})})]}),e.jsx(ue,{name:"description",value:n.description,onChange:p,placeholder:"Description",label:"Description",required:!0,rows:3}),n.items.map((o,u)=>e.jsxs(L,{className:"mb-3",children:[e.jsx(N,{md:4,children:e.jsxs(I,{children:[e.jsx(V,{children:"Item Name"}),e.jsx(q,{type:"text",name:"name",value:o.name,onChange:i=>b(i,u),placeholder:"Item Name",required:!0})]})}),e.jsx(N,{md:4,children:e.jsxs(I,{children:[e.jsx(V,{children:"Quantity"}),e.jsx(q,{type:"number",name:"quantity",value:o.quantity,onChange:i=>b(i,u),placeholder:"Quantity",required:!0})]})}),e.jsx(N,{md:4,children:e.jsxs(I,{children:[e.jsx(V,{children:"Unit"}),e.jsx(q,{type:"text",name:"unit",value:o.unit,onChange:i=>b(i,u),placeholder:"Unit",required:!0})]})})]},u)),e.jsx(y,{color:"primary",type:"button",onClick:()=>d({...n,items:[...n.items,{name:"",quantity:0,unit:""}]}),className:"mb-3",children:"Add Item"}),e.jsxs(L,{className:"mb-3",children:[e.jsx(N,{md:6,children:e.jsxs(I,{children:[e.jsx(V,{children:"Budget"}),e.jsx(q,{type:"number",name:"budget",value:n.budget,onChange:p,placeholder:"Budget",required:!0})]})}),e.jsx(N,{md:6,children:e.jsxs(I,{children:[e.jsx(V,{children:"Deadline"}),e.jsx(q,{type:"date",name:"deadline",value:n.deadline,onChange:p,required:!0})]})})]}),e.jsx(y,{color:"success",type:"submit",disabled:f,children:f?e.jsx(ee,{size:"sm"}):"Create RFQ"})]}),h&&e.jsx(O,{position:"top-center",className:"position-fixed top-0 start-50 translate-middle-x zindex-9999",children:e.jsxs(P,{color:v,visible:h,children:[e.jsxs(_,{children:[v==="success"?"Success":"Error",e.jsx(y,{color:"close",onClick:()=>r(!1),className:"ms-auto"})]}),e.jsx(D,{children:l})]})})]})},ie=({visible:s,vendors:n,selectedVendor:d,setSelectedVendor:h,handleInvite:r,isInviting:l,onClose:C})=>{const v=async()=>{if(d)try{await r(d),C()}catch(c){console.error("Error inviting vendor:",c)}};return e.jsxs(fe,{visible:s,onClose:C,children:[e.jsx(pe,{children:e.jsx(xe,{children:"Invite Vendor"})}),e.jsx(Ce,{children:e.jsxs(se,{children:[e.jsx(ge,{children:"Select Vendor"}),e.jsxs(ye,{value:d,onChange:c=>h(c.target.value),children:[e.jsx("option",{value:"",children:"Select a vendor"}),n.map(c=>{var f;return e.jsxs("option",{value:c._id,children:[c.businessName," (",(f=c.userId)==null?void 0:f.email,")"]},c._id)})]})]})}),e.jsxs(ve,{children:[e.jsx(y,{color:"secondary",onClick:C,children:"Cancel"}),e.jsx(y,{color:"primary",onClick:v,disabled:l,children:l?e.jsx(ee,{size:"sm"}):"Invite Vendor"})]})]})};ie.propTypes={visible:t.bool.isRequired,vendors:t.arrayOf(t.shape({_id:t.string.isRequired,businessName:t.string.isRequired,userId:t.shape({email:t.string})})).isRequired,selectedVendor:t.string,setSelectedVendor:t.func.isRequired,handleInvite:t.func.isRequired,isInviting:t.bool.isRequired,onClose:t.func.isRequired};const J="https://backend-log2.axleshift.com",K=`${J}/api/v1/rfq`,Qe=`${J}/api/v1/vendor`,Ie=()=>{const s=de(),[n,d]=a.useState([]),[h,r]=a.useState([]),[l,C]=a.useState(null),[v,c]=a.useState(""),[f,j]=a.useState({visible:!1,message:"",color:""}),[p,b]=a.useState(!1);a.useEffect(()=>{const o=async()=>{var i;try{const m=await S.get(K);d(m.data)}catch(m){console.error("Error fetching RFQs:",((i=m.response)==null?void 0:i.data)||m.message)}},u=async()=>{var i;try{const m=await S.get(Qe);r(m.data)}catch(m){console.error("Error fetching vendors:",((i=m.response)==null?void 0:i.data)||m.message)}};o(),u()},[]);const R=async()=>{var o,u,i;if(!l||!v){j({visible:!0,message:"Please select a vendor",color:"danger"});return}b(!0);try{const m=await S.put(`${K}/${l}/invite-vendors`,{vendors:[v]},{headers:{"Content-Type":"application/json"}}),x=h.find(H=>H._id===v),B=(o=x==null?void 0:x.userId)==null?void 0:o.email;if(!B)throw new Error("Vendor email not found");const F=(await S.get(`${K}/${l}`)).data.title,E=l;if(!F||!E)throw new Error("Missing required fields: rfqTitle or rfqId.");const Q=await S.post(`${J}/api/v1/rfq/send-invite-email`,{vendorEmail:B,rfqTitle:F,rfqId:E});j({visible:!0,message:"Vendor invited successfully!",color:"success"}),C(null),c("")}catch(m){j({visible:!0,message:`Failed to invite vendor: ${((i=(u=m.response)==null?void 0:u.data)==null?void 0:i.message)||m.message}`,color:"danger"})}finally{b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(O,{position:"top-center",children:f.visible&&e.jsxs(P,{autohide:!0,color:f.color,onClose:()=>j({...f,visible:!1}),children:[e.jsx(_,{closeButton:!0,children:f.color==="success"?"Success":"Error"}),e.jsx(D,{children:f.message})]})}),e.jsxs(re,{children:[e.jsx(ae,{className:"d-flex justify-content-between align-items-center",children:e.jsx("h5",{className:"m-0",children:"Requests for Quotation (RFQs)"})}),e.jsx(ne,{children:e.jsxs(Re,{hover:!0,responsive:!0,children:[e.jsx(Ne,{children:e.jsxs(Y,{children:[e.jsx($,{className:"text-center",children:"RFQ Number"}),e.jsx($,{children:"Title"}),e.jsx($,{className:"text-center",children:"Status"}),e.jsx($,{className:"text-center",children:"Actions"})]})}),e.jsx(Te,{children:n.map(o=>e.jsxs(Y,{children:[e.jsx(M,{className:"text-center",children:o.rfqNumber}),e.jsx(M,{children:o.title}),e.jsx(M,{className:"text-center",children:e.jsx(qe,{color:o.status==="Open"?"success":"warning",children:o.status})}),e.jsxs(M,{className:"text-center",children:[e.jsx(y,{color:"info",size:"sm",onClick:()=>s(`/procurement/rfqs/${o._id}`),children:"View"})," ",e.jsx(y,{color:"warning",size:"sm",onClick:()=>C(o._id),children:"Invite"})]})]},o._id))})]})})]}),e.jsx(ie,{visible:l!==null,vendors:h,selectedVendor:v,setSelectedVendor:c,handleInvite:R,isInviting:p,onClose:()=>C(null)})]})},Ze=()=>{const[s,n]=a.useState("createRFQ");return e.jsx(me,{children:e.jsx(L,{className:"mb-3",children:e.jsx(N,{children:e.jsxs(re,{children:[e.jsxs(ae,{children:[e.jsx(y,{color:s==="createRFQ"?"primary":"secondary",onClick:()=>n("createRFQ"),className:`ms-2 ${s==="createRFQ"?"active-tab":""}`,style:{transition:"all 0.3s ease"},children:"Create RFQ"}),e.jsx(y,{color:s==="rfqList"?"primary":"secondary",onClick:()=>n("rfqList"),className:`ms-2 ${s==="rfqList"?"active-tab":""}`,style:{transition:"all 0.3s ease"},children:"RFQ List"})]}),e.jsx(ne,{children:e.jsxs(Fe,{children:[e.jsx(Z,{visible:s==="createRFQ",children:e.jsx(Se,{})}),e.jsx(Z,{visible:s==="rfqList",children:e.jsx(Ie,{})})]})})]})})})})};export{Ze as default};
