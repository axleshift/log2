import{R as e,P as s,k as w,r as g,C as F}from"./index-DCTHaFCh.js";import{a as k}from"./index-DZUceCzt.js";import{C as A}from"./CFormTextarea-CqWCZtpo.js";import{C as O}from"./CFormSelect-CkLUjGUo.js";import{C as I}from"./CFormInput-oJMb1kOP.js";import{C as f,a as c}from"./CRow-CjWOxKWF.js";import{b as q}from"./CContainer-DSBAt5Fg.js";import{C as B,a as L,b as U,c as M}from"./CToaster-CGIgH1pZ.js";import"./CFormControlWrapper-BHxeIyv8.js";import"./CCloseButton-CNDsuIa_.js";import"./CNavItem-CRpCac94.js";const l=({label:m,type:n="text",name:i,value:P,onChange:E,placeholder:C="",required:y=!1,options:D=[],rows:h=3,disabled:u=!1})=>n==="textarea"?e.createElement(A,{label:m,name:i,value:P,onChange:E,placeholder:C,required:y,rows:h,disabled:u,"aria-label":m}):n==="select"?e.createElement(O,{label:m,name:i,value:P,onChange:E,required:y,disabled:u,"aria-label":m},e.createElement("option",{value:""},"Select ",m),D.map((p,b)=>e.createElement("option",{key:b,value:p},p))):e.createElement(I,{type:n,name:i,value:P,onChange:E,placeholder:C,label:m,required:y,disabled:u,"aria-label":m});l.propTypes={label:s.string.isRequired,type:s.oneOf(["text","number","date","textarea","select"]),name:s.string.isRequired,value:s.oneOfType([s.string,s.number]).isRequired,onChange:s.func.isRequired,placeholder:s.string,required:s.bool,options:s.arrayOf(s.string),rows:s.number,disabled:s.bool};const _="https://backend-log2.axleshift.com",z=`${_}/api/v1/procurement`,H=()=>{const{accessToken:m}=w(),[n,i]=g.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[P,E]=g.useState([]),[C,y]=g.useState(!1),[D,h]=g.useState(!1),u=a=>{const{name:r,value:t}=a.target;i(o=>({...o,[r]:t}))},p=(a,r)=>{const{name:t,value:o}=r.target,d=[...n.products];d[a]={...d[a],[t]:t==="quantity"||t==="unitPrice"?o===""?"":parseFloat(o):o};const N=d.reduce((v,R)=>v+(R.unitPrice||0)*(R.quantity||0),0);i(v=>({...v,products:d,estimatedCost:parseFloat(N.toFixed(2))}))},b=()=>{i(a=>({...a,products:[...a.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},S=a=>{const r=n.products.filter((t,o)=>o!==a);i(t=>({...t,products:r,estimatedCost:r.reduce((o,d)=>o+(d.unitPrice*d.quantity||0),0)}))},x=async a=>{var r,t;if(a.preventDefault(),!C){y(!0);try{if(!m)throw new Error("Authentication error. Please log in again.");const o={Authorization:`Bearer ${m}`,"Content-Type":"application/json"},d={...n,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null};await k.post(z,d,{headers:o}),i({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),T("âœ… Procurement Request created successfully! Wait for Approval","success"),h(!0)}catch(o){T(((t=(r=o.response)==null?void 0:r.data)==null?void 0:t.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{y(!1)}}},T=(a,r)=>{E(t=>[...t,{id:Date.now(),message:a,color:r}]),setTimeout(()=>E(t=>t.slice(1)),5e3)};return e.createElement("form",{onSubmit:x},e.createElement(f,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(l,{label:"Title",name:"title",value:n.title,onChange:u,required:!0})),e.createElement(c,{md:6},e.createElement(l,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:u,required:!0}))),e.createElement(l,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:u,required:!0,rows:3}),e.createElement(f,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(l,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:u})),e.createElement(c,{md:6},e.createElement(l,{label:"Department",type:"select",name:"department",value:n.department,onChange:u,options:["HR","Finance","Logistics","IT","Procurement","Operations"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((a,r)=>e.createElement(f,{key:r,className:"mb-2"},e.createElement(c,{md:2},e.createElement(l,{label:"Product Name",name:"name",value:a.name,onChange:t=>p(r,t),required:!0})),e.createElement(c,{md:2},e.createElement(l,{label:"Quantity",type:"number",name:"quantity",value:a.quantity,min:"0",onChange:t=>p(r,t),required:!0})),e.createElement(c,{md:2},e.createElement(l,{label:"Unit",type:"select",name:"unit",value:a.unit,onChange:t=>p(r,t),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(c,{md:2},e.createElement(l,{label:"Unit Price",type:"number",name:"unitPrice",value:a.unitPrice,min:"0",onChange:t=>p(r,t),required:!0})),e.createElement(c,{md:2},e.createElement(q,{color:"danger",onClick:()=>S(r)},"Remove")))),e.createElement(f,{className:"mt-3"},e.createElement(c,{md:6},e.createElement(q,{color:"primary",onClick:b},"Add Product")),e.createElement(c,{md:6,className:"text-end"},e.createElement("h5",null,"Estimated Cost: â‚±",n.estimatedCost.toFixed(2)))),e.createElement(f,{className:"mt-4"},e.createElement(c,{md:12,className:"text-center"},e.createElement(q,{color:"success",type:"submit",disabled:C},C?e.createElement(F,{size:"sm"}):"Create Procurement"))),e.createElement(B,{placement:"top-end"},P.map(({id:a,message:r,color:t})=>e.createElement(L,{key:a,color:t,autohide:!0,visible:!0},e.createElement(U,{closeButton:!0},"Notification"),e.createElement(M,null,r)))))},ee=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(H,null));export{ee as default};
