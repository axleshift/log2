import{u as se,r as s,R as e,C as le}from"./index-QHt0BNF-.js";import{a as p}from"./index-xsH4HHeE.js";import{c as P,a as T,b as d}from"./CRow-Ce6guADD.js";import{e as ce,f as de,g as U,h as E,j as me,k as h,l as ue,m as ie,p as pe,n as Ee}from"./CTable-DhIoX8qk.js";import{C as he}from"./CForm-B7FIKFam.js";import{a as g}from"./CFormInput-BdJGZwOp.js";import{C as S}from"./CFormSelect-BKzCe16h.js";import{a as be,b as Ce,c as Pe,d as ge}from"./DefaultLayout-B8VGAksF.js";import"./CCloseButton-DubpZP9d.js";import"./CFormTextarea-OgHKVdzt.js";import"./index.esm-D1lQqmIc.js";import"./CCardBody-DTdIa86a.js";import"./CCardHeader-BvbB9qDc.js";import"./CAlert-ZjTU6H8E.js";import"./cil-user-Ddrdy7PS.js";import"./index-C0QOyGfk.js";const _="https://backend-log2.axleshift.com",z=`${_}/api/v1/purchaseOrder`,fe=`${_}/api/v1/procurement`,ve=`${_}/api/v1/vendor`,ye=`${_}/api/v1/product`,Ne="https://backend-log1.axleshift.com/api/v1/warehouseLoc/locations",Ie=()=>{const{accessToken:i}=se(),[L,O]=s.useState(!1),[R,V]=s.useState([]),[F,j]=s.useState([]),[H,W]=s.useState([]),[Q,G]=s.useState([]),[m,J]=s.useState([]),[K,A]=s.useState("PO-123456"),[Te,X]=s.useState(null),[u,x]=s.useState(1),f=5,Y=()=>{const[t,r]=K.split("-"),a=parseInt(r.replace(/^0+/,""))||0,n=String(a+1).padStart(6,"0"),o=`${t}-${n}`;return A(o),X(o),o},[c,b]=s.useState({procurementId:"",vendorId:"",shipTo:"",rfqId:"",poNumber:"",orderDate:"",receiveDate:"",carrier:"",additionalNotes:"",products:[{productId:"",description:"",quantity:0,unitPrice:0}]}),[v,D]=s.useState({show:!1,message:"",color:""}),[w,q]=s.useState(!1),B=async()=>{try{const[t,r,a,n,o]=await Promise.all([p.get(z,{headers:{Authorization:`Bearer ${i}`}}),p.get(fe,{headers:{Authorization:`Bearer ${i}`}}),p.get(ve,{headers:{Authorization:`Bearer ${i}`}}),p.get(ye,{headers:{Authorization:`Bearer ${i}`}}),p.get(Ne,{headers:{"Content-Type":"application/json","x-api-key":"0ad3f5c013c42d2d0537672a260978c71dcd5a7d508019d748f991deee3d65665a477e3523c6bbc83fd6a51a71dd5003"},withCredentials:!0})]);V(t.data),j(r.data),W(a.data),G(n.data),J(o.data);const l=t.data.map(oe=>oe.poNumber).filter(Boolean).sort(),I=l[l.length-1];I&&A(I)}catch(t){console.error("Failed to fetch data:",t)}},C=t=>{const{name:r,value:a}=t.target;b(n=>({...n,[r]:a}))},y=(t,r)=>{const{name:a,value:n}=t.target,o=[...c.products];if(["quantity","unitPrice"].includes(a)){const l=parseFloat(n);o[r][a]=isNaN(l)?0:l}else o[r][a]=n;b(l=>({...l,products:o}))},Z=()=>{b(t=>({...t,products:[...t.products,{productId:"",description:"",quantity:0,unitPrice:0}]}))},ee=()=>{b({procurementId:"",vendorId:"",shipTo:"",rfqId:"",poNumber:"",orderDate:"",receiveDate:"",carrier:"",additionalNotes:"",warehouse_id:"",products:[{productId:"",description:"",quantity:0,unitPrice:0}]})},N=(t,r)=>{D({show:!0,message:t,color:r}),setTimeout(()=>D({show:!1,message:"",color:""}),5e3)},te=t=>{var r,a;return((a=(r=m==null?void 0:m.data)==null?void 0:r.find(n=>n._id===t))==null?void 0:a.warehouseName)||"—"},ae=async t=>{var r,a;if(t.preventDefault(),!i)return N("Not authenticated.","danger");q(!0);try{const n={...c,warehouse_id:c.shipTo};if(n.shipTo||delete n.shipTo,n.rfqId||delete n.rfqId,!n.products.length||n.products.some(o=>!o.productId||!o.description)){N("Each product must have a product and description","danger"),q(!1);return}await p.post(z,n,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),N("Purchase Order Created!","success"),ee(),B(),O(!1)}catch(n){console.error("❌ PO creation error:",n),N(((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.message)||"Error creating Purchase Order","danger")}finally{q(!1)}};s.useEffect(()=>{B()},[]);const re=()=>{const t=Y();b(r=>({...r,poNumber:t})),O(!0)},$=t=>{const r=Math.ceil(R.length/f);t==="next"&&u<r?x(u+1):t==="prev"&&u>1&&x(u-1)},k=(u-1)*f,ne=R.slice(k,k+f),M=Math.ceil(R.length/f);return e.createElement(e.Fragment,null,e.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},e.createElement("h4",null,"Purchase Orders"),e.createElement(P,{type:"button",color:"primary",onClick:()=>re()},"+ Create Purchase Order")),e.createElement(ce,{striped:!0,responsive:!0,hover:!0},e.createElement(de,null,e.createElement(U,null,e.createElement(E,null,"#"),e.createElement(E,null,"PO Number"),e.createElement(E,null,"Vendor"),e.createElement(E,null,"Procurement"),e.createElement(E,null,"Ship To"),e.createElement(E,null,"Products"))),e.createElement(me,null,ne.map((t,r)=>{var a,n,o;return e.createElement(U,{key:t._id},e.createElement(h,null,k+r+1),e.createElement(h,null,t.poNumber||"—"),e.createElement(h,null,((a=t.vendor)==null?void 0:a.businessName)||"—"),e.createElement(h,null,((n=t.procurementId)==null?void 0:n.title)||"—"),e.createElement(h,null,te(t.shipTo)),e.createElement(h,null,((o=t.details)==null?void 0:o.map((l,I)=>e.createElement("div",{key:I},l.description," — ",l.quantity," @ ",l.unitPrice)))||"—"))}))),e.createElement("div",{className:"d-flex justify-content-between align-items-center mt-3"},e.createElement("span",null,"Page ",u," of ",M),e.createElement("div",null,e.createElement(P,{color:"secondary",className:"me-2",size:"sm",onClick:()=>$("prev"),disabled:u===1},"← Prev"),e.createElement(P,{color:"secondary",size:"sm",onClick:()=>$("next"),disabled:u>=M},"Next →"))),e.createElement(ue,{visible:L,onClose:async()=>{O(!1)},size:"lg"},e.createElement(ie,null,e.createElement(pe,null,"Create Purchase Order")),e.createElement(Ee,null,e.createElement(he,{onSubmit:ae},e.createElement(T,{className:"mb-3"},e.createElement(d,{md:6},e.createElement(g,{name:"poNumber",value:c.poNumber,onChange:C,label:"PO Number",required:!0})),e.createElement(d,{md:6},e.createElement(g,{type:"date",name:"orderDate",value:c.orderDate,onChange:C,label:"Order Date",required:!0}))),e.createElement(T,{className:"mb-3"},e.createElement(d,{md:6},e.createElement(S,{name:"procurementId",value:c.procurementId,onChange:C,label:"Procurement",required:!0},e.createElement("option",{value:""},"Select Procurement"),F.map(t=>e.createElement("option",{key:t._id,value:t._id},t.title)))),e.createElement(d,{md:6},e.createElement(S,{name:"vendorId",value:c.vendorId,onChange:C,label:"Vendor",required:!0},e.createElement("option",{value:""},"Select Vendor"),H.map(t=>e.createElement("option",{key:t._id,value:t._id},t.businessName))))),m?e.createElement(T,{className:"mb-3"},e.createElement(d,{md:6},e.createElement(S,{name:"shipTo",value:c.shipTo,onChange:C,label:"Ship To (Warehouse)"},e.createElement("option",{value:""},"Select Warehouse"),Array.isArray(m==null?void 0:m.data)&&m.data.map(t=>e.createElement("option",{key:t._id,value:t._id},t.warehouseName))))):e.createElement("div",null),e.createElement("h6",{className:"mt-3"},"Products"),c.products.map((t,r)=>e.createElement(T,{className:"mb-3",key:r},e.createElement(d,{md:4},e.createElement(S,{name:"productId",label:"Product",value:t.productId,onChange:a=>y(a,r),required:!0},e.createElement("option",{value:""},"Select Product"),Q.map(a=>e.createElement("option",{key:a._id,value:a._id},a.name)))),e.createElement(d,{md:4},e.createElement(g,{type:"text",name:"description",label:"Description",value:t.description,onChange:a=>y(a,r),required:!0})),e.createElement(d,{md:2},e.createElement(g,{type:"number",name:"quantity",label:"Qty",value:t.quantity,onChange:a=>y(a,r),required:!0})),e.createElement(d,{md:2},e.createElement(g,{type:"number",name:"unitPrice",label:"Unit Price",value:t.unitPrice,onChange:a=>y(a,r),required:!0})))),e.createElement(P,{onClick:Z,color:"secondary",className:"mb-3"},"+ Add Product"),e.createElement("div",{className:"text-end"},e.createElement(P,{type:"submit",color:"success",disabled:w},w?e.createElement(le,{size:"sm"}):"Create PO"))))),e.createElement(be,{placement:"top-end"},v.show&&e.createElement(Ce,{autohide:!0,visible:!0,color:v.color},e.createElement(Pe,{closeButton:!0},v.color==="success"?"Success":"Error"),e.createElement(ge,null,v.message))))},Ve=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4"},"CreatePurchaseOrder"),e.createElement(Ie,null));export{Ve as default};
