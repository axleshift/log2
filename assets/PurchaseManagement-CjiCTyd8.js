import{u as G,r as s,R as e,C as J}from"./index-4l8YDPMt.js";import{a as m}from"./index-t--hEgTQ.js";import{c as _,a as g,b as c}from"./CRow-Dstcvhhn.js";import{b as K,c as X,d as q,e as i,f as Y,g as p,h as Z,j as ee,k as te}from"./CTable-BFf1LR0p.js";import{C as ae}from"./CModalTitle-COm58w7q.js";import{C as re}from"./CForm-BlATjbC-.js";import{a as C}from"./CFormInput-5eZtoBd3.js";import{C as y}from"./CFormSelect-Q2Zp1re3.js";import{a as ne,b as oe,c as se,d as le}from"./DefaultLayout-DdXa9kGr.js";import"./CCloseButton-CN5zlj3N.js";import"./CFormTextarea-D45f2w8t.js";import"./index.esm-CTaOn0oS.js";import"./cil-user-Ddrdy7PS.js";import"./index-Cl-k4Ybk.js";const T="https://backend-log2.axleshift.com",A=`${T}/api/v1/purchaseOrder`,ce=`${T}/api/v1/procurement`,de=`${T}/api/v1/vendor`,ue=`${T}/api/v1/product`,me="https://backend-log1.axleshift.com/api/v1/warehouseLoc/locations",ie=()=>{const{accessToken:u}=G(),[D,N]=s.useState(!1),[k,w]=s.useState([]),[B,U]=s.useState([]),[$,L]=s.useState([]),[M,x]=s.useState([]),[d,z]=s.useState([]),[l,b]=s.useState({procurementId:"",vendorId:"",shipTo:"",rfqId:"",poNumber:"",orderDate:"",receiveDate:"",carrier:"",additionalNotes:"",products:[{productId:"",description:"",quantity:0,unitPrice:0}]}),[P,S]=s.useState({show:!1,message:"",color:""}),[O,I]=s.useState(!1),R=async()=>{try{const[t,n,a,r,o]=await Promise.all([m.get(A,{headers:{Authorization:`Bearer ${u}`}}),m.get(ce,{headers:{Authorization:`Bearer ${u}`}}),m.get(de,{headers:{Authorization:`Bearer ${u}`}}),m.get(ue,{headers:{Authorization:`Bearer ${u}`}}),m.get(me,{headers:{"Content-Type":"application/json","x-api-key":"0ad3f5c013c42d2d0537672a260978c71dcd5a7d508019d748f991deee3d65665a477e3523c6bbc83fd6a51a71dd5003"},withCredentials:!0})]);w(t.data),U(n.data),L(a.data),x(r.data),z(o.data)}catch(t){console.error("Failed to fetch data:",t)}},E=t=>{const{name:n,value:a}=t.target;b(r=>({...r,[n]:a}))},f=(t,n)=>{const{name:a,value:r}=t.target,o=[...l.products];o[n][a]=["quantity","unitPrice"].includes(a)?parseFloat(r):r,b(h=>({...h,products:o}))},F=()=>{b(t=>({...t,products:[...t.products,{productId:"",description:"",quantity:0,unitPrice:0}]}))},V=()=>{b({procurementId:"",vendorId:"",shipTo:"",rfqId:"",poNumber:"",orderDate:"",receiveDate:"",carrier:"",additionalNotes:"",warehouse_id:"",products:[{productId:"",description:"",quantity:0,unitPrice:0}]})},v=(t,n)=>{S({show:!0,message:t,color:n}),setTimeout(()=>S({show:!1,message:"",color:""}),5e3)},H=t=>{var n,a;return((a=(n=d==null?void 0:d.data)==null?void 0:n.find(r=>r._id===t))==null?void 0:a.warehouseName)||"—"},W=async t=>{var n,a;if(t.preventDefault(),!u)return v("Not authenticated.","danger");I(!0);try{const r={...l,warehouse_id:l.shipTo};if(r.shipTo||delete r.shipTo,r.rfqId||delete r.rfqId,!r.products.length||r.products.some(o=>!o.productId||!o.description)){v("Each product must have a product and description","danger"),I(!1);return}await m.post(A,r,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}),v("Purchase Order Created!","success"),V(),R(),N(!1)}catch(r){console.error("❌ PO creation error:",r),v(((a=(n=r.response)==null?void 0:n.data)==null?void 0:a.message)||"Error creating Purchase Order","danger")}finally{I(!1)}};s.useEffect(()=>{R()},[]);const j=()=>{N(!0)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},e.createElement("h4",null,"Purchase Orders"),e.createElement(_,{type:"button",color:"primary",onClick:()=>j()},"+ Create Purchase Order")),e.createElement(K,{striped:!0,responsive:!0,hover:!0},e.createElement(X,null,e.createElement(q,null,e.createElement(i,null,"#"),e.createElement(i,null,"PO Number"),e.createElement(i,null,"Vendor"),e.createElement(i,null,"Procurement"),e.createElement(i,null,"Ship To"),e.createElement(i,null,"Products"))),e.createElement(Y,null,k.map((t,n)=>{var a,r,o;return e.createElement(q,{key:t._id},e.createElement(p,null,n+1),e.createElement(p,null,t.poNumber||"—"),e.createElement(p,null,((a=t.vendor)==null?void 0:a.businessName)||"—"),e.createElement(p,null,((r=t.procurementId)==null?void 0:r.title)||"—"),e.createElement(p,null,H(t.shipTo)),e.createElement(p,null,((o=t.details)==null?void 0:o.map((h,Q)=>e.createElement("div",{key:Q},h.description," — ",h.quantity," @ ",h.unitPrice)))||"—"))}))),e.createElement(Z,{visible:D,onClose:async()=>{N(!1)},size:"lg"},e.createElement(ee,null,e.createElement(ae,null,"Create Purchase Order")),e.createElement(te,null,e.createElement(re,{onSubmit:W},e.createElement(g,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(C,{name:"poNumber",value:l.poNumber,onChange:E,label:"PO Number",required:!0})),e.createElement(c,{md:6},e.createElement(C,{type:"date",name:"orderDate",value:l.orderDate,onChange:E,label:"Order Date",required:!0}))),e.createElement(g,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(y,{name:"procurementId",value:l.procurementId,onChange:E,label:"Procurement",required:!0},e.createElement("option",{value:""},"Select Procurement"),B.map(t=>e.createElement("option",{key:t._id,value:t._id},t.title)))),e.createElement(c,{md:6},e.createElement(y,{name:"vendorId",value:l.vendorId,onChange:E,label:"Vendor",required:!0},e.createElement("option",{value:""},"Select Vendor"),$.map(t=>e.createElement("option",{key:t._id,value:t._id},t.businessName))))),d?e.createElement(g,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(y,{name:"shipTo",value:l.shipTo,onChange:E,label:"Ship To (Warehouse)"},e.createElement("option",{value:""},"Select Warehouse"),Array.isArray(d==null?void 0:d.data)&&d.data.map(t=>e.createElement("option",{key:t._id,value:t._id},t.warehouseName))))):e.createElement("div",null),e.createElement("h6",{className:"mt-3"},"Products"),l.products.map((t,n)=>e.createElement(g,{className:"mb-3",key:n},e.createElement(c,{md:4},e.createElement(y,{name:"productId",label:"Product",value:t.productId,onChange:a=>f(a,n),required:!0},e.createElement("option",{value:""},"Select Product"),M.map(a=>e.createElement("option",{key:a._id,value:a._id},a.name)))),e.createElement(c,{md:4},e.createElement(C,{type:"text",name:"description",label:"Description",value:t.description,onChange:a=>f(a,n),required:!0})),e.createElement(c,{md:2},e.createElement(C,{type:"number",name:"quantity",label:"Qty",value:t.quantity,onChange:a=>f(a,n),required:!0})),e.createElement(c,{md:2},e.createElement(C,{type:"number",name:"unitPrice",label:"Unit Price",value:t.unitPrice,onChange:a=>f(a,n),required:!0})))),e.createElement(_,{onClick:F,color:"secondary",className:"mb-3"},"+ Add Product"),e.createElement("div",{className:"text-end"},e.createElement(_,{type:"submit",color:"success",disabled:O},O?e.createElement(J,{size:"sm"}):"Create PO"))))),e.createElement(ne,{placement:"top-end"},P.show&&e.createElement(oe,{autohide:!0,visible:!0,color:P.color},e.createElement(se,{closeButton:!0},P.color==="success"?"Success":"Error"),e.createElement(le,null,P.message))))},Se=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4"},"CreatePurchaseOrder"),e.createElement(ie,null));export{Se as default};
