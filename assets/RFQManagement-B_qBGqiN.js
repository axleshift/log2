import{r as s,_ as B,a as T,b as q,c as P,P as n,d as ce,j as ee,z as X,R as e,k as ue,C as te,i as me}from"./index-CVXZKmLB.js";import{a as Q}from"./index-DW_MHI2K.js";import{C as ne}from"./CForm-CknhkglT.js";import{C as A,a as N}from"./CRow-DsyirR-w.js";import{C as F}from"./CFormInput-Clsh0Ufx.js";import{C as de}from"./CFormTextarea-CSaJPm5V.js";import{C as k,a as V}from"./CInputGroupText-B912L933.js";import{b as y,a as fe}from"./CContainer-CUBQWJe-.js";import{p as pe,f as Ee,g as Ce,h as he,j as ve,k as be}from"./CNavItem-Di_elR9g.js";import{u as ge,T as ye,C as re}from"./CCloseButton-Ep9ySGeW.js";import{C as Re}from"./CFormControlWrapper-B3qIZ7fL.js";import{C as Ne}from"./CFormSelect-DBxcADRr.js";import{C as ae,a as se}from"./CCardBody-Dgfl31BA.js";import{C as le}from"./CCardHeader-kl5Q3YQb.js";import{C as Te,a as qe,b as Y,c as M,d as Fe,e as L}from"./CTable-CvbzxBxb.js";import{C as xe}from"./DefaultLayout-DqTAsKlE.js";import{C as we,a as Z}from"./CTabPane-L2Cw2IRi.js";import"./index.esm-5r6SQQg7.js";import"./cil-user-Ddrdy7PS.js";import"./index-CguwI2c5.js";var oe=s.createContext({}),D=s.forwardRef(function(t,a){var u=t.children,f=t.animation,r=f===void 0?!0:f,i=t.autohide,h=i===void 0?!0:i,v=t.className,c=t.color,p=t.delay,b=p===void 0?5e3:p,E=t.index,g=t.innerKey,R=t.visible,l=R===void 0?!1:R,m=t.onClose,o=t.onShow,d=B(t,["children","animation","autohide","className","color","delay","index","innerKey","visible","onClose","onShow"]),C=s.useRef(),$=ge(a,C),O=s.useState(!1),x=O[0],w=O[1],I=s.useRef();s.useEffect(function(){w(l)},[l]);var H={visible:x,setVisible:w};s.useEffect(function(){return function(){return clearTimeout(I.current)}},[]),s.useEffect(function(){W()},[x]);var W=function(){h&&(clearTimeout(I.current),I.current=window.setTimeout(function(){w(!1)},b))};return T(ye,{in:x,nodeRef:C,onEnter:function(){return o&&o(E??null)},onExited:function(){return m&&m(E??null)},timeout:250,unmountOnExit:!0,children:function(U){var S;return T(oe.Provider,{value:H,children:T("div",{...q({className:P("toast",(S={fade:r},S["bg-".concat(c)]=c,S["border-0"]=c,S["show showing"]=U==="entering"||U==="exiting",S.show=U==="entered",S),v),"aria-live":"assertive","aria-atomic":"true",role:"alert",onMouseEnter:function(){return clearTimeout(I.current)},onMouseLeave:function(){return W()}},d,{key:g,ref:$}),children:u})})}})});D.propTypes={animation:n.bool,autohide:n.bool,children:n.node,className:n.string,color:ce,delay:n.number,index:n.number,innerKey:n.oneOfType([n.number,n.string]),onClose:n.func,onShow:n.func,visible:n.bool};D.displayName="CToast";var _=s.forwardRef(function(t,a){var u=t.children,f=t.className,r=B(t,["children","className"]);return T("div",{...q({className:P("toast-body",f)},r,{ref:a}),children:u})});_.propTypes={children:n.node,className:n.string};_.displayName="CToastBody";var G=s.forwardRef(function(t,a){var u=t.children,f=t.as,r=B(t,["children","as"]),i=s.useContext(oe).setVisible;return f?T(f,{...q({onClick:function(){return i(!1)}},r,{ref:a}),children:u}):T(re,{...q({onClick:function(){return i(!1)}},r,{ref:a})})});G.propTypes=q(q({},re.propTypes),{as:n.elementType});G.displayName="CToastClose";var j=s.forwardRef(function(t,a){var u=t.children,f=t.className,r=t.closeButton,i=B(t,["children","className","closeButton"]);return ee("div",{...q({className:P("toast-header",f)},i,{ref:a}),children:[u,r&&T(G,{})]})});j.propTypes={children:n.node,className:n.string,closeButton:n.bool};j.displayName="CToastHeader";var z=s.forwardRef(function(t,a){var u=t.children,f=t.className,r=t.placement,i=t.push,h=B(t,["children","className","placement","push"]),v=s.useState([]),c=v[0],p=v[1],b=s.useRef(0);s.useEffect(function(){b.current++,i&&E(i)},[i]);var E=function(g){p(function(R){return X(X([],R,!0),[e.cloneElement(g,{index:b.current,innerKey:b.current,onClose:function(l){return p(function(m){return m.filter(function(o){return o.props.index!==l})})}})],!1)})};return T(pe,{portal:typeof r=="string",children:c.length>0||u?ee("div",{...q({className:P("toaster toast-container",{"position-fixed":r,"top-0":r&&r.includes("top"),"top-50 translate-middle-y":r&&r.includes("middle"),"bottom-0":r&&r.includes("bottom"),"start-0":r&&r.includes("start"),"start-50 translate-middle-x":r&&r.includes("center"),"end-0":r&&r.includes("end")},f)},h,{ref:a}),children:[u,c.map(function(g){return e.cloneElement(g,{visible:!0})})]}):null})});z.propTypes={children:n.node,className:n.string,placement:n.oneOfType([n.string,n.oneOf(["top-start","top-center","top-end","middle-start","middle-center","middle-end","bottom-start","bottom-center","bottom-end"])]),push:n.any};z.displayName="CToaster";const Se="https://backend-log2.axleshift.com/api/v1/rfq",Qe=()=>`RFQ-${Date.now()}-${Math.floor(1e3+Math.random()*9e3)}`,Ie=()=>{const{accessToken:t}=ue(),[a,u]=s.useState({rfqNumber:Qe(),title:"",description:"",items:[{name:"",quantity:0,unit:""}],vendors:[],budget:0,deadline:""}),[f,r]=s.useState(!1),[i,h]=s.useState(""),[v,c]=s.useState(""),[p,b]=s.useState(!1),E=l=>{const{name:m,value:o}=l.target;u({...a,[m]:o})},g=(l,m)=>{const{name:o,value:d}=l.target,C=[...a.items];C[m][o]=d,u({...a,items:C})},R=async l=>{var m,o,d;l.preventDefault(),b(!0);try{if(!t){console.error("No authentication token found."),h("Authentication error. Please log in again."),c("danger"),r(!0),setTimeout(()=>r(!1),5e3),b(!1);return}const C={Authorization:`Bearer ${t}`,"Content-Type":"application/json"};console.log("Sending request with headers:",C),await Q.post(Se,a,{headers:C}),h("RFQ created successfully!"),c("success"),r(!0),setTimeout(()=>r(!1),5e3),u({rfqNumber:"",title:"",description:"",items:[{name:"",quantity:0,unit:""}],vendors:[],budget:0,deadline:""})}catch(C){console.error("Error creating RFQ:",((m=C.response)==null?void 0:m.data)||C.message),h(((d=(o=C.response)==null?void 0:o.data)==null?void 0:d.message)||"Error creating RFQ"),c("danger"),r(!0),setTimeout(()=>r(!1),5e3)}finally{b(!1)}};return e.createElement(e.Fragment,null,e.createElement(ne,{onSubmit:R},e.createElement(A,{className:"mb-3"},e.createElement(N,{md:6},e.createElement(F,{type:"text",name:"rfqNumber",value:a.rfqNumber,onChange:E,placeholder:"RFQ Number",label:"RFQ Number",required:!0})),e.createElement(N,{md:6},e.createElement(F,{type:"text",name:"title",value:a.title,onChange:E,placeholder:"Title",label:"Title",required:!0}))),e.createElement(de,{name:"description",value:a.description,onChange:E,placeholder:"Description",label:"Description",required:!0,rows:3}),a.items.map((l,m)=>e.createElement(A,{key:m,className:"mb-3"},e.createElement(N,{md:4},e.createElement(k,null,e.createElement(V,null,"Item Name"),e.createElement(F,{type:"text",name:"name",value:l.name,onChange:o=>g(o,m),placeholder:"Item Name",required:!0}))),e.createElement(N,{md:4},e.createElement(k,null,e.createElement(V,null,"Quantity"),e.createElement(F,{type:"number",name:"quantity",value:l.quantity,onChange:o=>g(o,m),placeholder:"Quantity",required:!0}))),e.createElement(N,{md:4},e.createElement(k,null,e.createElement(V,null,"Unit"),e.createElement(F,{type:"text",name:"unit",value:l.unit,onChange:o=>g(o,m),placeholder:"Unit",required:!0}))))),e.createElement(y,{color:"primary",type:"button",onClick:()=>u({...a,items:[...a.items,{name:"",quantity:0,unit:""}]}),className:"mb-3"},"Add Item"),e.createElement(A,{className:"mb-3"},e.createElement(N,{md:6},e.createElement(k,null,e.createElement(V,null,"Budget"),e.createElement(F,{type:"number",name:"budget",value:a.budget,onChange:E,placeholder:"Budget",required:!0}))),e.createElement(N,{md:6},e.createElement(k,null,e.createElement(V,null,"Deadline"),e.createElement(F,{type:"date",name:"deadline",value:a.deadline,onChange:E,required:!0})))),e.createElement(y,{color:"success",type:"submit",disabled:p},p?e.createElement(te,{size:"sm"}):"Create RFQ")),f&&e.createElement(z,{position:"top-center",className:"position-fixed top-0 start-50 translate-middle-x zindex-9999"},e.createElement(D,{color:v,visible:f},e.createElement(j,null,v==="success"?"Success":"Error",e.createElement(y,{color:"close",onClick:()=>r(!1),className:"ms-auto"})),e.createElement(_,null,i))))},ie=({visible:t,vendors:a,selectedVendor:u,setSelectedVendor:f,handleInvite:r,isInviting:i,onClose:h})=>{const v=async()=>{if(u)try{await r(u),h()}catch(c){console.error("Error inviting vendor:",c)}};return e.createElement(Ee,{visible:t,onClose:h},e.createElement(Ce,null,e.createElement(he,null,"Invite Vendor")),e.createElement(ve,null,e.createElement(ne,null,e.createElement(Re,null,"Select Vendor"),e.createElement(Ne,{value:u,onChange:c=>f(c.target.value)},e.createElement("option",{value:""},"Select a vendor"),a.map(c=>{var p;return e.createElement("option",{key:c._id,value:c._id},c.businessName," (",(p=c.userId)==null?void 0:p.email,")")})))),e.createElement(be,null,e.createElement(y,{color:"secondary",onClick:h},"Cancel"),e.createElement(y,{color:"primary",onClick:v,disabled:i},i?e.createElement(te,{size:"sm"}):"Invite Vendor")))};ie.propTypes={visible:n.bool.isRequired,vendors:n.arrayOf(n.shape({_id:n.string.isRequired,businessName:n.string.isRequired,userId:n.shape({email:n.string})})).isRequired,selectedVendor:n.string,setSelectedVendor:n.func.isRequired,handleInvite:n.func.isRequired,isInviting:n.bool.isRequired,onClose:n.func.isRequired};const J="https://backend-log2.axleshift.com",K=`${J}/api/v1/rfq`,ke=`${J}/api/v1/vendor`,Ve=()=>{const t=me(),[a,u]=s.useState([]),[f,r]=s.useState([]),[i,h]=s.useState(null),[v,c]=s.useState(""),[p,b]=s.useState({visible:!1,message:"",color:""}),[E,g]=s.useState(!1);s.useEffect(()=>{const l=async()=>{var o;try{const d=await Q.get(K);u(d.data)}catch(d){console.error("Error fetching RFQs:",((o=d.response)==null?void 0:o.data)||d.message)}},m=async()=>{var o;try{const d=await Q.get(ke);r(d.data)}catch(d){console.error("Error fetching vendors:",((o=d.response)==null?void 0:o.data)||d.message)}};l(),m()},[]);const R=async()=>{var l,m,o;if(!i||!v){b({visible:!0,message:"Please select a vendor",color:"danger"});return}g(!0);try{const d=await Q.put(`${K}/${i}/invite-vendors`,{vendors:[v]},{headers:{"Content-Type":"application/json"}}),C=f.find(H=>H._id===v),$=(l=C==null?void 0:C.userId)==null?void 0:l.email;if(!$)throw new Error("Vendor email not found");const x=(await Q.get(`${K}/${i}`)).data.title,w=i;if(!x||!w)throw new Error("Missing required fields: rfqTitle or rfqId.");const I=await Q.post(`${J}/api/v1/rfq/send-invite-email`,{vendorEmail:$,rfqTitle:x,rfqId:w});b({visible:!0,message:"Vendor invited successfully!",color:"success"}),h(null),c("")}catch(d){b({visible:!0,message:`Failed to invite vendor: ${((o=(m=d.response)==null?void 0:m.data)==null?void 0:o.message)||d.message}`,color:"danger"})}finally{g(!1)}};return e.createElement(e.Fragment,null,e.createElement(z,{position:"top-center"},p.visible&&e.createElement(D,{autohide:!0,color:p.color,onClose:()=>b({...p,visible:!1})},e.createElement(j,{closeButton:!0},p.color==="success"?"Success":"Error"),e.createElement(_,null,p.message))),e.createElement(ae,null,e.createElement(le,{className:"d-flex justify-content-between align-items-center"},e.createElement("h5",{className:"m-0"},"Requests for Quotation (RFQs)")),e.createElement(se,null,e.createElement(Te,{hover:!0,responsive:!0},e.createElement(qe,null,e.createElement(Y,null,e.createElement(M,{className:"text-center"},"RFQ Number"),e.createElement(M,null,"Title"),e.createElement(M,{className:"text-center"},"Status"),e.createElement(M,{className:"text-center"},"Actions"))),e.createElement(Fe,null,a.map(l=>e.createElement(Y,{key:l._id},e.createElement(L,{className:"text-center"},l.rfqNumber),e.createElement(L,null,l.title),e.createElement(L,{className:"text-center"},e.createElement(xe,{color:l.status==="Open"?"success":"warning"},l.status)),e.createElement(L,{className:"text-center"},e.createElement(y,{color:"info",size:"sm",onClick:()=>t(`/procurement/rfqs/${l._id}`)},"View")," ",e.createElement(y,{color:"warning",size:"sm",onClick:()=>h(l._id)},"Invite")))))))),e.createElement(ie,{visible:i!==null,vendors:f,selectedVendor:v,setSelectedVendor:c,handleInvite:R,isInviting:E,onClose:()=>h(null)}))},et=()=>{const[t,a]=s.useState("createRFQ");return e.createElement(fe,null,e.createElement(A,{className:"mb-3"},e.createElement(N,null,e.createElement(ae,null,e.createElement(le,null,e.createElement(y,{color:t==="createRFQ"?"primary":"secondary",onClick:()=>a("createRFQ"),className:`ms-2 ${t==="createRFQ"?"active-tab":""}`,style:{transition:"all 0.3s ease"}},"Create RFQ"),e.createElement(y,{color:t==="rfqList"?"primary":"secondary",onClick:()=>a("rfqList"),className:`ms-2 ${t==="rfqList"?"active-tab":""}`,style:{transition:"all 0.3s ease"}},"RFQ List")),e.createElement(se,null,e.createElement(we,null,e.createElement(Z,{visible:t==="createRFQ"},e.createElement(Ie,null)),e.createElement(Z,{visible:t==="rfqList"},e.createElement(Ve,null))))))))};export{et as default};
