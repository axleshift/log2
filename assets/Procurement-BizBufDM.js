import{R as e,P as o,u as Q,l as G,r as p,C as X}from"./index-D1haz4zp.js";import{a as F}from"./index-t--hEgTQ.js";import{C as J}from"./CFormTextarea-DJHGWBI0.js";import{C as W}from"./CFormSelect-CQL6fzkU.js";import{a as Y}from"./CFormInput-CujOS9_1.js";import{c as m,a as f,b as c}from"./CRow-Boga1cOo.js";import{b as _,c as I,d as $,f as Z,g as ee,h as O,j as S,k as te,l as k,e as ae}from"./CTable-BHUvNzq9.js";import{C as re,a as ne}from"./CCardBody-R9kYYhXf.js";import{C as le,a as se,b as oe,c as ce,d as me}from"./DefaultLayout-BUZUy6TS.js";import"./CCloseButton-DhW8IUPc.js";import"./CForm-BKi5VGFH.js";import"./CCardHeader-B8zj-hL2.js";import"./CAlert-D2T20cRn.js";import"./index.esm-DRRgYBAD.js";import"./cil-user-Ddrdy7PS.js";import"./index-sMQ8yH7z.js";const i=({label:l,type:v="text",name:E,value:n,onChange:u,placeholder:D="",required:C=!1,options:g=[],rows:q=3,disabled:P=!1})=>v==="textarea"?e.createElement(J,{label:l,name:E,value:n,onChange:u,placeholder:D,required:C,rows:q,disabled:P,"aria-label":l}):v==="select"?e.createElement(W,{label:l,name:E,value:n,onChange:u,required:C,disabled:P,"aria-label":l},e.createElement("option",{value:""},"Select ",l),g.map((y,w)=>e.createElement("option",{key:w,value:y},y))):e.createElement(Y,{type:v,name:E,value:n,onChange:u,placeholder:D,label:l,required:C,disabled:P,"aria-label":l});i.propTypes={label:o.string.isRequired,type:o.oneOf(["text","number","date","textarea","select"]),name:o.string.isRequired,value:o.oneOfType([o.string,o.number]).isRequired,onChange:o.func.isRequired,placeholder:o.string,required:o.bool,options:o.arrayOf(o.string),rows:o.number,disabled:o.bool};const ie="https://backend-log2.axleshift.com",B=`${ie}/api/v1/procurement`,ue=()=>{const{accessToken:l,user:v}=Q(),E=G(),[n,u]=p.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[D,C]=p.useState([]),[g,q]=p.useState(!1),[P,y]=p.useState(!1),[w,N]=p.useState([]),[H,T]=p.useState(!1),[x,L]=p.useState(null);p.useEffect(()=>{(async()=>{if(l)try{const a=await F.get(B,{headers:{Authorization:`Bearer ${l}`}});N(a.data)}catch(a){console.error("Error fetching procurements:",a)}})()},[l]);const b=t=>{const{name:a,value:r}=t.target;u(s=>({...s,[a]:r}))},R=(t,a)=>{const{name:r,value:s}=a.target,d=[...n.products];d[t]={...d[t],[r]:r==="quantity"||r==="unitPrice"?s===""?"":parseFloat(s):s};const A=d.reduce((h,M)=>h+(M.unitPrice||0)*(M.quantity||0),0);u(h=>({...h,products:d,estimatedCost:parseFloat(A.toFixed(2))}))},U=()=>{u(t=>({...t,products:[...t.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},V=t=>{const a=n.products.filter((r,s)=>s!==t);u(r=>({...r,products:a,estimatedCost:a.reduce((s,d)=>s+(d.unitPrice*d.quantity||0),0)}))},j=async t=>{var a,r;if(t.preventDefault(),!g){q(!0);try{if(!l)throw new Error("Authentication error. Please log in again.");const s={Authorization:`Bearer ${l}`,"Content-Type":"application/json"},d={...n,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null},A=await F.post(B,d,{headers:s});N(h=>[...h,A.data]),u({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),y(!1),z("âœ… Procurement Request created successfully!","success")}catch(s){z(((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{q(!1)}}},K=async()=>{if(!(!x||!l))try{await F.delete(`${B}/${x}`,{headers:{Authorization:`Bearer ${l}`}}),N(t=>t.filter(a=>a._id!==x)),T(!1)}catch(t){console.error("Error deleting procurement:",t)}},z=(t,a)=>{C(r=>[...r,{id:Date.now(),message:t,color:a}]),setTimeout(()=>C(r=>r.slice(1)),5e3)};return e.createElement(e.Fragment,null,e.createElement(m,{color:"primary",onClick:()=>y(!0),className:"mb-3"},"+ Create Procurement"),e.createElement(_,{visible:P,onClose:()=>y(!1),size:"lg"},e.createElement(I,null,"Create Procurement Request"),e.createElement($,null,e.createElement("form",{onSubmit:j},e.createElement(f,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(i,{label:"Title",name:"title",value:n.title,onChange:b,required:!0})),e.createElement(c,{md:6},e.createElement(i,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:b,required:!0}))),e.createElement(i,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:b,required:!0,rows:3}),e.createElement(f,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(i,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:b})),e.createElement(c,{md:6},e.createElement(i,{label:"Department",type:"select",name:"department",value:n.department,onChange:b,options:["HR","Finance","Logistics","IT","Procurement"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((t,a)=>e.createElement(f,{key:a,className:"mb-2"},e.createElement(c,{md:2},e.createElement(i,{label:"Product Name",name:"name",value:t.name,onChange:r=>R(a,r),required:!0})),e.createElement(c,{md:2},e.createElement(i,{label:"Quantity",type:"number",name:"quantity",value:t.quantity,min:"0",onChange:r=>R(a,r),required:!0})),e.createElement(c,{md:2},e.createElement(i,{label:"Unit",type:"select",name:"unit",value:t.unit,onChange:r=>R(a,r),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(c,{md:2},e.createElement(i,{label:"Unit Price",type:"number",name:"unitPrice",value:t.unitPrice,min:"0",onChange:r=>R(a,r),required:!0})),e.createElement(c,{md:2},e.createElement(m,{color:"danger",onClick:()=>V(a)},"Remove")))),e.createElement(f,{className:"mt-3"},e.createElement(c,{md:6},e.createElement(m,{color:"primary",onClick:U},"Add Product"))),e.createElement(f,{className:"mt-3 text-end"},e.createElement(c,null,e.createElement("h5",null,"Estimated Cost: ",n.estimatedCost.toFixed(2)))),e.createElement(f,{className:"mt-4"},e.createElement(c,{md:12,className:"text-center"},e.createElement(m,{color:"success",type:"submit",disabled:g},g?e.createElement(X,{size:"sm"}):"Submit")))))),e.createElement(re,null,e.createElement(ne,null,e.createElement("h5",null,"Procurement Requests"),e.createElement(Z,{responsive:!0},e.createElement(ee,null,e.createElement(O,null,e.createElement(S,null,"Title"),e.createElement(S,null,"Department"),e.createElement(S,null,"Status"),e.createElement(S,null,"Actions"))),e.createElement(te,null,w.map(t=>e.createElement(O,{key:t._id},e.createElement(k,null,t.title),e.createElement(k,null,t.department),e.createElement(k,null,e.createElement(le,{color:t.status==="Approved"?"success":"warning"},t.status)),e.createElement(k,{className:"text-center"},e.createElement(m,{color:"info",size:"sm",onClick:()=>E(`/procurement/${t._id}`)},"View")," ",e.createElement(m,{color:"danger",size:"sm",onClick:()=>{L(t._id),T(!0)}},"Delete")," ",t.status==="Approved"&&e.createElement(e.Fragment,null,e.createElement(m,{color:"primary",size:"sm",onClick:()=>E(`/rfq/create/${t._id}`)},"Create RFQ")," ",e.createElement(m,{color:"success",size:"sm",onClick:()=>E("/procurement/po-payments")},"Create PO"))))))))),e.createElement(_,{visible:H,onClose:()=>T(!1)},e.createElement(I,null,"Confirm Deletion"),e.createElement($,null,"Are you sure you want to delete this procurement request?"),e.createElement(ae,null,e.createElement(m,{color:"secondary",onClick:()=>T(!1)},"Cancel"),e.createElement(m,{color:"danger",onClick:K},"Delete"))),e.createElement(se,{placement:"top-end"},D.map(t=>e.createElement(oe,{key:t.id,autohide:!0,visible:!0,color:t.color},e.createElement(ce,{closeButton:!0},t.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(me,null,t.message)))))},ke=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(ue,null));export{ke as default};
