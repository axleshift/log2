import{R as e,P as m,k as $,r as p,C as U,i as z}from"./index-CQ5bThOo.js";import{a as S}from"./index-C88pvD_q.js";import{C as H}from"./CFormTextarea-zLRXAeMj.js";import{C as G}from"./CFormSelect-DG0yTiiw.js";import{C as K}from"./CFormInput-C2PVtSjy.js";import{C as D,a as i}from"./CRow-JJupQ2Xr.js";import{b as h}from"./CContainer-ezbfUEXV.js";import{C as Q,a as V,b as j,c as J}from"./CToaster-BmyxsD3g.js";import{C as w,a as L}from"./CCardBody-40k0tZjq.js";import{C as W,a as X,b as F,c as N,d as Y,e as R}from"./CTable-CF2NB-O5.js";import{C as Z}from"./DefaultLayout-Ce1NCKt0.js";import{C as ee,a as te,b as ae,c as re}from"./CModalHeader-BjwXGJ0z.js";import{C as ne}from"./CNav-De69_Mqz.js";import{e as B,f as _}from"./CNavItem-8e7SXcnn.js";import"./CFormControlWrapper-BsUibFdB.js";import"./CCloseButton-Bt_Fn3tX.js";import"./index.esm-RoxhmY7x.js";import"./cil-user-Ddrdy7PS.js";import"./index-DUVNt038.js";const d=({label:l,type:r="text",name:s,value:P,onChange:E,placeholder:b="",required:C=!1,options:T=[],rows:g=3,disabled:f=!1})=>r==="textarea"?e.createElement(H,{label:l,name:s,value:P,onChange:E,placeholder:b,required:C,rows:g,disabled:f,"aria-label":l}):r==="select"?e.createElement(G,{label:l,name:s,value:P,onChange:E,required:C,disabled:f,"aria-label":l},e.createElement("option",{value:""},"Select ",l),T.map((u,v)=>e.createElement("option",{key:v,value:u},u))):e.createElement(K,{type:r,name:s,value:P,onChange:E,placeholder:b,label:l,required:C,disabled:f,"aria-label":l});d.propTypes={label:m.string.isRequired,type:m.oneOf(["text","number","date","textarea","select"]),name:m.string.isRequired,value:m.oneOfType([m.string,m.number]).isRequired,onChange:m.func.isRequired,placeholder:m.string,required:m.bool,options:m.arrayOf(m.string),rows:m.number,disabled:m.bool};const le="https://backend-log2.axleshift.com",ce=`${le}/api/v1/procurement`,se=()=>{const{accessToken:l}=$(),[r,s]=p.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[P,E]=p.useState([]),[b,C]=p.useState(!1),[T,g]=p.useState("PHP"),f=["PHP","USD","EUR","GBP","JPY"],u=a=>{const{name:n,value:t}=a.target;s(o=>({...o,[n]:t}))},v=(a,n)=>{const{name:t,value:o}=n.target,y=[...r.products];y[a]={...y[a],[t]:t==="quantity"||t==="unitPrice"?o===""?"":parseFloat(o):o};const O=y.reduce((k,x)=>k+(x.unitPrice||0)*(x.quantity||0),0);s(k=>({...k,products:y,estimatedCost:parseFloat(O.toFixed(2))}))},c=()=>{s(a=>({...a,products:[...a.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},q=a=>{const n=r.products.filter((t,o)=>o!==a);s(t=>({...t,products:n,estimatedCost:n.reduce((o,y)=>o+(y.unitPrice*y.quantity||0),0)}))},M=async a=>{var n,t;if(a.preventDefault(),!b){C(!0);try{if(!l)throw new Error("Authentication error. Please log in again.");const o={Authorization:`Bearer ${l}`,"Content-Type":"application/json"},y={...r,deliveryDate:r.deliveryDate?new Date(r.deliveryDate).toISOString():null};await S.post(ce,y,{headers:o}),s({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),A("âœ… Procurement Request created successfully! Wait for Approval","success")}catch(o){A(((t=(n=o.response)==null?void 0:n.data)==null?void 0:t.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{C(!1)}}},A=(a,n)=>{E(t=>[...t,{id:Date.now(),message:a,color:n}]),setTimeout(()=>E(t=>t.slice(1)),5e3)};return e.createElement("form",{onSubmit:M},e.createElement(D,{className:"mb-3"},e.createElement(i,{md:6},e.createElement(d,{label:"Title",name:"title",value:r.title,onChange:u,required:!0})),e.createElement(i,{md:6},e.createElement(d,{label:"Procurement Date",type:"date",name:"procurementDate",value:r.procurementDate,onChange:u,required:!0}))),e.createElement(d,{label:"Description",type:"textarea",name:"description",value:r.description,onChange:u,required:!0,rows:3}),e.createElement(D,{className:"mb-3"},e.createElement(i,{md:6},e.createElement(d,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:r.deliveryDate,onChange:u})),e.createElement(i,{md:6},e.createElement(d,{label:"Department",type:"select",name:"department",value:r.department,onChange:u,options:["HR","Finance","Logistics","IT","Procurement","Operations"],required:!0}))),e.createElement("h5",null,"Products"),r.products.map((a,n)=>e.createElement(D,{key:n,className:"mb-2"},e.createElement(i,{md:2},e.createElement(d,{label:"Product Name",name:"name",value:a.name,onChange:t=>v(n,t),required:!0})),e.createElement(i,{md:2},e.createElement(d,{label:"Quantity",type:"number",name:"quantity",value:a.quantity,min:"0",onChange:t=>v(n,t),required:!0})),e.createElement(i,{md:2},e.createElement(d,{label:"Unit",type:"select",name:"unit",value:a.unit,onChange:t=>v(n,t),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(i,{md:2},e.createElement(d,{label:"Unit Price",type:"number",name:"unitPrice",value:a.unitPrice,min:"0",onChange:t=>v(n,t),required:!0})),e.createElement(D,{className:"mt-3"},e.createElement(i,{md:6},e.createElement("label",{htmlFor:"currency"},"Select Currency:"),e.createElement("select",{id:"currency",value:T,onChange:t=>g(t.target.value),className:"form-control"},f.map(t=>e.createElement("option",{key:t,value:t},t))))),e.createElement(D,{className:"mt-3 text-end"},e.createElement(i,null,e.createElement("h5",null,"Estimated Cost: ",T," ",r.estimatedCost.toFixed(2)))),e.createElement(i,{md:2},e.createElement(h,{color:"danger",onClick:()=>q(n)},"Remove")))),e.createElement(D,{className:"mt-3"},e.createElement(i,{md:6},e.createElement(h,{color:"primary",onClick:c},"Add Product"))),e.createElement(D,{className:"mt-4"},e.createElement(i,{md:12,className:"text-center"},e.createElement(h,{color:"success",type:"submit",disabled:b},b?e.createElement(U,{size:"sm"}):"Create Procurement"))),e.createElement(Q,{placement:"top-end"},P.map(a=>e.createElement(V,{key:a.id,autohide:!0,visible:!0,color:a.color},e.createElement(j,{closeButton:!0},a.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(J,null,a.message)))))},I="https://backend-log2.axleshift.com/api/v1/procurement",oe=()=>{const l=z(),{user:r,accessToken:s}=$(),[P,E]=p.useState([]),[b,C]=p.useState(!0),[T,g]=p.useState(!1),[f,u]=p.useState(null);p.useEffect(()=>{(async()=>{if(!s){console.error("No authentication token found"),C(!1);return}try{const q=await S.get(I,{headers:{Authorization:`Bearer ${s}`}});console.log("Procurements Data:",q.data),E(q.data)}catch(q){console.error("Error fetching procurements:",q)}finally{C(!1)}})()},[s]);const v=async()=>{if(!(!f||!s))try{await S.delete(`${I}/${f}`,{headers:{Authorization:`Bearer ${s}`}}),E(P.filter(c=>c._id!==f)),g(!1)}catch(c){console.error("Error deleting procurement:",c),alert("Failed to delete procurement.")}};return e.createElement(w,null,e.createElement(L,null,e.createElement("h5",null,"Procurement Requests"),e.createElement(W,{responsive:!0},e.createElement(X,null,e.createElement(F,null,e.createElement(N,null,"Title"),e.createElement(N,null,"Department"),e.createElement(N,null,"Status"),e.createElement(N,null,"Actions"))),e.createElement(Y,null,P.map(c=>e.createElement(F,{key:c._id},e.createElement(R,null,c.title),e.createElement(R,null,c.department),e.createElement(R,null,e.createElement(Z,{color:c.status==="Approved"?"success":"warning"},c.status)),e.createElement(R,{className:"text-center"},e.createElement(h,{color:"info",size:"sm",onClick:()=>l(`/procurement/${c._id}`)},"View")," ",e.createElement(h,{color:"danger",size:"sm",onClick:()=>{u(c._id),g(!0)}},"Delete")," ",c.status==="Approved"&&e.createElement(h,{color:"primary",size:"sm",onClick:()=>l(`/rfq/create/${c._id}`)},"Create RFQ"))))))),e.createElement(ee,{visible:T,onClose:()=>g(!1)},e.createElement(te,null,"Confirm Deletion"),e.createElement(ae,null,"Are you sure you want to delete this procurement request?"),e.createElement(re,null,e.createElement(h,{color:"secondary",onClick:()=>g(!1)},"Cancel"),e.createElement(h,{color:"danger",onClick:v},"Delete"))))},ke=()=>{const[l,r]=p.useState("create");return e.createElement("div",{className:"p-4"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(w,{className:"mb-4"},e.createElement(ne,{variant:"tabs",role:"tablist"},e.createElement(B,null,e.createElement(_,{active:l==="create",onClick:()=>r("create"),style:{cursor:"pointer"}},e.createElement("i",{className:"fas fa-plus-circle me-2"})," New Procurement")),e.createElement(B,null,e.createElement(_,{active:l==="list",onClick:()=>r("list"),style:{cursor:"pointer"}},e.createElement("i",{className:"fas fa-list me-2"})," View Procurements")))),e.createElement(w,null,e.createElement(L,null,l==="create"?e.createElement(se,null):e.createElement(oe,null))))};export{ke as default};
