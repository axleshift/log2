import{R as e,P as c,u as Q,n as G,r as m,C as X}from"./index-QHt0BNF-.js";import{a as x}from"./index-xsH4HHeE.js";import{C as J}from"./CFormTextarea-OgHKVdzt.js";import{C as I}from"./CFormSelect-BKzCe16h.js";import{a as M}from"./CFormInput-BdJGZwOp.js";import{c as E,a as g,b as s}from"./CRow-Ce6guADD.js";import{l as W,m as Y,n as Z,e as ee,f as te,g as _,h as w,j as ae,k as R}from"./CTable-DhIoX8qk.js";import{C as re,a as ne}from"./CCardBody-DTdIa86a.js";import{C as le,a as se,b as oe,c as ce,d as me}from"./DefaultLayout-B8VGAksF.js";import"./CCloseButton-DubpZP9d.js";import"./CForm-B7FIKFam.js";import"./index.esm-D1lQqmIc.js";import"./CCardHeader-BvbB9qDc.js";import"./CAlert-ZjTU6H8E.js";import"./cil-user-Ddrdy7PS.js";import"./index-C0QOyGfk.js";const u=({label:l,type:b="text",name:C,value:n,onChange:i,placeholder:D="",required:p=!1,options:P=[],rows:S=3,disabled:f=!1})=>b==="textarea"?e.createElement(J,{label:l,name:C,value:n,onChange:i,placeholder:D,required:p,rows:S,disabled:f,"aria-label":l}):b==="select"?e.createElement(I,{label:l,name:C,value:n,onChange:i,required:p,disabled:f,"aria-label":l},e.createElement("option",{value:""},"Select ",l),P.map((y,A)=>e.createElement("option",{key:A,value:y},y))):e.createElement(M,{type:b,name:C,value:n,onChange:i,placeholder:D,label:l,required:p,disabled:f,"aria-label":l});u.propTypes={label:c.string.isRequired,type:c.oneOf(["text","number","date","textarea","select"]),name:c.string.isRequired,value:c.oneOfType([c.string,c.number]).isRequired,onChange:c.func.isRequired,placeholder:c.string,required:c.bool,options:c.arrayOf(c.string),rows:c.number,disabled:c.bool};const ue="https://backend-log2.axleshift.com",L=`${ue}/api/v1/procurement`,ie=()=>{const{accessToken:l,user:b}=Q(),C=G(),[n,i]=m.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[D,p]=m.useState([]),[P,S]=m.useState(!1),[f,y]=m.useState(!1),[A,F]=m.useState([]),[de,pe]=m.useState(!1),[Ee,Ce]=m.useState(null),[T,$]=m.useState(""),[N,O]=m.useState("All"),j=A.filter(t=>{const a=t.title.toLowerCase().includes(T.toLowerCase())||t.department.toLowerCase().includes(T.toLowerCase())||t.status.toLowerCase().includes(T.toLowerCase()),r=N==="All"||t.status.toLowerCase()===N.toLowerCase();return a&&r});m.useEffect(()=>{(async()=>{if(l)try{const a=await x.get(L,{headers:{Authorization:`Bearer ${l}`}});F(a.data)}catch(a){console.error("Error fetching procurements:",a)}})()},[l]);const h=t=>{const{name:a,value:r}=t.target;i(o=>({...o,[a]:r}))},q=(t,a)=>{const{name:r,value:o}=a.target,d=[...n.products];d[t]={...d[t],[r]:r==="quantity"||r==="unitPrice"?o===""?"":parseFloat(o):o};const k=d.reduce((v,z)=>v+(z.unitPrice||0)*(z.quantity||0),0);i(v=>({...v,products:d,estimatedCost:parseFloat(k.toFixed(2))}))},H=()=>{i(t=>({...t,products:[...t.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},U=t=>{const a=n.products.filter((r,o)=>o!==t);i(r=>({...r,products:a,estimatedCost:a.reduce((o,d)=>o+(d.unitPrice*d.quantity||0),0)}))},V=async t=>{var a,r;if(t.preventDefault(),!P){S(!0);try{if(!l)throw new Error("Authentication error. Please log in again.");const o={Authorization:`Bearer ${l}`,"Content-Type":"application/json"},d={...n,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null},k=await x.post(L,d,{headers:o});F(v=>[...v,k.data]),i({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),y(!1),B("âœ… Procurement Request created successfully!","success")}catch(o){B(((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{S(!1)}}},K=async t=>{if(!(!t||!l))try{await x.delete(`${L}/${t}`,{headers:{Authorization:`Bearer ${l}`}}),F(a=>a.filter(r=>r._id!==t)),p(a=>[...a,{id:Date.now(),color:"success",message:"Procurement deleted successfully"}])}catch(a){console.error("Error deleting procurement:",a),p(r=>[...r,{id:Date.now(),color:"danger",message:"Failed to delete procurement"}])}},B=(t,a)=>{p(r=>[...r,{id:Date.now(),message:t,color:a}]),setTimeout(()=>p(r=>r.slice(1)),5e3)};return e.createElement(e.Fragment,null,e.createElement(E,{color:"primary",onClick:()=>y(!0),className:"mb-3"},"+ Create Procurement"),e.createElement(W,{visible:f,onClose:()=>y(!1),size:"lg"},e.createElement(Y,null,"Create Procurement Request"),e.createElement(Z,null,e.createElement("form",{onSubmit:V},e.createElement(g,{className:"mb-3"},e.createElement(s,{md:6},e.createElement(u,{label:"Title",name:"title",value:n.title,onChange:h,required:!0})),e.createElement(s,{md:6},e.createElement(u,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:h,required:!0}))),e.createElement(u,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:h,required:!0,rows:3}),e.createElement(g,{className:"mb-3"},e.createElement(s,{md:6},e.createElement(u,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:h})),e.createElement(s,{md:6},e.createElement(u,{label:"Department",type:"select",name:"department",value:n.department,onChange:h,options:["HR","Finance","Logistics","IT","Procurement"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((t,a)=>e.createElement(g,{key:a,className:"mb-2"},e.createElement(s,{md:2},e.createElement(u,{label:"Product Name",name:"name",value:t.name,onChange:r=>q(a,r),required:!0})),e.createElement(s,{md:2},e.createElement(u,{label:"Quantity",type:"number",name:"quantity",value:t.quantity,min:"0",onChange:r=>q(a,r),required:!0})),e.createElement(s,{md:2},e.createElement(u,{label:"Unit",type:"select",name:"unit",value:t.unit,onChange:r=>q(a,r),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(s,{md:2},e.createElement(u,{label:"Unit Price",type:"number",name:"unitPrice",value:t.unitPrice,min:"0",onChange:r=>q(a,r),required:!0})),e.createElement(s,{md:2},e.createElement(E,{color:"danger",onClick:()=>U(a)},"Remove")))),e.createElement(g,{className:"mt-3"},e.createElement(s,{md:6},e.createElement(E,{color:"primary",onClick:H},"Add Product"))),e.createElement(g,{className:"mt-3 text-end"},e.createElement(s,null,e.createElement("h5",null,"Estimated Cost: ",n.estimatedCost.toFixed(2)))),e.createElement(g,{className:"mt-4"},e.createElement(s,{md:12,className:"text-center"},e.createElement(E,{color:"success",type:"submit",disabled:P},P?e.createElement(X,{size:"sm"}):"Submit")))))),e.createElement(re,null,e.createElement(ne,null,e.createElement("h5",null,"Procurement Requests"),e.createElement(g,{className:"mb-3"},e.createElement(s,{md:6},e.createElement(M,{type:"text",placeholder:"Search by title, department or status",value:T,onChange:t=>$(t.target.value)})),e.createElement(s,{md:3},e.createElement(I,{value:N,onChange:t=>O(t.target.value)},e.createElement("option",{value:"All"},"All Statuses"),e.createElement("option",{value:"Pending"},"Pending"),e.createElement("option",{value:"Approved"},"Approved"),e.createElement("option",{value:"Rejected"},"Rejected")))),e.createElement(ee,{responsive:!0},e.createElement(te,null,e.createElement(_,null,e.createElement(w,null,"Title"),e.createElement(w,null,"Department"),e.createElement(w,null,"Status"),e.createElement(w,null,"Actions"))),e.createElement(ae,null,j.map(t=>e.createElement(_,{key:t._id},e.createElement(R,null,t.title),e.createElement(R,null,t.department),e.createElement(R,null,e.createElement(le,{color:t.status==="Approved"?"success":t.status==="Rejected"?"danger":"warning"},t.status)),e.createElement(R,{className:"text-center"},e.createElement(E,{color:"info",size:"sm",onClick:()=>C(`/procurement/${t._id}`)},"View")," ",t.status==="Approved"&&e.createElement(e.Fragment,null,e.createElement(E,{color:"primary",size:"sm",onClick:()=>C(`/rfq/create/${t._id}`)},"Create RFQ")," ",e.createElement(E,{color:"success",size:"sm",onClick:()=>C("/procurement/po-payments")},"Create PO")),e.createElement(E,{color:"danger",size:"sm",onClick:()=>K(t._id)},"Delete")))))))),e.createElement(se,{placement:"top-end"},D.map(t=>e.createElement(oe,{key:t.id,autohide:!0,visible:!0,color:t.color},e.createElement(ce,{closeButton:!0},t.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(me,null,t.message)))))},ke=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(ie,null));export{ke as default};
