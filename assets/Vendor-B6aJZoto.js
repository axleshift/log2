import{u as G,r as l,R as e,C as J,L as K}from"./index-Czk1en48.js";import{a as E}from"./index-xsH4HHeE.js";import{C as X,a as Z}from"./CCardBody-Fly4LOGC.js";import{C as ee}from"./CCardHeader-DYgh3k3A.js";import{C as w}from"./CAlert-DUOQnrT6.js";import{e as te,f as ae,g as N,h as c,j as se,k as C,l as re,m as le,n as oe,o as ne}from"./CTable-D_U4Alk1.js";import{c as h,a as R,b as i}from"./CRow-COWDqcej.js";import{C as b,a as A}from"./CFormInput-BMJoeGH4.js";import{C as D}from"./CFormTextarea-CbFIJlat.js";import{a as ce,b as me,c as ie,d as de}from"./DefaultLayout-RSXezbv-.js";import"./CCloseButton-jv1sHiMY.js";import"./CFormSelect-DbfrKTkb.js";import"./CForm-DpxG6y2y.js";import"./index.esm-Cuh8qHpg.js";import"./cil-user-Ddrdy7PS.js";import"./index-lIfIVm9I.js";const L="https://backend-log2.axleshift.com",_=`${L}/api/v1/rfq`,$=`${L}/api/v1/vendor-quotes`,Re=()=>{var v;const{accessToken:n}=G(),[y,k]=l.useState([]),[x,B]=l.useState(!0),[S,P]=l.useState(null),[I,T]=l.useState([]),[z,d]=l.useState(!1),[o,f]=l.useState({price:"",details:"",status:"Pending"}),[m,M]=l.useState(null),[F,Q]=l.useState(!1),[q,H]=l.useState({}),u=(t,a="success")=>{const s=Date.now();T(r=>[...r,{id:s,message:t,color:a}]),setTimeout(()=>{T(r=>r.filter(Y=>Y.id!==s))},4e3)},V=async t=>{try{return(await E.get(`${$}/status/${t}`,{headers:{Authorization:`Bearer ${n}`}})).data.status||"Not Submitted"}catch{return"Not Submitted"}},U=async t=>{const a={};await Promise.all(t.map(async s=>{const r=await V(s._id);a[s._id]=r})),H(a)},g=async()=>{var t,a;try{const r=(await E.get(`${_}/vendor/rfqs`,{headers:{Authorization:`Bearer ${n}`}})).data.rfqs||[];k(r),U(r)}catch(s){P(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to load RFQs.")}finally{B(!1)}};l.useEffect(()=>{n&&g()},[n]);const j=t=>{M(t),f({price:"",details:"",leadTime:"",terms:"",status:"Pending"}),d(!0)},p=t=>{const{name:a,value:s}=t.target;f(r=>({...r,[a]:s}))},O=async t=>{if(t.preventDefault(),!!m){Q(!0);try{await E.post($,{rfqId:m._id,price:o.price,details:o.details,leadTime:o.leadTime,terms:o.terms,status:o.status},{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),u("Quote submitted!","success"),d(!1),f({price:"",details:"",leadTime:"",terms:"",status:"Pending"}),g()}catch(a){console.error(a),u("Failed to submit quote","danger")}finally{Q(!1)}}},W=async t=>{try{await E.delete(`${_}/${t}`,{headers:{Authorization:`Bearer ${n}`}}),u("RFQ deleted!","success"),g()}catch(a){console.error("Delete failed:",a),u("Failed to delete RFQ","danger")}};return e.createElement(X,{className:"shadow-sm"},e.createElement(ee,{className:"bg-primary text-white fw-bold"},"Your RFQs"),e.createElement(Z,null,x?e.createElement("div",{className:"text-center my-3"},e.createElement(J,{color:"primary"})):S?e.createElement(w,{color:"danger",className:"text-center"},S):y.length===0?e.createElement(w,{color:"warning",className:"text-center"},"No RFQs available."):e.createElement(te,{striped:!0,hover:!0,responsive:!0},e.createElement(ae,{color:"light"},e.createElement(N,null,e.createElement(c,null,"#"),e.createElement(c,null,"Title"),e.createElement(c,null,"Due Date"),e.createElement(c,null,"Quote Status"),e.createElement(c,null,"Action"))),e.createElement(se,null,y.map((t,a)=>{var s;return e.createElement(N,{key:t._id},e.createElement(c,null,a+1),e.createElement(C,null,((s=t.procurementId)==null?void 0:s.title)||"N/A"),e.createElement(C,null,t.deadline?new Date(t.deadline).toLocaleDateString():"N/A"),e.createElement(C,null,q[t._id]||"Loading..."),e.createElement(C,null,e.createElement(K,{to:`/vendor/rfqs/${t._id}`,className:"btn btn-sm btn-primary me-2"},"View Details"),e.createElement(h,{color:"success",size:"sm",onClick:()=>j(t),className:"me-2"},"Submit Quote"),e.createElement(h,{color:"danger",size:"sm",onClick:()=>W(t._id)},"Delete")))})))),e.createElement(re,{visible:z,onClose:()=>d(!1),scrollable:!0},e.createElement(le,null,e.createElement("strong",null,"Submit Quote for"),"Â ",((v=m==null?void 0:m.procurementId)==null?void 0:v.title)||"RFQ"),e.createElement(oe,null,e.createElement("form",{onSubmit:O},e.createElement(R,{className:"mb-3"},e.createElement(i,{md:12,className:"mb-3"},e.createElement(b,{htmlFor:"price"},"Price"),e.createElement(A,{id:"price",name:"price",type:"number",value:o.price,onChange:p,required:!0,placeholder:"Enter your quote price"})),e.createElement(i,{md:12,className:"mb-3"},e.createElement(b,{htmlFor:"details"},"Details / Description"),e.createElement(D,{id:"details",name:"details",value:o.details,onChange:p,rows:3,placeholder:"Provide additional details if any"})),e.createElement(i,{md:12,className:"mb-3"},e.createElement(b,{htmlFor:"leadTime"},"Lead Time"),e.createElement(A,{id:"leadTime",name:"leadTime",value:o.leadTime,onChange:p,placeholder:"e.g. 2 weeks"})),e.createElement(i,{md:12,className:"mb-3"},e.createElement(b,{htmlFor:"terms"},"Terms & Conditions"),e.createElement(D,{id:"terms",name:"terms",value:o.terms,onChange:p,rows:2,placeholder:"Specify payment or delivery terms"}))),e.createElement(R,{className:"text-center mb-2"},e.createElement(i,null,e.createElement(h,{color:"primary",type:"submit",disabled:F},F?"Submitting...":"Submit Quote"))))),e.createElement(ne,null,e.createElement(h,{color:"secondary",onClick:()=>d(!1)},"Cancel"))),e.createElement(ce,{placement:"top-end"},I.map(t=>e.createElement(me,{key:t.id,autohide:!0,visible:!0,color:t.color},e.createElement(ie,{closeButton:!0},t.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(de,null,t.message)))))};export{Re as default};
