import{y as F,i as M,k as N,r as n,R as e,C as h}from"./index-DCTHaFCh.js";import{a as y}from"./index-DZUceCzt.js";import{C as x,a as U}from"./CCardBody-DWVkspug.js";import{C as L}from"./CCardHeader-A3rtQPdf.js";import{b as s}from"./CContainer-DSBAt5Fg.js";import{C as H}from"./DefaultLayout-Bu9Wv437.js";import{C as I,a as q,b as v,c as E,d as _,e as m}from"./CTable-DbHnHrn7.js";import{C as z,a as O,b as Q,c as G}from"./CModalHeader-BR416Z4s.js";import{C as J}from"./CFormTextarea-CqWCZtpo.js";import"./index.esm-DX0506rN.js";import"./CNavItem-CRpCac94.js";import"./CCloseButton-CNDsuIa_.js";import"./cil-user-Ddrdy7PS.js";import"./index-DzmVUv2x.js";import"./CFormControlWrapper-BHxeIyv8.js";const P="https://backend-log2.axleshift.com/api/v1/procurement",me=()=>{var j,S;const{id:c}=F(),k=M(),{user:o}=N(),[t,p]=n.useState(null),[T,C]=n.useState(!0),[R,D]=n.useState(null),[w,u]=n.useState(!1),[f,b]=n.useState(""),[i,d]=n.useState(!1);n.useEffect(()=>{(async()=>{var l,r;if(!c){D("Invalid Procurement ID"),C(!1);return}try{C(!0);const g=await y.get(`${P}/${c}`);p(g.data)}catch(g){D(((r=(l=g.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to load Procurement")}finally{C(!1)}})()},[c]);const A=async()=>{var a,l;try{d(!0),await y.patch(`${P}/${c}/approve`),p(r=>({...r,status:"Approved"}))}catch(r){alert(((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to approve procurement")}finally{d(!1)}},B=async()=>{var a,l;if(!f.trim()){alert("Please provide a rejection reason.");return}try{d(!0),await y.patch(`${P}/${c}/reject`,{reason:f}),p(r=>({...r,status:"Rejected"})),u(!1),b("")}catch(r){alert(((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to reject procurement")}finally{d(!1)}};if(T)return e.createElement(h,{color:"primary"});if(R)return e.createElement("div",null,R);if(!t)return e.createElement("div",null,"No Procurement found.");const $=(o==null?void 0:o.role)==="super admin"||(o==null?void 0:o.role)==="admin";return e.createElement(x,null,e.createElement(L,null,e.createElement("h5",null,"Procurement Details"),e.createElement(s,{color:"secondary",onClick:()=>k(-1)},"Back to Procurement List")),e.createElement(U,null,e.createElement("h6",null,e.createElement("strong",null,"Procurement ID:")," ",t._id),e.createElement("h6",null,e.createElement("strong",null,"Title:")," ",t.title),e.createElement("h6",null,e.createElement("strong",null,"Department:")," ",t.department),e.createElement("h6",null,e.createElement("strong",null,"Status:")," ",e.createElement(H,{color:t.status==="Pending"?"warning":t.status==="Approved"?"success":"danger"},t.status)),e.createElement("h6",null,e.createElement("strong",null,"Requested By:")," ",((j=t.requestedBy)==null?void 0:j.email)||"Unknown"),e.createElement("h6",null,e.createElement("strong",null,"Procurement Date:")," ",new Date(t.procurementDate).toLocaleDateString()),e.createElement("h6",null,e.createElement("strong",null,"Delivery Date:")," ",new Date(t.deliveryDate).toLocaleDateString()),e.createElement("hr",null),e.createElement("h6",null,e.createElement("strong",null,"Products")),e.createElement(I,{hover:!0,responsive:!0},e.createElement(q,null,e.createElement(v,null,e.createElement(E,null,"Name"),e.createElement(E,null,"Quantity"),e.createElement(E,null,"Unit"),e.createElement(E,null,"Unit Price"))),e.createElement(_,null,((S=t.products)==null?void 0:S.length)>0?t.products.map((a,l)=>{var r;return e.createElement(v,{key:l},e.createElement(m,null,a.name),e.createElement(m,null,a.quantity),e.createElement(m,null,a.unit),e.createElement(m,null,"$",((r=a.unitPrice)==null?void 0:r.toFixed(2))||"N/A"))}):e.createElement(v,null,e.createElement(m,{colSpan:"4"},"No products added yet.")))),e.createElement("hr",null),$&&t.status==="Pending"&&e.createElement(e.Fragment,null,e.createElement(s,{color:"success",className:"me-2",onClick:A,disabled:i},i?e.createElement(h,{size:"sm"}):"Approve"),e.createElement(s,{color:"danger",onClick:()=>u(!0),disabled:i},i?e.createElement(h,{size:"sm"}):"Reject")),e.createElement(z,{visible:w,onClose:()=>u(!1)},e.createElement(O,null,"Reject Procurement"),e.createElement(Q,null,e.createElement(J,{placeholder:"Enter rejection reason...",value:f,onChange:a=>b(a.target.value)})),e.createElement(G,null,e.createElement(s,{color:"secondary",onClick:()=>u(!1)},"Cancel"),e.createElement(s,{color:"danger",onClick:B},"Confirm Reject")))))};export{me as default};
