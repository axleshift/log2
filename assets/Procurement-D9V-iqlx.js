import{R as e,P as o,k as N,r as T,C as S}from"./index-qAjInVaZ.js";import{a as w}from"./index-DW_MHI2K.js";import{C as F}from"./CFormTextarea-2DZZG0GA.js";import{C as k}from"./CFormSelect-Yo1M0Qcj.js";import{C as A}from"./CFormInput-DahtiFNR.js";import{C as g,a as i}from"./CRow-CktHiRio.js";import{b as R}from"./CContainer-CPP8_u0b.js";import{C as O,a as I,b as B,c as L}from"./CToaster-BO0Z4rBw.js";import"./CFormControlWrapper-DILRo1BL.js";import"./CCloseButton-Bpa28C6a.js";import"./CNavItem-BK7iTdnI.js";const l=({label:m,type:n="text",name:u,value:P,onChange:E,placeholder:C,required:d=!1,options:p=[],rows:y,disabled:f=!1})=>n==="textarea"?e.createElement(F,{label:m,name:u,value:P,onChange:E,placeholder:C,required:d,rows:y,disabled:f,"aria-label":m}):n==="select"?e.createElement(k,{label:m,name:u,value:P,onChange:E,required:d,disabled:f,"aria-label":m},e.createElement("option",{value:""},"Select ",m),p.map((b,h)=>e.createElement("option",{key:h,value:b},b))):e.createElement(A,{type:n,name:u,value:P,onChange:E,placeholder:C,label:m,required:d,disabled:f,"aria-label":m});l.propTypes={label:o.string.isRequired,type:o.oneOf(["text","number","date","textarea","select"]),name:o.string.isRequired,value:o.oneOfType([o.string,o.number]).isRequired,onChange:o.func.isRequired,placeholder:o.string,required:o.bool,options:o.arrayOf(o.string),rows:o.number,disabled:o.bool};l.defaultProps={type:"text",placeholder:"",required:!1,options:[],rows:3,disabled:!1};const U="https://backend-log2.axleshift.com",_=`${U}/api/v1/procurement`,z=()=>{const{accessToken:m}=N(),[n,u]=T.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[P,E]=T.useState([]),[C,d]=T.useState(!1),p=a=>{const{name:r,value:t}=a.target;u(c=>({...c,[r]:t}))},y=(a,r)=>{const{name:t,value:c}=r.target,s=[...n.products];s[a]={...s[a],[t]:t==="quantity"||t==="unitPrice"?c===""?"":parseFloat(c):c};const q=s.reduce((D,x)=>D+(x.unitPrice||0)*(x.quantity||0),0);u(D=>({...D,products:s,estimatedCost:parseFloat(q.toFixed(2))}))},f=()=>{u(a=>({...a,products:[...a.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},b=a=>{const r=n.products.filter((t,c)=>c!==a);u(t=>({...t,products:r,estimatedCost:r.reduce((c,s)=>c+(s.unitPrice*s.quantity||0),0)}))},h=async a=>{var t,c;if(a.preventDefault(),C)return;if(d(!0),!n.products.every(s=>s.name&&s.quantity>0&&s.unit&&s.unitPrice>=0)){v("ðŸš¨ Please fill in all product details including unit.","danger"),d(!1);return}try{if(!m)throw new Error("Authentication error. Please log in again.");const s={Authorization:`Bearer ${m}`,"Content-Type":"application/json"},q={...n,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null};await w.post(_,q,{headers:s}),u({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),v("ðŸŽ‰ Procurement successfully created!","success")}catch(s){v(((c=(t=s.response)==null?void 0:t.data)==null?void 0:c.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{d(!1)}},v=(a,r)=>{E(t=>[...t,{id:Date.now(),message:a,color:r}]),setTimeout(()=>E(t=>t.slice(1)),5e3)};return e.createElement("form",{onSubmit:h},e.createElement(g,{className:"mb-3"},e.createElement(i,{md:6},e.createElement(l,{label:"Title",name:"title",value:n.title,onChange:p,required:!0})),e.createElement(i,{md:6},e.createElement(l,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:p,required:!0}))),e.createElement(l,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:p,required:!0,rows:3}),e.createElement(g,{className:"mb-3"},e.createElement(i,{md:6},e.createElement(l,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:p})),e.createElement(i,{md:6},e.createElement(l,{label:"Department",type:"select",name:"department",value:n.department,onChange:p,options:["HR","Finance","Logistics","IT","Procurement","Operations"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((a,r)=>e.createElement(g,{key:r,className:"mb-2"},e.createElement(i,{md:2},e.createElement(l,{label:"Product Name",name:"name",value:a.name,onChange:t=>y(r,t),required:!0})),e.createElement(i,{md:2},e.createElement(l,{label:"Quantity",type:"number",name:"quantity",value:a.quantity,min:"0",onChange:t=>y(r,t),required:!0})),e.createElement(i,{md:2},e.createElement(l,{label:"Unit",type:"select",name:"unit",value:a.unit,onChange:t=>y(r,t),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(i,{md:2},e.createElement(l,{label:"Unit Price",type:"number",name:"unitPrice",value:a.unitPrice,min:"0",onChange:t=>y(r,t),required:!0})),e.createElement(i,{md:2},e.createElement(R,{color:"danger",onClick:()=>b(r)},"Remove")))),e.createElement(g,{className:"mt-3"},e.createElement(i,{md:6},e.createElement(R,{color:"primary",onClick:f},"Add Product")),e.createElement(i,{md:6,className:"text-end"},e.createElement("h5",null,"Estimated Cost: â‚±",n.estimatedCost.toFixed(2)))),e.createElement(g,{className:"mt-4"},e.createElement(i,{md:12,className:"text-center"},e.createElement(R,{color:"success",type:"submit",disabled:C},C?e.createElement(S,{size:"sm"}):"Create Procurement"))),e.createElement(O,{placement:"top-end"},P.map(({id:a,message:r,color:t})=>e.createElement(I,{key:a,color:t,autohide:!0,visible:!0},e.createElement(B,{closeButton:!0},"Notification"),e.createElement(L,null,r)))))},Y=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4"},"Procurement Process"),e.createElement(z,null));export{Y as default};
