import{r as h,j as e,P as N,h as k,C as E,p as F}from"./index-DEmdhtkv.js";import{a as B,u as I,F as U,c as $}from"./index.esm-DrYYHZ6f.js";import{C as j}from"./index.esm-PQ4dROIH.js";import{C as m}from"./CAlert-DFda796J.js";import{C as q}from"./CForm-BvvF_kaV.js";import{C as n,a as l}from"./CInputGroupText-DGEqc-XL.js";import{C as c}from"./CFormInput-_fbGxJYO.js";import{b as R,a as D}from"./CContainer-l_OEV5c6.js";import{c as S}from"./cil-user-Ddrdy7PS.js";import{C as H,a as Z}from"./CRow-fCwqIY5j.js";import{C as M,a as J}from"./CCardBody-D_V14yWh.js";import{C as G}from"./CFormSelect-BysY0XmE.js";import"./CCloseButton-B-4_Krdy.js";import"./CFormControlWrapper-CnvfyOx9.js";var _=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M469.666,216.45,271.078,33.749a34,34,0,0,0-47.062.98L41.373,217.373,32,226.745V496H208V328h96V496H480V225.958ZM248.038,56.771c.282,0,.108.061-.013.18C247.9,56.832,247.756,56.771,248.038,56.771ZM448,464H336V328a32,32,0,0,0-32-32H208a32,32,0,0,0-32,32V464H64V240L248.038,57.356c.013-.012.014-.023.024-.035L448,240Z' class='ci-primary'/>"],z=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M449.366,89.648l-.685-.428L362.088,46.559,268.625,171.176l43,57.337a88.529,88.529,0,0,1-83.115,83.114l-57.336-43L46.558,362.088l42.306,85.869.356.725.429.684a25.085,25.085,0,0,0,21.393,11.857h22.344A327.836,327.836,0,0,0,461.222,133.386V111.041A25.084,25.084,0,0,0,449.366,89.648Zm-20.144,43.738c0,163.125-132.712,295.837-295.836,295.837h-18.08L87,371.76l84.18-63.135,46.867,35.149h5.333a120.535,120.535,0,0,0,120.4-120.4v-5.333l-35.149-46.866L371.759,87l57.463,28.311Z' class='ci-primary'/>"];function V({email:a,setEmail:o,otpVerified:u,setOtpVerified:w,apiUrl:i}){const[P,T]=h.useState(!1),[f,b]=h.useState(""),[x,p]=h.useState(!1),[g,t]=h.useState({message:"",type:""}),O=async()=>{if(!a){t({message:"Please enter an email address.",type:"danger"});return}p(!0),t({message:"",type:""});try{const r=await fetch(`${i}/register/send-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})});if(r.ok)T(!0),t({message:"OTP sent to your email. Check your inbox.",type:"success"});else{const y=await r.json();t({message:y.message,type:"danger"})}}catch{t({message:"Network error. Please try again later.",type:"danger"})}finally{p(!1)}},C=async()=>{if(!f){t({message:"Please enter the OTP.",type:"danger"});return}p(!0),t({message:"",type:""});try{const r=await fetch(`${i}/register/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,otp:f})});if(r.ok)w(!0),t({message:"OTP verified successfully!",type:"success"});else{const y=await r.json();t({message:y.message,type:"danger"})}}catch{t({message:"Network error. Please try again later.",type:"danger"})}finally{p(!1)}};return e.jsxs(e.Fragment,{children:[g.message&&e.jsx(m,{color:g.type,children:g.message}),!P&&!u?e.jsxs(q,{onSubmit:r=>{r.preventDefault(),O()},children:[e.jsx("h1",{children:"Register"}),e.jsx("p",{className:"text-body-secondary",children:"Enter your email to receive an OTP"}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:"@"}),e.jsx(c,{type:"email",placeholder:"Email",autoComplete:"email",value:a,onChange:r=>o(r.target.value)})]}),e.jsx("div",{className:"d-grid",children:e.jsx(R,{color:"success",type:"submit",disabled:x||!a,children:x?"Sending OTP...":"Send OTP"})})]}):!u&&e.jsxs(q,{onSubmit:r=>{r.preventDefault(),C()},children:[e.jsx("h1",{children:"Verify OTP"}),e.jsx("p",{className:"text-body-secondary",children:"Enter the OTP sent to your email"}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:"OTP"}),e.jsx(c,{type:"text",placeholder:"Enter OTP",value:f,onChange:r=>b(r.target.value)})]}),e.jsx("div",{className:"d-grid",children:e.jsx(R,{color:"success",type:"submit",disabled:x||!f,children:x?"Verifying OTP...":"Verify OTP"})})]})]})}V.propTypes={email:N.string.isRequired,setEmail:N.func.isRequired,otpVerified:N.bool.isRequired,setOtpVerified:N.func.isRequired,apiUrl:N.string.isRequired};function K(){const{register:a,formState:{errors:o}}=B();return e.jsxs("div",{children:[e.jsx("h5",{children:"Vendor Details"}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:e.jsx(j,{icon:_})}),e.jsx(c,{placeholder:"Business Name",...a("businessName",{required:"Business Name is required"})})]}),o.businessName&&e.jsx(m,{color:"danger",children:o.businessName.message}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:e.jsx(j,{icon:S})}),e.jsx(c,{placeholder:"Full Name",...a("fullName",{required:"Full Name is required"})})]}),o.fullName&&e.jsx(m,{color:"danger",children:o.fullName.message}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:"Address"}),e.jsx(c,{placeholder:"Business Address",...a("businessAddress",{required:"Business Address is required"})})]}),o.businessAddress&&e.jsx(m,{color:"danger",children:o.businessAddress.message}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:e.jsx(j,{icon:z})}),e.jsx(c,{placeholder:"Contact Number",...a("contactNumber",{required:"Contact Number is required"})})]}),o.contactNumber&&e.jsx(m,{color:"danger",children:o.contactNumber.message}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:"Certifications"}),e.jsx(c,{placeholder:"Comma separated certifications",...a("certifications")})]}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:"Tax ID"}),e.jsx(c,{placeholder:"Tax ID",...a("taxId")})]})]})}function de(){const a="https://backend-log2.axleshift.com/api/v1/auth",o=I(),{register:u,handleSubmit:w,formState:{errors:i},watch:P,reset:T}=o,f=k(),[b,x]=h.useState(!1),[p,g]=h.useState({message:"",type:""}),[t,O]=h.useState(""),[C,r]=h.useState(!1),y=P("role","user"),A=async s=>{try{const d=await fetch(`${a}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!d.ok){const v=await d.json();throw new Error(v.message||"Registration failed. Please try again.")}return d.json()}catch(d){throw new Error(d.message||"Something went wrong.")}},L=async s=>{x(!0),g({message:"",type:""});try{if(!t)throw new Error("Email verification is required.");const d={firstName:s.firstName,lastName:s.lastName,username:s.username,email:t,password:s.password,role:s.role||"user"};s.role==="vendor"&&(d.vendorDetails={businessName:s.businessName,fullName:s.fullName,businessAddress:s.businessAddress,contactNumber:s.contactNumber,certifications:s.certifications?s.certifications.split(","):[],taxId:s.taxId});const v=await A(d);F.set("token",v.accessToken,{expires:1}),F.set("refreshToken",v.refreshToken,{expires:1}),g({message:"Registration Successful! Redirecting...",type:"success"}),T(),setTimeout(()=>f("/login"),2e3)}catch(d){g({message:d.message,type:"danger"})}finally{x(!1)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(D,{children:e.jsx(H,{className:"justify-content-center",children:e.jsx(Z,{md:9,lg:7,xl:6,children:e.jsx(M,{className:"mx-4",children:e.jsx(J,{className:"p-4",children:C?e.jsx(U,{...o,children:e.jsxs(q,{onSubmit:w(L),children:[e.jsx("h1",{className:"text-center mb-4",children:"Complete Registration"}),p.message&&e.jsx(m,{color:p.type,children:p.message}),e.jsxs(n,{className:`mb-3 ${i.firstName?"is-invalid":""}`,children:[e.jsx(l,{children:e.jsx(j,{icon:S})}),e.jsx(c,{placeholder:"First Name",...u("firstName",{required:"First Name is required"}),onFocus:s=>s.target.style.borderColor="var(--c-primary)",onBlur:s=>s.target.style.borderColor=""})]}),i.firstName&&e.jsx(m,{color:"danger",children:i.firstName.message}),e.jsxs(n,{className:`mb-3 ${i.lastName?"is-invalid":""}`,children:[e.jsx(l,{children:e.jsx(j,{icon:S})}),e.jsx(c,{placeholder:"Last Name",...u("lastName",{required:"Last Name is required"}),onFocus:s=>s.target.style.borderColor="var(--c-primary)",onBlur:s=>s.target.style.borderColor=""})]}),i.lastName&&e.jsx(m,{color:"danger",children:i.lastName.message}),e.jsxs(n,{className:`mb-3 ${i.username?"is-invalid":""}`,children:[e.jsx(l,{children:e.jsx(j,{icon:S})}),e.jsx(c,{placeholder:"Username",...u("username",{required:"Username is required"}),onFocus:s=>s.target.style.borderColor="var(--c-primary)",onBlur:s=>s.target.style.borderColor=""})]}),i.username&&e.jsx(m,{color:"danger",children:i.username.message}),e.jsxs(n,{className:`mb-3 ${i.password?"is-invalid":""}`,children:[e.jsx(l,{children:e.jsx(j,{icon:$})}),e.jsx(c,{type:"password",placeholder:"Password",...u("password",{required:"Password is required"}),onFocus:s=>s.target.style.borderColor="var(--c-primary)",onBlur:s=>s.target.style.borderColor=""})]}),i.password&&e.jsx(m,{color:"danger",children:i.password.message}),e.jsxs(n,{className:"mb-3",children:[e.jsx(l,{children:"Role"}),e.jsxs(G,{...u("role"),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super admin",children:"Super Admin"}),e.jsx("option",{value:"vendor",children:"Vendor"}),e.jsx("option",{value:"buyer",children:"Buyer"}),e.jsx("option",{value:"finance",children:"Finance"})]})]}),y==="vendor"&&e.jsx(K,{}),e.jsx("div",{className:"d-grid",children:e.jsx(R,{color:"primary",type:"submit",disabled:b,children:b?e.jsx(E,{color:"light"}):"Register"})})]})}):e.jsx(V,{email:t,setEmail:O,otpVerified:C,setOtpVerified:r,apiUrl:a})})})})})})})}export{de as default};
