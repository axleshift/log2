import{R as e,P as o,k,r as h,C as w}from"./index-DQP8N3_v.js";import{a as A}from"./index-C88pvD_q.js";import{C as O}from"./CFormTextarea-hZ1ym61I.js";import{C as U}from"./CFormSelect-ixRPABBg.js";import{C as B}from"./CFormInput-DYRaArhy.js";import{C as p,a as s}from"./CRow-DRxYPhhI.js";import{b as q}from"./CContainer-B5X986nK.js";import{C as I,a as L,b as H,c as _}from"./CToaster-BmlhleyM.js";import"./CFormControlWrapper-BVBkIMxJ.js";import"./CCloseButton-B0Lgjfr_.js";import"./CNavItem-BP7P-adU.js";const l=({label:m,type:n="text",name:i,value:g,onChange:E,placeholder:y="",required:C=!1,options:v=[],rows:b=3,disabled:f=!1})=>n==="textarea"?e.createElement(O,{label:m,name:i,value:g,onChange:E,placeholder:y,required:C,rows:b,disabled:f,"aria-label":m}):n==="select"?e.createElement(U,{label:m,name:i,value:g,onChange:E,required:C,disabled:f,"aria-label":m},e.createElement("option",{value:""},"Select ",m),v.map((d,P)=>e.createElement("option",{key:P,value:d},d))):e.createElement(B,{type:n,name:i,value:g,onChange:E,placeholder:y,label:m,required:C,disabled:f,"aria-label":m});l.propTypes={label:o.string.isRequired,type:o.oneOf(["text","number","date","textarea","select"]),name:o.string.isRequired,value:o.oneOfType([o.string,o.number]).isRequired,onChange:o.func.isRequired,placeholder:o.string,required:o.bool,options:o.arrayOf(o.string),rows:o.number,disabled:o.bool};const z="https://backend-log2.axleshift.com",G=`${z}/api/v1/procurement`,K=()=>{const{accessToken:m}=k(),[n,i]=h.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[g,E]=h.useState([]),[y,C]=h.useState(!1),[v,b]=h.useState("PHP"),f=["PHP","USD","EUR","GBP","JPY"],d=a=>{const{name:r,value:t}=a.target;i(c=>({...c,[r]:t}))},P=(a,r)=>{const{name:t,value:c}=r.target,u=[...n.products];u[a]={...u[a],[t]:t==="quantity"||t==="unitPrice"?c===""?"":parseFloat(c):c};const F=u.reduce((D,T)=>D+(T.unitPrice||0)*(T.quantity||0),0);i(D=>({...D,products:u,estimatedCost:parseFloat(F.toFixed(2))}))},S=()=>{i(a=>({...a,products:[...a.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},N=a=>{const r=n.products.filter((t,c)=>c!==a);i(t=>({...t,products:r,estimatedCost:r.reduce((c,u)=>c+(u.unitPrice*u.quantity||0),0)}))},x=async a=>{var r,t;if(a.preventDefault(),!y){C(!0);try{if(!m)throw new Error("Authentication error. Please log in again.");const c={Authorization:`Bearer ${m}`,"Content-Type":"application/json"},u={...n,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null};await A.post(G,u,{headers:c}),i({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),R("âœ… Procurement Request created successfully! Wait for Approval","success")}catch(c){R(((t=(r=c.response)==null?void 0:r.data)==null?void 0:t.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{C(!1)}}},R=(a,r)=>{E(t=>[...t,{id:Date.now(),message:a,color:r}]),setTimeout(()=>E(t=>t.slice(1)),5e3)};return e.createElement("form",{onSubmit:x},e.createElement(p,{className:"mb-3"},e.createElement(s,{md:6},e.createElement(l,{label:"Title",name:"title",value:n.title,onChange:d,required:!0})),e.createElement(s,{md:6},e.createElement(l,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:d,required:!0}))),e.createElement(l,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:d,required:!0,rows:3}),e.createElement(p,{className:"mb-3"},e.createElement(s,{md:6},e.createElement(l,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:d})),e.createElement(s,{md:6},e.createElement(l,{label:"Department",type:"select",name:"department",value:n.department,onChange:d,options:["HR","Finance","Logistics","IT","Procurement","Operations"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((a,r)=>e.createElement(p,{key:r,className:"mb-2"},e.createElement(s,{md:2},e.createElement(l,{label:"Product Name",name:"name",value:a.name,onChange:t=>P(r,t),required:!0})),e.createElement(s,{md:2},e.createElement(l,{label:"Quantity",type:"number",name:"quantity",value:a.quantity,min:"0",onChange:t=>P(r,t),required:!0})),e.createElement(s,{md:2},e.createElement(l,{label:"Unit",type:"select",name:"unit",value:a.unit,onChange:t=>P(r,t),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(s,{md:2},e.createElement(l,{label:"Unit Price",type:"number",name:"unitPrice",value:a.unitPrice,min:"0",onChange:t=>P(r,t),required:!0})),e.createElement(p,{className:"mt-3"},e.createElement(s,{md:6},e.createElement("label",{htmlFor:"currency"},"Select Currency:"),e.createElement("select",{id:"currency",value:v,onChange:t=>b(t.target.value),className:"form-control"},f.map(t=>e.createElement("option",{key:t,value:t},t))))),e.createElement(p,{className:"mt-3 text-end"},e.createElement(s,null,e.createElement("h5",null,"Estimated Cost: ",v," ",n.estimatedCost.toFixed(2)))),e.createElement(s,{md:2},e.createElement(q,{color:"danger",onClick:()=>N(r)},"Remove")))),e.createElement(p,{className:"mt-3"},e.createElement(s,{md:6},e.createElement(q,{color:"primary",onClick:S},"Add Product"))),e.createElement(p,{className:"mt-4"},e.createElement(s,{md:12,className:"text-center"},e.createElement(q,{color:"success",type:"submit",disabled:y},y?e.createElement(w,{size:"sm"}):"Create Procurement"))),e.createElement(I,{placement:"top-end"},g.map(a=>e.createElement(L,{key:a.id,autohide:!0,visible:!0,color:a.color},e.createElement(H,{closeButton:!0},a.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(_,null,a.message)))))},te=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(K,null));export{te as default};
