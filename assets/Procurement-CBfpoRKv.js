import{R as e,P as o,k as A,r as f,C as O}from"./index-CBDYk9Ao.js";import{a as U}from"./index-C88pvD_q.js";import{C as B}from"./CFormTextarea-Cq-VIqwu.js";import{C as I}from"./CFormSelect-DrsQRXU_.js";import{C as L}from"./CFormInput-CYaNQEFx.js";import{C as d,a as c}from"./CRow-C6uQnZEq.js";import{b as S}from"./CContainer-BVTxmlXV.js";import{C as H,a as Q,b as _,c as z}from"./CToaster-BQUAAx07.js";import"./CFormControlWrapper-BjTevJ5s.js";import"./CCloseButton-DIWbhS5b.js";import"./CNavItem-BCds_oRM.js";const l=({label:m,type:n="text",name:i,value:p,onChange:E,placeholder:h="",required:y=!1,options:P=[],rows:v=3,disabled:C=!1})=>n==="textarea"?e.createElement(B,{label:m,name:i,value:p,onChange:E,placeholder:h,required:y,rows:v,disabled:C,"aria-label":m}):n==="select"?e.createElement(I,{label:m,name:i,value:p,onChange:E,required:y,disabled:C,"aria-label":m},e.createElement("option",{value:""},"Select ",m),P.map((b,D)=>e.createElement("option",{key:D,value:b},b))):e.createElement(L,{type:n,name:i,value:p,onChange:E,placeholder:h,label:m,required:y,disabled:C,"aria-label":m});l.propTypes={label:o.string.isRequired,type:o.oneOf(["text","number","date","textarea","select"]),name:o.string.isRequired,value:o.oneOfType([o.string,o.number]).isRequired,onChange:o.func.isRequired,placeholder:o.string,required:o.bool,options:o.arrayOf(o.string),rows:o.number,disabled:o.bool};const G="https://backend-log2.axleshift.com",K=`${G}/api/v1/procurement`,M=()=>{const{accessToken:m}=A(),[n,i]=f.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[p,E]=f.useState(!1),[h,y]=f.useState([]),[P,v]=f.useState(!1),[C,b]=f.useState("PHP"),D=["PHP","USD","EUR","GBP","JPY"],g=a=>{const{name:r,value:t}=a.target;i(s=>({...s,[r]:t}))},q=(a,r)=>{const{name:t,value:s}=r.target,u=[...n.products];u[a]={...u[a],[t]:t==="quantity"||t==="unitPrice"?s===""?"":parseFloat(s):s};const w=u.reduce((R,N)=>R+(N.unitPrice||0)*(N.quantity||0),0);i(R=>({...R,products:u,estimatedCost:parseFloat(w.toFixed(2))}))},x=()=>{i(a=>({...a,products:[...a.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},F=a=>{const r=n.products.filter((t,s)=>s!==a);i(t=>({...t,products:r,estimatedCost:r.reduce((s,u)=>s+(u.unitPrice*u.quantity||0),0)}))},k=async a=>{var r,t;if(a.preventDefault(),!P){v(!0);try{if(!m)throw new Error("Authentication error. Please log in again.");const s={Authorization:`Bearer ${m}`,"Content-Type":"application/json"},u={...n,requiresRFQ:p,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null};await U.post(K,u,{headers:s}),i({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),E(!1),T("âœ… Procurement Request created successfully! Wait for Approval","success")}catch(s){T(((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{v(!1)}}},T=(a,r)=>{y(t=>[...t,{id:Date.now(),message:a,color:r}]),setTimeout(()=>y(t=>t.slice(1)),5e3)};return e.createElement("form",{onSubmit:k},e.createElement(d,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(l,{label:"Title",name:"title",value:n.title,onChange:g,required:!0})),e.createElement(c,{md:6},e.createElement(l,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:g,required:!0}))),e.createElement(l,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:g,required:!0,rows:3}),e.createElement(d,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(l,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:g})),e.createElement(c,{md:6},e.createElement(l,{label:"Department",type:"select",name:"department",value:n.department,onChange:g,options:["HR","Finance","Logistics","IT","Procurement","Operations"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((a,r)=>e.createElement(d,{key:r,className:"mb-2"},e.createElement(c,{md:2},e.createElement(l,{label:"Product Name",name:"name",value:a.name,onChange:t=>q(r,t),required:!0})),e.createElement(c,{md:2},e.createElement(l,{label:"Quantity",type:"number",name:"quantity",value:a.quantity,min:"0",onChange:t=>q(r,t),required:!0})),e.createElement(c,{md:2},e.createElement(l,{label:"Unit",type:"select",name:"unit",value:a.unit,onChange:t=>q(r,t),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(c,{md:2},e.createElement(l,{label:"Unit Price",type:"number",name:"unitPrice",value:a.unitPrice,min:"0",onChange:t=>q(r,t),required:!0})),e.createElement(d,{className:"mt-3"},e.createElement(c,{md:6},e.createElement("label",{htmlFor:"currency"},"Select Currency:"),e.createElement("select",{id:"currency",value:C,onChange:t=>b(t.target.value),className:"form-control"},D.map(t=>e.createElement("option",{key:t,value:t},t))))),e.createElement(d,{className:"mt-3 text-end"},e.createElement(c,null,e.createElement("h5",null,"Estimated Cost: ",C," ",n.estimatedCost.toFixed(2)))),e.createElement(c,{md:2},e.createElement(S,{color:"danger",onClick:()=>F(r)},"Remove")))),e.createElement(d,{className:"mt-3"},e.createElement(c,{md:6},e.createElement(S,{color:"primary",onClick:x},"Add Product"))),e.createElement(d,{className:"mt-3"},e.createElement(c,null,e.createElement("input",{type:"checkbox",checked:p,onChange:a=>E(a.target.checked)})," ","Requires RFQ?")),e.createElement(d,{className:"mt-4"},e.createElement(c,{md:12,className:"text-center"},e.createElement(S,{color:"success",type:"submit",disabled:P},P?e.createElement(O,{size:"sm"}):"Create Procurement"))),e.createElement(H,{placement:"top-end"},h.map(a=>e.createElement(Q,{key:a.id,autohide:!0,visible:!0,color:a.color},e.createElement(_,{closeButton:!0},a.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(z,null,a.message)))))},re=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(M,null));export{re as default};
