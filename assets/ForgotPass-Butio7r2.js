import{r as t,f as D,j as e}from"./index-g0pqW7ck.js";import{C as G}from"./index.esm-D3-yDp1K.js";import{a as x}from"./axios-CCb-kr4I.js";import{C as M,a as L}from"./CContainer-Q6orkmqE.js";import{C as b,a as _}from"./CRow-DMUOOBum.js";import{C as k}from"./CCardGroup-CQOESIDd.js";import{C as Y,a as z}from"./CCardBody-CJNadQcM.js";import{C as H}from"./CForm-Dk5WdL2p.js";import{C as h,a as w}from"./CInputGroupText-BY3IZtA-.js";import{c as J}from"./cil-user-Ddrdy7PS.js";import{C as g}from"./CFormInput-DmvkNggx.js";const y="undefined/api/v1/auth",ne=()=>{const[l,N]=t.useState(""),[m,S]=t.useState(""),[p,O]=t.useState(""),[C,E]=t.useState(""),[j,a]=t.useState(!1),[P,r]=t.useState(""),[v,c]=t.useState(""),[d,T]=t.useState(!1),[u,q]=t.useState(!1),R=D(),A=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),F=async s=>await x.post(`${y}/forgot-password`,s),I=async s=>await x.post(`${y}/verify-otp`,s),V=async s=>await x.post(`${y}/change-password`,s),$=async s=>{var o,n;if(s.preventDefault(),a(!0),r(""),c(""),!l){r("Email is required."),a(!1);return}if(!A(l)){r("Please enter a valid email address."),a(!1);return}try{(await F({email:l})).status===200&&(c("A reset code has been sent to your email. Please check your inbox."),T(!0))}catch(i){const f=((n=(o=i.response)==null?void 0:o.data)==null?void 0:n.message)||"An error occurred while sending the OTP.";r(f)}finally{a(!1)}},U=async s=>{var o,n;if(s.preventDefault(),a(!0),r(""),!m){r("OTP is required."),a(!1);return}try{(await I({email:l,otp:m})).status===200&&(c("OTP verified successfully! You can now set a new password."),q(!0))}catch(i){const f=((n=(o=i.response)==null?void 0:o.data)==null?void 0:n.message)||"An error occurred while verifying the OTP.";r(f)}finally{a(!1)}},B=async s=>{var o,n;if(s.preventDefault(),a(!0),r(""),c(""),!p||!m){r("Both OTP and new password fields are required."),a(!1);return}if(p.length<6){r("New password must be at least 6 characters long."),a(!1);return}if(p!==C){r("Passwords do not match."),a(!1);return}try{(await V({email:l,otp:m,newPassword:p})).status===200&&(c("Password changed successfully. Redirecting to login..."),setTimeout(()=>R("/login"),2e3))}catch(i){const f=((n=(o=i.response)==null?void 0:o.data)==null?void 0:n.message)||"An error occurred while changing the password.";r(f)}finally{a(!1)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(M,{children:e.jsx(b,{className:"justify-content-center",children:e.jsx(_,{md:5,children:e.jsx(k,{children:e.jsx(Y,{className:"p-4",children:e.jsx(z,{children:e.jsxs(H,{onSubmit:u?B:d?U:$,children:[e.jsx("h1",{children:u?"Change Password":d?"Verify OTP":"Forgot Password"}),e.jsx("p",{className:"text-body-secondary",children:u?"Enter your new password":d?"Enter the OTP sent to your email":"Enter your email to reset your password"}),P&&e.jsx("div",{className:"alert alert-danger",children:P}),v&&e.jsx("div",{className:"alert alert-success",children:v}),!d&&e.jsxs(h,{className:"mb-4",children:[e.jsx(w,{children:e.jsx(G,{icon:J})}),e.jsx(g,{type:"email",placeholder:"Email",autoComplete:"email",value:l,onChange:s=>{N(s.target.value),r(""),c("")},required:!0})]}),d&&!u&&e.jsxs(h,{className:"mb-4",children:[e.jsx(w,{children:"OTP"}),e.jsx(g,{type:"text",placeholder:"Enter OTP",value:m,onChange:s=>S(s.target.value),required:!0})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{className:"mb-4",children:[e.jsx(w,{children:"New Password"}),e.jsx(g,{type:"password",placeholder:"Enter New Password",value:p,onChange:s=>O(s.target.value),required:!0})]}),e.jsxs(h,{className:"mb-4",children:[e.jsx(w,{children:"Confirm Password"}),e.jsx(g,{type:"password",placeholder:"Confirm New Password",value:C,onChange:s=>E(s.target.value),required:!0})]})]}),e.jsx(b,{children:e.jsx(L,{type:"submit",color:"primary",disabled:j,children:j?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):u?"Change Password":d?"Verify OTP":"Send Reset Code"})})]})})})})})})})})};export{ne as default};
