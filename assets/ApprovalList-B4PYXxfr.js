import{i as k,k as B,r,R as e,C as R}from"./index-DQP8N3_v.js";import{a as d}from"./index-C88pvD_q.js";import{C as P,a as S}from"./CCardBody-DhxhUCKr.js";import{C as $}from"./CCardHeader-aqV2zWI-.js";import{C as M,a as _,b as p,c as m,d as w,e as l}from"./CTable-BMBWZ6R4.js";import{b as i}from"./CContainer-B5X986nK.js";import{C as x,a as F,b as z,c as H}from"./CModalHeader-Dvi2NdUX.js";import{C as L}from"./CFormTextarea-hZ1ym61I.js";import"./CCloseButton-B0Lgjfr_.js";import"./CNavItem-BP7P-adU.js";import"./CFormControlWrapper-BVBkIMxJ.js";const C="https://backend-log2.axleshift.com/api/v1/procurement",W=()=>{k();const{accessToken:n}=B(),[o,u]=r.useState([]),[g,j]=r.useState(!0),[E,c]=r.useState(!1),[v,s]=r.useState(!1),[f,b]=r.useState(null),[h,y]=r.useState("");r.useEffect(()=>{(async()=>{try{const a=await d.get(`${C}?status=Pending`,{headers:{Authorization:`Bearer ${n}`}});u(a.data)}catch(a){console.error("Error fetching procurements:",a)}finally{j(!1)}})()},[n]);const A=async t=>{try{c(!0),await d.patch(`${C}/${t}/approve`,{},{headers:{Authorization:`Bearer ${n}`}}),u(o.filter(a=>a._id!==t))}catch{alert("Failed to approve procurement")}finally{c(!1)}},T=async()=>{if(!h.trim()){alert("Please provide a rejection reason.");return}try{c(!0),await d.patch(`${C}/${f}/reject`,{rejectionReason},{headers:{Authorization:`Bearer ${n}`}}),u(o.filter(t=>t._id!==f)),s(!1),y("")}catch(t){console.error("Failed to reject procurement:",t),alert("Failed to reject procurement")}finally{c(!1)}};return g?e.createElement(R,{color:"primary"}):e.createElement(P,null,e.createElement($,null,e.createElement("h5",null,"Approval List")),e.createElement(S,null,e.createElement(M,{hover:!0,responsive:!0},e.createElement(_,null,e.createElement(p,null,e.createElement(m,null,"Title"),e.createElement(m,null,"Department"),e.createElement(m,null,"Requested By"),e.createElement(m,null,"Actions"))),e.createElement(w,null,o.length>0?o.map(t=>{var a;return e.createElement(p,{key:t._id},e.createElement(l,null,t.title),e.createElement(l,null,t.department),e.createElement(l,null,((a=t.requestedBy)==null?void 0:a.email)||"Unknown"),e.createElement(l,null,e.createElement(i,{color:"success",className:"me-2",onClick:()=>A(t._id),disabled:E},E?e.createElement(R,{size:"sm"}):"Approve"),e.createElement(i,{color:"danger",onClick:()=>{b(t._id),s(!0)}},"Reject")))}):e.createElement(p,null,e.createElement(l,{colSpan:"4"},"No pending Procurement Request."))))),e.createElement(x,{visible:v,onClose:()=>s(!1)},e.createElement(F,null,"Reject Procurement"),e.createElement(z,null,e.createElement(L,{placeholder:"Enter rejection reason...",value:h,onChange:t=>y(t.target.value)})),e.createElement(H,null,e.createElement(i,{color:"secondary",onClick:()=>s(!1)},"Cancel"),e.createElement(i,{color:"danger",onClick:T},"Confirm Reject"))))};export{W as default};
