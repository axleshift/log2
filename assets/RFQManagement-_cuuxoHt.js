import{r as s,i as R,R as e,C as v,k as x}from"./index-DQP8N3_v.js";import{a as b}from"./index-C88pvD_q.js";import{a as k,b as i}from"./CContainer-B5X986nK.js";import{C as P}from"./CAlert-k6EoeMSe.js";import{C as A,a as D,b as y,c as d,d as F,e as m}from"./CTable-BMBWZ6R4.js";import{C as w,a as S}from"./CCardBody-DhxhUCKr.js";import{C as N}from"./DefaultLayout-Qp2vNndn.js";import{C as _,a as T,b as M,c as Q}from"./CModalHeader-Dvi2NdUX.js";import{C as $,a as z}from"./CRow-DRxYPhhI.js";import{C as I}from"./CCardHeader-aqV2zWI-.js";import"./CCloseButton-B0Lgjfr_.js";import"./index.esm-QyN5VXAl.js";import"./CNavItem-BP7P-adU.js";import"./cil-user-Ddrdy7PS.js";import"./index-tOFcNw6a.js";const B=()=>{const[r,E]=s.useState([]),[o,f]=s.useState(!0),[u,n]=s.useState(null),[C,h]=s.useState(null),p=R();s.useEffect(()=>{(async()=>{var c,t;try{const l=await b.get("https://backend-log2.axleshift.com/api/v1/rfq");l.data&&Array.isArray(l.data.rfqs)?E(l.data.rfqs):Array.isArray(l.data)?E(l.data):(n("Unexpected API response format"),E([]))}catch(l){n(((t=(c=l.response)==null?void 0:c.data)==null?void 0:t.message)||"Failed to fetch RFQs")}finally{f(!1)}})()},[]);const g=async a=>{var c,t;if(window.confirm("Are you sure you want to delete this RFQ?")){h(a);try{await b.delete(`https://backend-log2.axleshift.com/api/v1/rfq/${a}`),E(r.filter(l=>l._id!==a))}catch(l){alert(((t=(c=l.response)==null?void 0:c.data)==null?void 0:t.message)||"Failed to delete RFQ")}finally{h(null)}}};return e.createElement(k,{className:"mt-4"},e.createElement("h2",{className:"mb-4"},"RFQ List"),o&&e.createElement(v,{color:"primary"}),u&&e.createElement(P,{color:"danger"},u),!o&&!u&&e.createElement(A,{hover:!0,responsive:!0,striped:!0,borderColor:"secondary"},e.createElement(D,{color:"dark"},e.createElement(y,null,e.createElement(d,null,"RFQ ID"),e.createElement(d,null,"Procurement"),e.createElement(d,null,"Deadline"),e.createElement(d,null,"Status"),e.createElement(d,null,"Actions"))),e.createElement(F,null,r.length>0?r.map(a=>{var c;return e.createElement(y,{key:a._id},e.createElement(m,null,a._id),e.createElement(m,null,((c=a.procurementId)==null?void 0:c.title)||"N/A"),e.createElement(m,null,a.deadline?new Date(a.deadline).toLocaleDateString():"No Deadline"),e.createElement(m,null,a.status||"Pending"),e.createElement(m,null,e.createElement(i,{color:"primary",size:"sm",className:"me-2",onClick:()=>p(`/procurement/rfq/${a._id}`)},"View"),e.createElement(i,{color:"danger",size:"sm",onClick:()=>g(a._id),disabled:C===a._id},C===a._id?"Deleting...":"Delete")))}):e.createElement(y,null,e.createElement(m,{colSpan:"5",className:"text-center"},"No RFQs found")))))},L="https://backend-log2.axleshift.com/api/v1/procurement",q=()=>{const r=R(),{user:E,accessToken:o}=x(),[f,u]=s.useState([]),[n,C]=s.useState(!0),[h,p]=s.useState(!1),[g,a]=s.useState(null);s.useEffect(()=>{(async()=>{if(!o){console.error("No authentication token found"),C(!1);return}try{const l=await b.get(L,{headers:{Authorization:`Bearer ${o}`}});console.log("Procurements Data:",l.data),u(l.data)}catch(l){console.error("Error fetching procurements:",l)}finally{C(!1)}})()},[o]);const c=async()=>{if(!(!g||!o))try{await b.delete(`${L}/${g}`,{headers:{Authorization:`Bearer ${o}`}}),u(f.filter(t=>t._id!==g)),p(!1)}catch(t){console.error("Error deleting procurement:",t),alert("Failed to delete procurement.")}};return e.createElement(w,null,e.createElement(S,null,e.createElement("h5",null,"Procurement Requests"),e.createElement(A,{responsive:!0},e.createElement(D,null,e.createElement(y,null,e.createElement(d,null,"Title"),e.createElement(d,null,"Department"),e.createElement(d,null,"Status"),e.createElement(d,null,"Actions"))),e.createElement(F,null,f.map(t=>e.createElement(y,{key:t._id},e.createElement(m,null,t.title),e.createElement(m,null,t.department),e.createElement(m,null,e.createElement(N,{color:t.status==="Approved"?"success":"warning"},t.status)),e.createElement(m,{className:"text-center"},e.createElement(i,{color:"info",size:"sm",onClick:()=>r(`/procurement/${t._id}`)},"View")," ",e.createElement(i,{color:"danger",size:"sm",onClick:()=>{a(t._id),p(!0)}},"Delete")," ",t.status==="Approved"&&e.createElement(e.Fragment,null,e.createElement(i,{color:"primary",size:"sm",onClick:()=>r(`/rfq/create/${t._id}`)},"Create RFQ")," ",e.createElement(i,{color:"success",size:"sm",onClick:()=>r(`/po/create/${t._id}`)},"Create PO")))))))),e.createElement(_,{visible:h,onClose:()=>p(!1)},e.createElement(T,null,"Confirm Deletion"),e.createElement(M,null,"Are you sure you want to delete this procurement request?"),e.createElement(Q,null,e.createElement(i,{color:"secondary",onClick:()=>p(!1)},"Cancel"),e.createElement(i,{color:"danger",onClick:c},"Delete"))))},re=()=>{const[r,E]=s.useState("ProcurementList"),[o,f]=s.useState(!1),u=n=>{E(n),f(!0),setTimeout(()=>f(!1),1e3)};return e.createElement(k,null,e.createElement($,{className:"mb-3"},e.createElement(z,null,e.createElement(w,null,e.createElement(I,{className:"d-flex justify-content-between align-items-center"},e.createElement("div",null,e.createElement(i,{color:r==="ProcurementList"?"primary":"secondary",onClick:()=>u("ProcurementList"),className:"ms-2",active:r==="ProcurementList",style:{transition:"all 0.3s ease",boxShadow:r==="ProcurementList"?"0 4px 6px rgba(0, 0, 0, 0.1)":"none"},onMouseOver:n=>n.target.style.transform="scale(1.05)",onMouseOut:n=>n.target.style.transform="scale(1)"},"Procurement List"),e.createElement(i,{color:r==="rfqList"?"primary":"secondary",onClick:()=>u("rfqList"),className:"ms-2",active:r==="rfqList",style:{transition:"all 0.3s ease",boxShadow:r==="rfqList"?"0 4px 6px rgba(0, 0, 0, 0.1)":"none"},onMouseOver:n=>n.target.style.transform="scale(1.05)",onMouseOut:n=>n.target.style.transform="scale(1)"},"RFQ List")),e.createElement("div",null,o&&e.createElement(v,{color:"primary"}))),e.createElement(S,null,o?e.createElement(P,{color:"info"},"Loading data..."):e.createElement(e.Fragment,null,r==="ProcurementList"&&e.createElement(q,null),r==="rfqList"&&e.createElement(B,null)))))))};export{re as default};
