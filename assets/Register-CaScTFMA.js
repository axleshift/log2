import{r as d,R as e,P as C,i as k,C as I,q as R}from"./index-C2RBCqsm.js";import{a as q,u as B,F as Z,c as j}from"./index.esm-DkwOjYXP.js";import{C as f}from"./index.esm-DkUWHJUO.js";import{C as m}from"./CAlert-Da1AJdPr.js";import{C as T}from"./CForm-CMVnlzCC.js";import{C as l,a as i}from"./CInputGroupText-9scP-lKF.js";import{C as o}from"./CFormInput-CwG_Yb0d.js";import{b as O,a as M}from"./CContainer-DysCb-Pj.js";import{c as D}from"./cil-user-Ddrdy7PS.js";import{C as H}from"./CFormSelect-D6cY_8Ax.js";import{C as U,a as $}from"./CRow-ByaeGxm2.js";import{C as J,a as G}from"./CCardBody-DElEwR_S.js";import"./CCloseButton-CK9TUEEK.js";import"./CFormControlWrapper-Cc2_n4DS.js";var _=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M440,464V16H72V464H16v32H496V464Zm-32,0H272V400H240v64H104V48H408Z' class='ci-primary'/><rect width='32' height='32' x='160' y='304' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='240' y='304' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='320' y='304' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='160' y='208' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='240' y='208' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='320' y='208' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='160' y='112' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='240' y='112' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='320' y='112' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/>"],z=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z' class='ci-primary'/><rect width='224' height='32' x='136' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='224' height='32' x='136' y='376' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/>"],K=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M469.666,216.45,271.078,33.749a34,34,0,0,0-47.062.98L41.373,217.373,32,226.745V496H208V328h96V496H480V225.958ZM248.038,56.771c.282,0,.108.061-.013.18C247.9,56.832,247.756,56.771,248.038,56.771ZM448,464H336V328a32,32,0,0,0-32-32H208a32,32,0,0,0-32,32V464H64V240L248.038,57.356c.013-.012.014-.023.024-.035L448,240Z' class='ci-primary'/>"],Q=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M449.366,89.648l-.685-.428L362.088,46.559,268.625,171.176l43,57.337a88.529,88.529,0,0,1-83.115,83.114l-57.336-43L46.558,362.088l42.306,85.869.356.725.429.684a25.085,25.085,0,0,0,21.393,11.857h22.344A327.836,327.836,0,0,0,461.222,133.386V111.041A25.084,25.084,0,0,0,449.366,89.648Zm-20.144,43.738c0,163.125-132.712,295.837-295.836,295.837h-18.08L87,371.76l84.18-63.135,46.867,35.149h5.333a120.535,120.535,0,0,0,120.4-120.4v-5.333l-35.149-46.866L371.759,87l57.463,28.311Z' class='ci-primary'/>"];function F({email:t,setEmail:a,otpVerified:h,setOtpVerified:S,apiUrl:u}){const[x,V]=d.useState(!1),[v,b]=d.useState(""),[y,p]=d.useState(!1),[g,n]=d.useState({message:"",type:""}),P=async()=>{if(!t){n({message:"Please enter an email address.",type:"danger"});return}p(!0),n({message:"",type:""});try{const s=await fetch(`${u}/register/send-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(s.ok)V(!0),n({message:"OTP sent to your email. Check your inbox.",type:"success"});else{const E=await s.json();n({message:E.message,type:"danger"})}}catch{n({message:"Network error. Please try again later.",type:"danger"})}finally{p(!1)}},N=async()=>{if(!v){n({message:"Please enter the OTP.",type:"danger"});return}p(!0),n({message:"",type:""});try{const s=await fetch(`${u}/register/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,otp:v})});if(s.ok)S(!0),n({message:"OTP verified successfully!",type:"success"});else{const E=await s.json();n({message:E.message,type:"danger"})}}catch{n({message:"Network error. Please try again later.",type:"danger"})}finally{p(!1)}};return e.createElement(e.Fragment,null,g.message&&e.createElement(m,{color:g.type},g.message),!x&&!h?e.createElement(T,{onSubmit:s=>{s.preventDefault(),P()}},e.createElement("h1",null,"Register"),e.createElement("p",{className:"text-body-secondary"},"Enter your email to receive an OTP"),e.createElement(l,{className:"mb-3"},e.createElement(i,null,"@"),e.createElement(o,{type:"email",placeholder:"Email",autoComplete:"email",value:t,onChange:s=>a(s.target.value)})),e.createElement("div",{className:"d-grid"},e.createElement(O,{color:"success",type:"submit",disabled:y||!t},y?"Sending OTP...":"Send OTP"))):!h&&e.createElement(T,{onSubmit:s=>{s.preventDefault(),N()}},e.createElement("h1",null,"Verify OTP"),e.createElement("p",{className:"text-body-secondary"},"Enter the OTP sent to your email"),e.createElement(l,{className:"mb-3"},e.createElement(i,null,"OTP"),e.createElement(o,{type:"text",placeholder:"Enter OTP",value:v,onChange:s=>b(s.target.value)})),e.createElement("div",{className:"d-grid"},e.createElement(O,{color:"success",type:"submit",disabled:y||!v},y?"Verifying OTP...":"Verify OTP"))))}F.propTypes={email:C.string.isRequired,setEmail:C.func.isRequired,otpVerified:C.bool.isRequired,setOtpVerified:C.func.isRequired,apiUrl:C.string.isRequired};function W(){const{register:t,formState:{errors:a}}=q();return e.createElement("div",null,e.createElement("h5",null,"Vendor Details"),e.createElement(l,{className:"mb-3"},e.createElement(i,null,e.createElement(f,{icon:K})),e.createElement(o,{placeholder:"Business Name",...t("businessName",{required:"Business Name is required"})})),a.businessName&&e.createElement(m,{color:"danger"},a.businessName.message),e.createElement(l,{className:"mb-3"},e.createElement(i,null,e.createElement(f,{icon:D})),e.createElement(o,{placeholder:"Full Name",...t("fullName",{required:"Full Name is required"})})),a.fullName&&e.createElement(m,{color:"danger"},a.fullName.message),e.createElement(l,{className:"mb-3"},e.createElement(i,null,"Address"),e.createElement(o,{placeholder:"Business Address",...t("businessAddress",{required:"Business Address is required"})})),a.businessAddress&&e.createElement(m,{color:"danger"},a.businessAddress.message),e.createElement(l,{className:"mb-3"},e.createElement(i,null,e.createElement(f,{icon:Q})),e.createElement(o,{placeholder:"Contact Number",...t("contactNumber",{required:"Contact Number is required"})})),a.contactNumber&&e.createElement(m,{color:"danger"},a.contactNumber.message),e.createElement(l,{className:"mb-3"},e.createElement(i,null,"Certifications"),e.createElement(o,{placeholder:"Comma separated certifications",...t("certifications")})),e.createElement(l,{className:"mb-3"},e.createElement(i,null,"Tax ID"),e.createElement(o,{placeholder:"Tax ID",...t("taxId")})))}function X(){const{register:t,formState:{errors:a}}=q();return e.createElement("div",null,e.createElement("h5",null,"Department Details"),e.createElement(l,{className:"mb-3"},e.createElement(i,null,e.createElement(f,{icon:_})),e.createElement(H,{...t("departmentName",{required:"Department Name is required"})},e.createElement("option",{value:""},"Select Department"),e.createElement("option",{value:"HR"},"HR"),e.createElement("option",{value:"Finance"},"Finance"),e.createElement("option",{value:"Admin"},"Admin"),e.createElement("option",{value:"Logistics"},"Logistics"))),a.departmentName&&e.createElement(m,{color:"danger"},a.departmentName.message),e.createElement(l,{className:"mb-3"},e.createElement(i,null,e.createElement(f,{icon:z})),e.createElement(o,{placeholder:"Department Description",...t("departmentDescription",{required:"Department Description is required"})})),a.departmentDescription&&e.createElement(m,{color:"danger"},a.departmentDescription.message))}function de(){const t="https://backend-log2.axleshift.com/api/v1/auth",a=B(),{register:h,handleSubmit:S,formState:{errors:u},watch:x,reset:V}=a,v=k(),[b,y]=d.useState(!1),[p,g]=d.useState({message:"",type:""}),[n,P]=d.useState(""),[N,s]=d.useState(!1),E=x("role","user"),A=async r=>{try{const c=await fetch(`${t}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!c.ok){const w=await c.json();throw new Error(w.message||"Registration failed. Please try again.")}return c.json()}catch(c){throw new Error(c.message||"Something went wrong.")}},L=async r=>{y(!0),g({message:"",type:""});try{if(!n)throw new Error("Email verification is required.");const c={username:r.username,email:n,password:r.password,role:r.role||"user"};r.role==="vendor"&&(c.vendorDetails={businessName:r.businessName,fullName:r.fullName,businessAddress:r.businessAddress,contactNumber:r.contactNumber,certifications:r.certifications?r.certifications.split(","):[],taxId:r.taxId});const w=await A(c);R.set("token",w.accessToken,{expires:1}),R.set("refreshToken",w.refreshToken,{expires:1}),g({message:"Registration Successful! Redirecting...",type:"success"}),V(),setTimeout(()=>v("/login"),2e3)}catch(c){g({message:c.message,type:"danger"})}finally{y(!1)}};return e.createElement("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center"},e.createElement(M,null,e.createElement(U,{className:"justify-content-center"},e.createElement($,{md:9,lg:7,xl:6},e.createElement(J,{className:"mx-4"},e.createElement(G,{className:"p-4"},N?e.createElement(Z,{...a},e.createElement(T,{onSubmit:S(L)},e.createElement("h1",{className:"text-center mb-4"},"Complete Registration"),p.message&&e.createElement(m,{color:p.type},p.message),e.createElement(l,{className:`mb-3 ${u.username?"is-invalid":""}`},e.createElement(i,null,e.createElement(f,{icon:D})),e.createElement(o,{placeholder:"Username",...h("username",{required:"Username is required"}),onFocus:r=>r.target.style.borderColor="var(--c-primary)",onBlur:r=>r.target.style.borderColor=""})),u.username&&e.createElement(m,{color:"danger"},u.username.message),e.createElement(l,{className:`mb-3 ${u.password?"is-invalid":""}`},e.createElement(i,null,e.createElement(f,{icon:j})),e.createElement(o,{type:"password",placeholder:"Password",...h("password",{required:"Password is required"}),onFocus:r=>r.target.style.borderColor="var(--c-primary)",onBlur:r=>r.target.style.borderColor=""})),u.password&&e.createElement(m,{color:"danger"},u.password.message),e.createElement(l,{className:"mb-3"},e.createElement(i,null,"Role"),e.createElement(H,{...h("role")},e.createElement("option",{value:"user"},"User"),e.createElement("option",{value:"admin"},"Admin"),e.createElement("option",{value:"super admin"},"Super Admin"),e.createElement("option",{value:"vendor"},"Vendor"),e.createElement("option",{value:"buyer"},"Buyer"),e.createElement("option",{value:"finance"},"Finance"))),E==="vendor"&&e.createElement(W,null),E==="admin"||E==="finance"?e.createElement(X,null):null,e.createElement("div",{className:"d-grid"},e.createElement(O,{color:"primary",type:"submit",disabled:b},b?e.createElement(I,{color:"light"}):"Register")))):e.createElement(F,{email:n,setEmail:P,otpVerified:N,setOtpVerified:s,apiUrl:t})))))))}export{de as default};
