import{r as d,R as e,P as b,i as L,C as I,q}from"./index-D-OjWQES.js";import{a as j,u as U,F as B,c as D}from"./index.esm-fdLk0Ruu.js";import{C as N}from"./index.esm-CdbheKKh.js";import{C as p}from"./CAlert-DaKElX6f.js";import{C as R}from"./CForm-DVMN_51j.js";import{C as l,a as o}from"./CInputGroupText-BE524GP1.js";import{C as i}from"./CFormInput-D-rK_OXt.js";import{b as x,a as H}from"./CContainer-Cq52eSeb.js";import{c as V}from"./cil-user-Ddrdy7PS.js";import{C as $,a as Z}from"./CRow-CDQaQMcK.js";import{C as M,a as J}from"./CCardBody-BZHwh40R.js";import{C as G}from"./CFormSelect-Ce7xB0Qv.js";import"./CCloseButton-BeKj8TBh.js";import"./CFormControlWrapper-DhhdGZWh.js";var _=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M469.666,216.45,271.078,33.749a34,34,0,0,0-47.062.98L41.373,217.373,32,226.745V496H208V328h96V496H480V225.958ZM248.038,56.771c.282,0,.108.061-.013.18C247.9,56.832,247.756,56.771,248.038,56.771ZM448,464H336V328a32,32,0,0,0-32-32H208a32,32,0,0,0-32,32V464H64V240L248.038,57.356c.013-.012.014-.023.024-.035L448,240Z' class='ci-primary'/>"],z=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M449.366,89.648l-.685-.428L362.088,46.559,268.625,171.176l43,57.337a88.529,88.529,0,0,1-83.115,83.114l-57.336-43L46.558,362.088l42.306,85.869.356.725.429.684a25.085,25.085,0,0,0,21.393,11.857h22.344A327.836,327.836,0,0,0,461.222,133.386V111.041A25.084,25.084,0,0,0,449.366,89.648Zm-20.144,43.738c0,163.125-132.712,295.837-295.836,295.837h-18.08L87,371.76l84.18-63.135,46.867,35.149h5.333a120.535,120.535,0,0,0,120.4-120.4v-5.333l-35.149-46.866L371.759,87l57.463,28.311Z' class='ci-primary'/>"];function A({email:r,setEmail:a,otpVerified:f,setOtpVerified:w,apiUrl:m}){const[P,T]=d.useState(!1),[y,C]=d.useState(""),[E,u]=d.useState(!1),[g,s]=d.useState({message:"",type:""}),O=async()=>{if(!r){s({message:"Please enter an email address.",type:"danger"});return}u(!0),s({message:"",type:""});try{const t=await fetch(`${m}/register/send-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})});if(t.ok)T(!0),s({message:"OTP sent to your email. Check your inbox.",type:"success"});else{const h=await t.json();s({message:h.message,type:"danger"})}}catch{s({message:"Network error. Please try again later.",type:"danger"})}finally{u(!1)}},v=async()=>{if(!y){s({message:"Please enter the OTP.",type:"danger"});return}u(!0),s({message:"",type:""});try{const t=await fetch(`${m}/register/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,otp:y})});if(t.ok)w(!0),s({message:"OTP verified successfully!",type:"success"});else{const h=await t.json();s({message:h.message,type:"danger"})}}catch{s({message:"Network error. Please try again later.",type:"danger"})}finally{u(!1)}};return e.createElement(e.Fragment,null,g.message&&e.createElement(p,{color:g.type},g.message),!P&&!f?e.createElement(R,{onSubmit:t=>{t.preventDefault(),O()}},e.createElement("h1",null,"Register"),e.createElement("p",{className:"text-body-secondary"},"Enter your email to receive an OTP"),e.createElement(l,{className:"mb-3"},e.createElement(o,null,"@"),e.createElement(i,{type:"email",placeholder:"Email",autoComplete:"email",value:r,onChange:t=>a(t.target.value)})),e.createElement("div",{className:"d-grid"},e.createElement(x,{color:"success",type:"submit",disabled:E||!r},E?"Sending OTP...":"Send OTP"))):!f&&e.createElement(R,{onSubmit:t=>{t.preventDefault(),v()}},e.createElement("h1",null,"Verify OTP"),e.createElement("p",{className:"text-body-secondary"},"Enter the OTP sent to your email"),e.createElement(l,{className:"mb-3"},e.createElement(o,null,"OTP"),e.createElement(i,{type:"text",placeholder:"Enter OTP",value:y,onChange:t=>C(t.target.value)})),e.createElement("div",{className:"d-grid"},e.createElement(x,{color:"success",type:"submit",disabled:E||!y},E?"Verifying OTP...":"Verify OTP"))))}A.propTypes={email:b.string.isRequired,setEmail:b.func.isRequired,otpVerified:b.bool.isRequired,setOtpVerified:b.func.isRequired,apiUrl:b.string.isRequired};function K(){const{register:r,formState:{errors:a}}=j();return e.createElement("div",null,e.createElement("h5",null,"Vendor Details"),e.createElement(l,{className:"mb-3"},e.createElement(o,null,e.createElement(N,{icon:_})),e.createElement(i,{placeholder:"Business Name",...r("businessName",{required:"Business Name is required"})})),a.businessName&&e.createElement(p,{color:"danger"},a.businessName.message),e.createElement(l,{className:"mb-3"},e.createElement(o,null,e.createElement(N,{icon:V})),e.createElement(i,{placeholder:"Full Name",...r("fullName",{required:"Full Name is required"})})),a.fullName&&e.createElement(p,{color:"danger"},a.fullName.message),e.createElement(l,{className:"mb-3"},e.createElement(o,null,"Address"),e.createElement(i,{placeholder:"Business Address",...r("businessAddress",{required:"Business Address is required"})})),a.businessAddress&&e.createElement(p,{color:"danger"},a.businessAddress.message),e.createElement(l,{className:"mb-3"},e.createElement(o,null,e.createElement(N,{icon:z})),e.createElement(i,{placeholder:"Contact Number",...r("contactNumber",{required:"Contact Number is required"})})),a.contactNumber&&e.createElement(p,{color:"danger"},a.contactNumber.message),e.createElement(l,{className:"mb-3"},e.createElement(o,null,"Certifications"),e.createElement(i,{placeholder:"Comma separated certifications",...r("certifications")})),e.createElement(l,{className:"mb-3"},e.createElement(o,null,"Tax ID"),e.createElement(i,{placeholder:"Tax ID",...r("taxId")})))}function me(){const r="https://backend-log2.axleshift.com/api/v1/auth",a=U(),{register:f,handleSubmit:w,formState:{errors:m},watch:P,reset:T}=a,y=L(),[C,E]=d.useState(!1),[u,g]=d.useState({message:"",type:""}),[s,O]=d.useState(""),[v,t]=d.useState(!1),h=P("role","user"),k=async n=>{try{const c=await fetch(`${r}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!c.ok){const S=await c.json();throw new Error(S.message||"Registration failed. Please try again.")}return c.json()}catch(c){throw new Error(c.message||"Something went wrong.")}},F=async n=>{E(!0),g({message:"",type:""});try{if(!s)throw new Error("Email verification is required.");const c={username:n.username,email:s,password:n.password,role:n.role||"user"};n.role==="vendor"&&(c.vendorDetails={businessName:n.businessName,fullName:n.fullName,businessAddress:n.businessAddress,contactNumber:n.contactNumber,certifications:n.certifications?n.certifications.split(","):[],taxId:n.taxId});const S=await k(c);q.set("token",S.accessToken,{expires:1}),q.set("refreshToken",S.refreshToken,{expires:1}),g({message:"Registration Successful! Redirecting...",type:"success"}),T(),setTimeout(()=>y("/login"),2e3)}catch(c){g({message:c.message,type:"danger"})}finally{E(!1)}};return e.createElement("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center"},e.createElement(H,null,e.createElement($,{className:"justify-content-center"},e.createElement(Z,{md:9,lg:7,xl:6},e.createElement(M,{className:"mx-4"},e.createElement(J,{className:"p-4"},v?e.createElement(B,{...a},e.createElement(R,{onSubmit:w(F)},e.createElement("h1",{className:"text-center mb-4"},"Complete Registration"),u.message&&e.createElement(p,{color:u.type},u.message),e.createElement(l,{className:`mb-3 ${m.username?"is-invalid":""}`},e.createElement(o,null,e.createElement(N,{icon:V})),e.createElement(i,{placeholder:"Username",...f("username",{required:"Username is required"})})),m.username&&e.createElement(p,{color:"danger"},m.username.message),e.createElement(l,{className:`mb-3 ${m.password?"is-invalid":""}`},e.createElement(o,null,e.createElement(N,{icon:D})),e.createElement(i,{type:"password",placeholder:"Password",...f("password",{required:"Password is required"})})),m.password&&e.createElement(p,{color:"danger"},m.password.message),e.createElement(l,{className:"mb-3"},e.createElement(o,null,"Role"),e.createElement(G,{...f("role")},e.createElement("option",{value:"user"},"User"),e.createElement("option",{value:"admin"},"Admin"),e.createElement("option",{value:"super admin"},"Super Admin"),e.createElement("option",{value:"vendor"},"Vendor"),e.createElement("option",{value:"buyer"},"Buyer"),e.createElement("option",{value:"finance"},"Finance"))),h==="vendor"&&e.createElement(K,null),e.createElement("div",{className:"d-grid"},e.createElement(x,{color:"primary",type:"submit",disabled:C},C?e.createElement(I,{color:"light"}):"Register")))):e.createElement(A,{email:s,setEmail:O,otpVerified:v,setOtpVerified:t,apiUrl:r})))))))}export{me as default};
