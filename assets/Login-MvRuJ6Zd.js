import{r as l,P as f,n as te,u as re,R as r,L as G,v as Q}from"./index-bZPy-u_X.js";import{u as ne,c as ae}from"./index.esm-CrRyTw9u.js";import{C as X}from"./index.esm-DxhnDIs6.js";import{F as oe,s as ie,t as se}from"./index-DH-lumbl.js";import{h as ce}from"./hoist-non-react-statics.cjs-DclxxwCS.js";import{d as de,a as z,b as P,c as k}from"./CRow-BsnqlO1m.js";import{C as le}from"./CCardGroup-CIisfA_n.js";import{C as pe,a as ue}from"./CCardBody-CLmlzVkW.js";import{C as he}from"./CAlert-C7jfBIBq.js";import{C as fe}from"./CForm-gky2dSTb.js";import{C as H,a as Z}from"./CInputGroupText-QQ-FKc3l.js";import{c as me}from"./cil-user-Ddrdy7PS.js";import{a as $}from"./CFormInput-R_GTD__T.js";import"./CCloseButton-DSMc3Ee6.js";var ge=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function M(){return M=Object.assign?Object.assign.bind():function(n){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(n[t]=o[t])}return n},M.apply(this,arguments)}function ye(n,a){if(n==null)return{};var o={},t=Object.keys(n),e,c;for(c=0;c<t.length;c++)e=t[c],!(a.indexOf(e)>=0)&&(o[e]=n[e]);return o}function U(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ve(n,a){n.prototype=Object.create(a.prototype),n.prototype.constructor=n,W(n,a)}function W(n,a){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},W(n,a)}var D=function(n){ve(a,n);function a(){var t;return t=n.call(this)||this,t.handleExpired=t.handleExpired.bind(U(t)),t.handleErrored=t.handleErrored.bind(U(t)),t.handleChange=t.handleChange.bind(U(t)),t.handleRecaptchaRef=t.handleRecaptchaRef.bind(U(t)),t}var o=a.prototype;return o.getCaptchaFunction=function(e){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[e]:this.props.grecaptcha[e]:null},o.getValue=function(){var e=this.getCaptchaFunction("getResponse");return e&&this._widgetId!==void 0?e(this._widgetId):null},o.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},o.execute=function(){var e=this.getCaptchaFunction("execute");if(e&&this._widgetId!==void 0)return e(this._widgetId);this._executeRequested=!0},o.executeAsync=function(){var e=this;return new Promise(function(c,R){e.executionResolve=c,e.executionReject=R,e.execute()})},o.reset=function(){var e=this.getCaptchaFunction("reset");e&&this._widgetId!==void 0&&e(this._widgetId)},o.forceReset=function(){var e=this.getCaptchaFunction("reset");e&&e()},o.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},o.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},o.handleChange=function(e){this.props.onChange&&this.props.onChange(e),this.executionResolve&&(this.executionResolve(e),delete this.executionReject,delete this.executionResolve)},o.explicitRender=function(){var e=this.getCaptchaFunction("render");if(e&&this._widgetId===void 0){var c=document.createElement("div");this._widgetId=e(c,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(c)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},o.componentDidMount=function(){this.explicitRender()},o.componentDidUpdate=function(){this.explicitRender()},o.handleRecaptchaRef=function(e){this.captcha=e},o.render=function(){var e=this.props;e.sitekey,e.onChange,e.theme,e.type,e.tabindex,e.onExpired,e.onErrored,e.size,e.stoken,e.grecaptcha,e.badge,e.hl,e.isolated;var c=ye(e,ge);return l.createElement("div",M({},c,{ref:this.handleRecaptchaRef}))},a}(l.Component);D.displayName="ReCAPTCHA";D.propTypes={sitekey:f.string.isRequired,onChange:f.func,grecaptcha:f.object,theme:f.oneOf(["dark","light"]),type:f.oneOf(["image","audio"]),tabindex:f.number,onExpired:f.func,onErrored:f.func,size:f.oneOf(["compact","normal","invisible"]),stoken:f.string,hl:f.string,badge:f.oneOf(["bottomright","bottomleft","inline"]),isolated:f.bool};D.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function B(){return B=Object.assign||function(n){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(n[t]=o[t])}return n},B.apply(this,arguments)}function Ee(n,a){if(n==null)return{};var o={},t=Object.keys(n),e,c;for(c=0;c<t.length;c++)e=t[c],!(a.indexOf(e)>=0)&&(o[e]=n[e]);return o}function be(n,a){n.prototype=Object.create(a.prototype),n.prototype.constructor=n,n.__proto__=a}var v={},we=0;function xe(n,a){return a=a||{},function(t){var e=t.displayName||t.name||"Component",c=function(L){be(E,L);function E(g,s){var i;return i=L.call(this,g,s)||this,i.state={},i.__scriptURL="",i}var m=E.prototype;return m.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+we++),this.__scriptLoaderID},m.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},m.asyncScriptLoaderHandleLoad=function(s){var i=this;this.setState(s,function(){return i.props.asyncScriptOnLoad&&i.props.asyncScriptOnLoad(i.state)})},m.asyncScriptLoaderTriggerOnScriptLoaded=function(){var s=v[this.__scriptURL];if(!s||!s.loaded)throw new Error("Script is not loaded.");for(var i in s.observers)s.observers[i](s);delete window[a.callbackName]},m.componentDidMount=function(){var s=this,i=this.setupScriptURL(),p=this.asyncScriptLoaderGetScriptLoaderID(),u=a,O=u.globalName,N=u.callbackName,S=u.scriptId;if(O&&typeof window[O]<"u"&&(v[i]={loaded:!0,observers:{}}),v[i]){var _=v[i];if(_&&(_.loaded||_.errored)){this.asyncScriptLoaderHandleLoad(_);return}_.observers[p]=function(h){return s.asyncScriptLoaderHandleLoad(h)};return}var C={};C[p]=function(h){return s.asyncScriptLoaderHandleLoad(h)},v[i]={loaded:!1,observers:C};var b=document.createElement("script");b.src=i,b.async=!0;for(var F in a.attributes)b.setAttribute(F,a.attributes[F]);S&&(b.id=S);var j=function(w){if(v[i]){var q=v[i],A=q.observers;for(var I in A)w(A[I])&&delete A[I]}};N&&typeof window<"u"&&(window[N]=function(){return s.asyncScriptLoaderTriggerOnScriptLoaded()}),b.onload=function(){var h=v[i];h&&(h.loaded=!0,j(function(w){return N?!1:(w(h),!0)}))},b.onerror=function(){var h=v[i];h&&(h.errored=!0,j(function(w){return w(h),!0}))},document.body.appendChild(b)},m.componentWillUnmount=function(){var s=this.__scriptURL;if(a.removeOnUnmount===!0)for(var i=document.getElementsByTagName("script"),p=0;p<i.length;p+=1)i[p].src.indexOf(s)>-1&&i[p].parentNode&&i[p].parentNode.removeChild(i[p]);var u=v[s];u&&(delete u.observers[this.asyncScriptLoaderGetScriptLoaderID()],a.removeOnUnmount===!0&&delete v[s])},m.render=function(){var s=a.globalName,i=this.props;i.asyncScriptOnLoad;var p=i.forwardedRef,u=Ee(i,["asyncScriptOnLoad","forwardedRef"]);return s&&typeof window<"u"&&(u[s]=typeof window[s]<"u"?window[s]:void 0),u.ref=p,l.createElement(t,u)},E}(l.Component),R=l.forwardRef(function(L,E){return l.createElement(c,B({},L,{forwardedRef:E}))});return R.displayName="AsyncScriptLoader("+e+")",R.propTypes={asyncScriptOnLoad:f.func},ce(R,t)}}var Y="onloadcallback",Re="grecaptcha";function J(){return typeof window<"u"&&window.recaptchaOptions||{}}function Le(){var n=J(),a=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+a+"/recaptcha/enterprise.js?onload="+Y+"&render=explicit":"https://"+a+"/recaptcha/api.js?onload="+Y+"&render=explicit"}const _e=xe(Le,{callbackName:Y,globalName:Re,attributes:J().nonce?{nonce:J().nonce}:{}})(D),Se="6Ld3xYcqAAAAAFh42PyEV5bPvujLBLmVYqGBVmrM",Ge=()=>{const n="https://backend-log2.axleshift.com/api/v1/auth",{register:a,handleSubmit:o,formState:{errors:t},reset:e}=ne(),c=te(),{login:R}=re(),L=l.useRef(null),E=l.useRef(null),[m,g]=l.useState(!1),[s,i]=l.useState(!1),[p,u]=l.useState({message:"",type:""}),[O,N]=l.useState(!1),[S,_]=l.useState(!1),[C,b]=l.useState(""),[F,j]=l.useState(""),[h,w]=l.useState("");l.useEffect(()=>{var d;(d=L.current)==null||d.focus()},[]),l.useEffect(()=>{if(S){const d=setTimeout(()=>{var y;(y=document.querySelector('input[placeholder="Enter 2FA Code"]'))==null||y.focus()},100);return()=>clearTimeout(d)}},[S]);const q=async d=>{var y,x;g(!0),u({message:"",type:""});try{const V=await((y=E.current)==null?void 0:y.executeAsync());(x=E.current)==null||x.reset();const K=await fetch(`${n}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...d,recaptcha_ref:V})}),T=await K.json();if(!K.ok)throw new Error(T.message||"Login failed");if(T.status==="2fa_required"){_(!0),j(d.username),w(T.message||"Enter your 2FA code.");return}I(T)}catch(V){u({message:V.message,type:"danger"})}finally{g(!1)}},A=async()=>{i(!0);try{const d=await fetch(`${n}/verify-2fa`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:C,username:F})}),y=await d.json();if(!d.ok)throw new Error(y.message||"2FA verification failed");y.status==="success"?I(y):w("Invalid 2FA code, please try again.")}catch(d){w(d.message)}finally{i(!1)}},I=({accessToken:d,refreshToken:y,user:x})=>{R(x,d),Q.set("token",d,{expires:1,secure:!0,sameSite:"Strict"}),Q.set("refreshToken",y,{expires:30,secure:!0,sameSite:"Strict"}),u({message:"Welcome back! Redirecting...",type:"success"}),e(),x.role==="admin"||x.role==="super admin"?c("/dashboard"):x.role==="staff"?c("/procurement"):x.role==="vendor"?c("/inventory"):u({message:"Unauthorized role.",type:"danger"})},ee=()=>N(d=>!d);return r.createElement("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center"},r.createElement(de,null,r.createElement(_e,{ref:E,size:"invisible",sitekey:Se}),r.createElement(z,{className:"justify-content-center"},r.createElement(P,{md:4,className:"d-flex flex-column align-items-center justify-content-center bg-primary text-white"},r.createElement("h2",null,"VENDOR PORTAL"),r.createElement("p",null,"Logistic Management System"),r.createElement(G,{to:"/",className:"text-white"},"Landing Page →")),r.createElement(P,{md:5},r.createElement(le,null,r.createElement(pe,{className:"p-4"},r.createElement(ue,null,p.message&&r.createElement(he,{color:p.type,dismissible:!0},p.message),S?r.createElement("div",{className:"mt-4"},r.createElement("h5",null,"Two-Factor Authentication"),h&&r.createElement("p",{className:"text-info"},h),r.createElement(H,{className:"mb-3"},r.createElement($,{placeholder:"Enter 2FA Code",value:C,onChange:d=>b(d.target.value)})),r.createElement(k,{color:"primary",onClick:A,disabled:s||!C.trim()},s?"Verifying...":"Verify Code")):r.createElement(fe,{onSubmit:o(q)},r.createElement("h1",null,"Login"),r.createElement("p",{className:"text-body-secondary"},"Sign In to your account"),r.createElement(H,{className:"mb-3"},r.createElement(Z,null,r.createElement(X,{icon:me})),r.createElement($,{ref:L,type:"text",placeholder:"Username",autoComplete:"username",...a("username",{required:"Username is required"})})),t.username&&r.createElement("p",{className:"text-danger"},t.username.message),r.createElement(H,{className:"mb-4"},r.createElement(Z,null,r.createElement(X,{icon:ae})),r.createElement($,{type:O?"text":"password",placeholder:"Password",autoComplete:"current-password",...a("password",{required:"Password is required"})}),r.createElement(k,{color:"secondary",variant:"outline",onClick:ee,type:"button"},r.createElement(oe,{icon:O?ie:se}))),t.password&&r.createElement("p",{className:"text-danger"},t.password.message),r.createElement(z,null,r.createElement(P,{sm:5},r.createElement(k,{color:"success",variant:"outline",className:"px-4",type:"submit",disabled:m},m?"Logging in...":"LOGIN")),r.createElement(P,{xs:"auto",className:"me-auto"},r.createElement(G,{to:"/forgotPass"},r.createElement(k,{color:"danger",variant:"outline",className:"px-4",disabled:m},m?"Processing...":"FORGOT PASSWORD")))),r.createElement(z,{className:"mt-3"},r.createElement(P,{xs:12,className:"text-center"},r.createElement(G,{to:"/register"},r.createElement(k,{color:"link",className:"px-0"},"Register Now!"))))))))))))};export{Ge as default};
