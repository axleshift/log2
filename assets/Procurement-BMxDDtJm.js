import{r as n,_ as V,R as b,a as S,c as P,P as o,b as ae,y as G,i as oe,j as e,C as ie,h as le}from"./index-DEmdhtkv.js";import{a as $}from"./index-DW_MHI2K.js";import{C as Y}from"./CForm-BvvF_kaV.js";import{C as L,a as F}from"./CRow-fCwqIY5j.js";import{C as E}from"./CFormInput-_fbGxJYO.js";import{C as ce}from"./CFormTextarea-Sbd1P89c.js";import{C as w,a as q}from"./CInputGroupText-DGEqc-XL.js";import{b as T,a as de}from"./CContainer-l_OEV5c6.js";import{p as ue,f as me,g as he,h as pe,j as fe,k as xe}from"./CNavItem-8rHQpnzQ.js";import{u as Ce,T as je,C as Z}from"./CCloseButton-B-4_Krdy.js";import{C as ee,a as se}from"./CCardBody-D_V14yWh.js";import{C as te}from"./CCardHeader-DibV801G.js";import{C as ve,a as be,b as J,c as M,d as ge,e as B}from"./CTable-DNInGac6.js";import{C as ye}from"./DefaultLayout-CaBZ_LUG.js";import{C as Te}from"./CFormControlWrapper-CnvfyOx9.js";import{C as Ne}from"./CFormSelect-BysY0XmE.js";import{C as Re,a as W}from"./CTabPane-CUKKwKRt.js";import"./index.esm-PQ4dROIH.js";import"./cil-user-Ddrdy7PS.js";import"./index-Dkr2Hnkf.js";var ne=n.createContext({}),A=n.forwardRef(function(s,r){var d=s.children,h=s.animation,t=h===void 0?!0:h,u=s.autohide,y=u===void 0?!0:u,j=s.className,v=s.color,g=s.delay,f=g===void 0?5e3:g,m=s.index,x=s.innerKey,N=s.visible,c=N===void 0?!1:N,l=s.onClose,i=s.onShow,R=V(s,["children","animation","autohide","className","color","delay","index","innerKey","visible","onClose","onShow"]),C=n.useRef(),a=Ce(r,C),k=n.useState(!1),p=k[0],O=k[1],I=n.useRef();n.useEffect(function(){O(c)},[c]);var re={visible:p,setVisible:O};n.useEffect(function(){return function(){return clearTimeout(I.current)}},[]),n.useEffect(function(){_()},[p]);var _=function(){y&&(clearTimeout(I.current),I.current=window.setTimeout(function(){O(!1)},f))};return b.createElement(je,{in:p,nodeRef:C,onEnter:function(){return i&&i(m??null)},onExited:function(){return l&&l(m??null)},timeout:250,unmountOnExit:!0},function(K){var Q;return b.createElement(ne.Provider,{value:re},b.createElement("div",S({className:P("toast",(Q={fade:t},Q["bg-".concat(v)]=v,Q["border-0"]=v,Q["show showing"]=K==="entering"||K==="exiting",Q.show=K==="entered",Q),j),"aria-live":"assertive","aria-atomic":"true",role:"alert",onMouseEnter:function(){return clearTimeout(I.current)},onMouseLeave:function(){return _()}},R,{key:x,ref:a}),d))})});A.propTypes={animation:o.bool,autohide:o.bool,children:o.node,className:o.string,color:ae,delay:o.number,index:o.number,innerKey:o.oneOfType([o.number,o.string]),onClose:o.func,onShow:o.func,visible:o.bool};A.displayName="CToast";var D=n.forwardRef(function(s,r){var d=s.children,h=s.className,t=V(s,["children","className"]);return b.createElement("div",S({className:P("toast-body",h)},t,{ref:r}),d)});D.propTypes={children:o.node,className:o.string};D.displayName="CToastBody";var U=n.forwardRef(function(s,r){var d=s.children,h=s.as,t=V(s,["children","as"]),u=n.useContext(ne).setVisible;return h?b.createElement(h,S({onClick:function(){return u(!1)}},t,{ref:r}),d):b.createElement(Z,S({onClick:function(){return u(!1)}},t,{ref:r}))});U.propTypes=S(S({},Z.propTypes),{as:o.elementType});U.displayName="CToastClose";var z=n.forwardRef(function(s,r){var d=s.children,h=s.className,t=s.closeButton,u=V(s,["children","className","closeButton"]);return b.createElement("div",S({className:P("toast-header",h)},u,{ref:r}),d,t&&b.createElement(U,null))});z.propTypes={children:o.node,className:o.string,closeButton:o.bool};z.displayName="CToastHeader";var H=n.forwardRef(function(s,r){var d=s.children,h=s.className,t=s.placement,u=s.push,y=V(s,["children","className","placement","push"]),j=n.useState([]),v=j[0],g=j[1],f=n.useRef(0);n.useEffect(function(){f.current++,u&&m(u)},[u]);var m=function(x){g(function(N){return G(G([],N,!0),[b.cloneElement(x,{index:f.current,innerKey:f.current,onClose:function(c){return g(function(l){return l.filter(function(i){return i.props.index!==c})})}})],!1)})};return b.createElement(ue,{portal:typeof t=="string"},v.length>0||d?b.createElement("div",S({className:P("toaster toast-container",{"position-fixed":t,"top-0":t&&t.includes("top"),"top-50 translate-middle-y":t&&t.includes("middle"),"bottom-0":t&&t.includes("bottom"),"start-0":t&&t.includes("start"),"start-50 translate-middle-x":t&&t.includes("center"),"end-0":t&&t.includes("end")},h)},y,{ref:r}),d,v.map(function(x){return b.cloneElement(x,{visible:!0})})):null)});H.propTypes={children:o.node,className:o.string,placement:o.oneOfType([o.string,o.oneOf(["top-start","top-center","top-end","middle-start","middle-center","middle-end","bottom-start","bottom-center","bottom-end"])]),push:o.any};H.displayName="CToaster";const Fe="https://backend-log2.axleshift.com/api/v1/rfq",Se=()=>`RFQ-${Date.now()}-${Math.floor(1e3+Math.random()*9e3)}`,Ee=()=>{const{accessToken:s}=oe(),[r,d]=n.useState({rfqNumber:Se(),title:"",description:"",items:[{name:"",quantity:0,unit:""}],vendors:[],budget:0,deadline:""}),[h,t]=n.useState(!1),[u,y]=n.useState(""),[j,v]=n.useState(""),[g,f]=n.useState(!1),m=c=>{const{name:l,value:i}=c.target;d({...r,[l]:i})},x=(c,l)=>{const{name:i,value:R}=c.target,C=[...r.items];C[l][i]=R,d({...r,items:C})},N=async c=>{var l,i,R;c.preventDefault(),f(!0);try{if(!s){console.error("No authentication token found."),y("Authentication error. Please log in again."),v("danger"),t(!0),setTimeout(()=>t(!1),5e3),f(!1);return}const C={Authorization:`Bearer ${s}`,"Content-Type":"application/json"};console.log("Sending request with headers:",C),await $.post(Fe,r,{headers:C}),y("RFQ created successfully!"),v("success"),t(!0),setTimeout(()=>t(!1),5e3),d({rfqNumber:"",title:"",description:"",items:[{name:"",quantity:0,unit:""}],vendors:[],budget:0,deadline:""})}catch(C){console.error("Error creating RFQ:",((l=C.response)==null?void 0:l.data)||C.message),y(((R=(i=C.response)==null?void 0:i.data)==null?void 0:R.message)||"Error creating RFQ"),v("danger"),t(!0),setTimeout(()=>t(!1),5e3)}finally{f(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{onSubmit:N,children:[e.jsxs(L,{className:"mb-3",children:[e.jsx(F,{md:6,children:e.jsx(E,{type:"text",name:"rfqNumber",value:r.rfqNumber,onChange:m,placeholder:"RFQ Number",label:"RFQ Number",required:!0})}),e.jsx(F,{md:6,children:e.jsx(E,{type:"text",name:"title",value:r.title,onChange:m,placeholder:"Title",label:"Title",required:!0})})]}),e.jsx(ce,{name:"description",value:r.description,onChange:m,placeholder:"Description",label:"Description",required:!0,rows:3}),r.items.map((c,l)=>e.jsxs(L,{className:"mb-3",children:[e.jsx(F,{md:4,children:e.jsxs(w,{children:[e.jsx(q,{children:"Item Name"}),e.jsx(E,{type:"text",name:"name",value:c.name,onChange:i=>x(i,l),placeholder:"Item Name",required:!0})]})}),e.jsx(F,{md:4,children:e.jsxs(w,{children:[e.jsx(q,{children:"Quantity"}),e.jsx(E,{type:"number",name:"quantity",value:c.quantity,onChange:i=>x(i,l),placeholder:"Quantity",required:!0})]})}),e.jsx(F,{md:4,children:e.jsxs(w,{children:[e.jsx(q,{children:"Unit"}),e.jsx(E,{type:"text",name:"unit",value:c.unit,onChange:i=>x(i,l),placeholder:"Unit",required:!0})]})})]},l)),e.jsx(T,{color:"primary",type:"button",onClick:()=>d({...r,items:[...r.items,{name:"",quantity:0,unit:""}]}),className:"mb-3",children:"Add Item"}),e.jsxs(L,{className:"mb-3",children:[e.jsx(F,{md:6,children:e.jsxs(w,{children:[e.jsx(q,{children:"Budget"}),e.jsx(E,{type:"number",name:"budget",value:r.budget,onChange:m,placeholder:"Budget",required:!0})]})}),e.jsx(F,{md:6,children:e.jsxs(w,{children:[e.jsx(q,{children:"Deadline"}),e.jsx(E,{type:"date",name:"deadline",value:r.deadline,onChange:m,required:!0})]})})]}),e.jsx(T,{color:"success",type:"submit",disabled:g,children:g?e.jsx(ie,{size:"sm"}):"Create RFQ"})]}),h&&e.jsx(H,{position:"top-center",className:"position-fixed top-0 start-50 translate-middle-x zindex-9999",children:e.jsxs(A,{color:j,visible:h,children:[e.jsxs(z,{children:[j==="success"?"Success":"Error",e.jsx(T,{color:"close",onClick:()=>t(!1),className:"ms-auto"})]}),e.jsx(D,{children:u})]})})]})},X="https://backend-log2.axleshift.com/api/v1/rfq",Qe="https://backend-log2.axleshift.com/api/v1/vendor",we=()=>{const s=le(),[r,d]=n.useState([]),[h,t]=n.useState([]),[u,y]=n.useState(null),[j,v]=n.useState(""),[g,f]=n.useState(!1),[m,x]=n.useState(!1),[N,c]=n.useState(""),[l,i]=n.useState("");n.useEffect(()=>{const a=async()=>{try{const p=await $.get(X);d(p.data)}catch(p){console.error("Error fetching RFQs:",p.response?p.response.data:p.message)}},k=async()=>{try{const p=await $.get(Qe);t(p.data)}catch(p){console.error("Error fetching vendors:",p.response?p.response.data:p.message)}};a(),k()},[]);const R=a=>{y(a),f(!0)},C=async()=>{if(!u||!j){c("Please select a vendor"),i("danger"),x(!0);return}try{console.log(`Inviting vendor ${j} to RFQ ${u}`);const a=await $.put(`${X}/${u}/invite-vendors`,{vendors:[j]},{headers:{"Content-Type":"application/json"}});console.log("Vendor invited successfully:",a.data),c("Vendor invited successfully!"),i("success"),x(!0),f(!1)}catch(a){console.error("Error inviting vendor:",a.response?a.response.data:a.message),c(`Failed to invite vendor: ${a.response?a.response.data.message:a.message}`),i("danger"),x(!0)}};return e.jsxs(e.Fragment,{children:[m&&e.jsx(H,{position:"top-center",className:"position-fixed top-0 start-50 translate-middle-x zindex-9999",children:e.jsxs(A,{color:l,visible:m,autohide:!0,onClose:()=>x(!1),children:[e.jsx(z,{children:l==="success"?"Success":"Error"}),e.jsx(D,{children:N})]})}),e.jsxs(ee,{children:[e.jsx(te,{className:"d-flex justify-content-between align-items-center",children:e.jsx("h5",{children:"Requests for Quotation (RFQs)"})}),e.jsx(se,{children:e.jsxs(ve,{hover:!0,responsive:!0,children:[e.jsx(be,{children:e.jsxs(J,{children:[e.jsx(M,{children:"RFQ Number"}),e.jsx(M,{children:"Title"}),e.jsx(M,{children:"Status"}),e.jsx(M,{children:"Actions"})]})}),e.jsx(ge,{children:r.map(a=>e.jsxs(J,{children:[e.jsx(B,{children:a.rfqNumber}),e.jsx(B,{children:a.title}),e.jsx(B,{children:e.jsx(ye,{color:a.status==="Open"?"success":"warning",children:a.status})}),e.jsxs(B,{children:[e.jsx(T,{color:"info",size:"sm",onClick:()=>s(`/procurement/rfqs/${a._id}`),children:"View"})," ",e.jsx(T,{color:"warning",size:"sm",onClick:()=>R(a._id),children:"Invite"})]})]},a._id))})]})})]}),e.jsxs(me,{visible:g,onClose:()=>f(!1),children:[e.jsx(he,{children:e.jsx(pe,{children:"Invite Vendor"})}),e.jsx(fe,{children:e.jsxs(Y,{children:[e.jsx(Te,{children:"Select Vendor"}),e.jsxs(Ne,{value:j,onChange:a=>v(a.target.value),children:[e.jsx("option",{value:"",children:"Select a vendor"}),h.map(a=>e.jsx("option",{value:a._id,children:a.businessName},a._id))]})]})}),e.jsxs(xe,{children:[e.jsx(T,{color:"secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx(T,{color:"primary",onClick:C,children:"Invite Vendor"})]})]})]})},Xe=()=>{const[s,r]=n.useState("createRFQ");return e.jsx(de,{children:e.jsx(L,{className:"mb-3",children:e.jsx(F,{children:e.jsxs(ee,{children:[e.jsxs(te,{children:[e.jsx(T,{color:s==="createRFQ"?"primary":"secondary",onClick:()=>r("createRFQ"),className:`ms-2 ${s==="createRFQ"?"active-tab":""}`,style:{transition:"all 0.3s ease"},children:"Create RFQ"}),e.jsx(T,{color:s==="rfqList"?"primary":"secondary",onClick:()=>r("rfqList"),className:`ms-2 ${s==="rfqList"?"active-tab":""}`,style:{transition:"all 0.3s ease"},children:"RFQ List"})]}),e.jsx(se,{children:e.jsxs(Re,{children:[e.jsx(W,{visible:s==="createRFQ",children:e.jsx(Ee,{})}),e.jsx(W,{visible:s==="rfqList",children:e.jsx(we,{})})]})})]})})})})};export{Xe as default};
