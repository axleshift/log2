import{r as t,f as D,j as e}from"./index-DcIUbS2z.js";import{C as G}from"./index.esm-CkvEgToE.js";import{a as x}from"./axios-DXsv3KKR.js";import{C as M,a as k}from"./CContainer-Bnr83wtY.js";import{C as b,a as L}from"./CRow-D8GycT6X.js";import{C as _}from"./CCardGroup-Dcuzc6pA.js";import{C as Y,a as z}from"./CCardBody-BSjULxJq.js";import{C as H}from"./CForm-D02JmVKs.js";import{C as f,a as w}from"./CInputGroupText-DUdw71Lw.js";import{c as J}from"./cil-user-Ddrdy7PS.js";import{C as g}from"./CFormInput-B-yHs6lW.js";const y="https://backend-log2.axleshift.com/api/v1/auth",ne=()=>{const[l,N]=t.useState(""),[m,S]=t.useState(""),[p,O]=t.useState(""),[C,E]=t.useState(""),[j,a]=t.useState(!1),[P,r]=t.useState(""),[v,c]=t.useState(""),[d,T]=t.useState(!1),[u,q]=t.useState(!1),R=D(),A=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),F=async s=>await x.post(`${y}/forgot-password`,s),I=async s=>await x.post(`${y}/verify-otp`,s),V=async s=>await x.post(`${y}/change-password`,s),$=async s=>{var o,n;if(s.preventDefault(),a(!0),r(""),c(""),!l){r("Email is required."),a(!1);return}if(!A(l)){r("Please enter a valid email address."),a(!1);return}try{(await F({email:l})).status===200&&(c("A reset code has been sent to your email. Please check your inbox."),T(!0))}catch(i){const h=((n=(o=i.response)==null?void 0:o.data)==null?void 0:n.message)||"An error occurred while sending the OTP.";r(h)}finally{a(!1)}},U=async s=>{var o,n;if(s.preventDefault(),a(!0),r(""),!m){r("OTP is required."),a(!1);return}try{(await I({email:l,otp:m})).status===200&&(c("OTP verified successfully! You can now set a new password."),q(!0))}catch(i){const h=((n=(o=i.response)==null?void 0:o.data)==null?void 0:n.message)||"An error occurred while verifying the OTP.";r(h)}finally{a(!1)}},B=async s=>{var o,n;if(s.preventDefault(),a(!0),r(""),c(""),!p||!m){r("Both OTP and new password fields are required."),a(!1);return}if(p.length<6){r("New password must be at least 6 characters long."),a(!1);return}if(p!==C){r("Passwords do not match."),a(!1);return}try{(await V({email:l,otp:m,newPassword:p})).status===200&&(c("Password changed successfully. Redirecting to login..."),setTimeout(()=>R("/login"),2e3))}catch(i){const h=((n=(o=i.response)==null?void 0:o.data)==null?void 0:n.message)||"An error occurred while changing the password.";r(h)}finally{a(!1)}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(M,{children:e.jsx(b,{className:"justify-content-center",children:e.jsx(L,{md:5,children:e.jsx(_,{children:e.jsx(Y,{className:"p-4",children:e.jsx(z,{children:e.jsxs(H,{onSubmit:u?B:d?U:$,children:[e.jsx("h1",{children:u?"Change Password":d?"Verify OTP":"Forgot Password"}),e.jsx("p",{className:"text-body-secondary",children:u?"Enter your new password":d?"Enter the OTP sent to your email":"Enter your email to reset your password"}),P&&e.jsx("div",{className:"alert alert-danger",children:P}),v&&e.jsx("div",{className:"alert alert-success",children:v}),!d&&e.jsxs(f,{className:"mb-4",children:[e.jsx(w,{children:e.jsx(G,{icon:J})}),e.jsx(g,{type:"email",placeholder:"Email",autoComplete:"email",value:l,onChange:s=>{N(s.target.value),r(""),c("")},required:!0})]}),d&&!u&&e.jsxs(f,{className:"mb-4",children:[e.jsx(w,{children:"OTP"}),e.jsx(g,{type:"text",placeholder:"Enter OTP",value:m,onChange:s=>S(s.target.value),required:!0})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{className:"mb-4",children:[e.jsx(w,{children:"New Password"}),e.jsx(g,{type:"password",placeholder:"Enter New Password",value:p,onChange:s=>O(s.target.value),required:!0})]}),e.jsxs(f,{className:"mb-4",children:[e.jsx(w,{children:"Confirm Password"}),e.jsx(g,{type:"password",placeholder:"Confirm New Password",value:C,onChange:s=>E(s.target.value),required:!0})]})]}),e.jsx(b,{children:e.jsx(k,{type:"submit",color:"primary",disabled:j,children:j?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):u?"Change Password":d?"Verify OTP":"Send Reset Code"})})]})})})})})})})})};export{ne as default};
