import{u as D,r as s,R as e,C as U}from"./index-DTvdQ_Ry.js";import{a as V,b as B,c as m}from"./CRow-imBghfl_.js";import{C as R,a as j}from"./CCardBody-C7BUhqVB.js";import{g as M,h as P,j as f,k as i,l as L,m as o,c as z,d as H,n as F,e as I,f as O}from"./CTable-DTArR106.js";import"./CCloseButton-D-b4e532.js";const h="https://backend-log2.axleshift.com/api/v1/auth",G="https://backend-log2.axleshift.com/api/v1/vendor",W=()=>{const{accessToken:l}=D(),[C,E]=s.useState([]),[y,b]=s.useState(!0),[N,u]=s.useState(!1),[n,T]=s.useState(null),[r,A]=s.useState(null),[g,d]=s.useState(null);s.useEffect(()=>{if(!l)return;(async()=>{try{const a=await fetch(`${h}/users`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);const c=(await a.json()).users.filter(k=>k.role==="vendor");E(c)}catch(a){console.error("Error fetching users:",a),E([])}finally{b(!1)}})()},[l]);const w=async t=>{try{const a=await fetch(`${G}/user/${t}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});if(a.ok){const p=await a.json();A(p)}else console.error("Error fetching vendor details:",a.statusText)}catch(a){console.error("Error fetching vendor details:",a)}},v=(t,a)=>{E(p=>p.map(c=>c._id===t?{...c,status:a}:c))},S=async t=>{if(l){d(t);try{const a=await fetch(`${h}/approve/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});a.ok?v(t,"Approved"):console.error("Error approving user",a.statusText)}catch(a){console.error("Error approving user:",a)}finally{d(null)}}},$=async t=>{if(l){d(t);try{const a=await fetch(`${h}/cancel-approval/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});a.ok?v(t,"Pending"):console.error("Error canceling approval:",a.statusText)}catch(a){console.error("Error canceling approval:",a)}finally{d(null)}}},x=t=>{T(t),w(t._id),u(!0)},_=t=>{switch(t){case"Approved":return"success";case"Pending":return"warning";default:return"secondary"}};return e.createElement(e.Fragment,null,e.createElement(V,null,e.createElement(B,{xs:"12"},e.createElement(R,{className:"shadow-lg"},e.createElement(j,null,e.createElement("h4",{className:"text-primary"},"Vendor Management"),y?e.createElement("div",{className:"d-flex justify-content-center"},e.createElement(U,{color:"primary"})):e.createElement(M,{striped:!0,bordered:!0,hover:!0,responsive:!0},e.createElement(P,{className:"bg-transparent"},e.createElement(f,null,e.createElement(i,null,"User ID"),e.createElement(i,null,"Email"),e.createElement(i,null,"Status"),e.createElement(i,null,"Role"),e.createElement(i,null,"Actions"))),e.createElement(L,null,C.length>0?C.map(t=>e.createElement(f,{key:t._id,className:"text-center"},e.createElement(o,null,t._id),e.createElement(o,null,t.email),e.createElement(o,null,e.createElement(m,{color:_(t.status),className:"mr-2"},t.status)),e.createElement(o,null,t.role),e.createElement(o,null,e.createElement(m,{color:"info",onClick:()=>x(t),className:"mr-2"},"View Details"),t.status==="Approved"?e.createElement(m,{color:"warning",onClick:()=>$(t._id),className:"ml-2",disabled:g===t._id},"Cancel Approval"):e.createElement(m,{color:"success",onClick:()=>S(t._id),className:"ml-2",disabled:g===t._id},"Approve")))):e.createElement(f,null,e.createElement(o,{colSpan:"5",className:"text-center"},"No vendors found.")))))))),e.createElement(z,{visible:N,onClose:()=>u(!1)},e.createElement(H,{onClose:()=>u(!1)},e.createElement(F,null,"User Details")),e.createElement(I,null,n&&r&&e.createElement("div",null,e.createElement("p",null,e.createElement("strong",null,"User ID:")," ",n._id),e.createElement("p",null,e.createElement("strong",null,"Name:")," ",(n==null?void 0:n.username)||"N/A"),e.createElement("p",null,e.createElement("strong",null,"Email:")," ",n.email),e.createElement("p",null,e.createElement("strong",null,"Status:")," ",n.status),e.createElement("p",null,e.createElement("strong",null,"Role:")," ",n.role),e.createElement("h5",{className:"mt-3"},"Vendor Information"),e.createElement("p",null,e.createElement("strong",null,"Business Name:")," ",r.businessName),e.createElement("p",null,e.createElement("strong",null,"Full Name:")," ",r.fullName),e.createElement("p",null,e.createElement("strong",null,"Business Address:")," ",r.businessAddress),e.createElement("p",null,e.createElement("strong",null,"Contact Number:")," ",r.contactNumber),e.createElement("p",null,e.createElement("strong",null,"Tax ID:")," ",r.taxId),e.createElement("h5",{className:"mt-3"},"Documents"),e.createElement("ul",null,r.documents&&Object.entries(r.documents).map(([t,a])=>a?e.createElement("li",{key:t},e.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},t.replace(/([A-Z])/g," $1")," - View Document")):null)))),e.createElement(O,null,e.createElement(m,{color:"secondary",onClick:()=>u(!1)},"Close"))))};export{W as default};
