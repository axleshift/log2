import{y as b,i as B,k,r as n,R as e,C as q}from"./index-CBDYk9Ao.js";import{a as S}from"./index-C88pvD_q.js";import{C as _,a as M}from"./CCardBody-E11mcyvL.js";import{C as T}from"./CCardHeader-BshgPxRz.js";import{b as s}from"./CContainer-BVTxmlXV.js";import{C as w}from"./DefaultLayout-DGyvqXFF.js";import{C as F,a as A,b as p,c as u,d as N,e as c}from"./CTable-Di3XAasM.js";import{C as U,a as $,b as x,c as L}from"./CModalHeader-BKFu_ZhO.js";import"./index.esm-NRZ6HBye.js";import"./CNavItem-BCds_oRM.js";import"./CCloseButton-DIWbhS5b.js";import"./cil-user-Ddrdy7PS.js";import"./index-Bor_YxxL.js";const O="https://backend-log2.axleshift.com/api/v1/procurement",te=()=>{var P,y;const{id:m}=b(),i=B(),{user:a}=k(),[t,h]=n.useState(null),[v,d]=n.useState(!0),[f,g]=n.useState(null),[Q,E]=n.useState(!1);n.useEffect(()=>{(async()=>{var r,o;if(!m){g("Invalid Procurement ID"),d(!1);return}try{d(!0);const C=await S.get(`${O}/${m}`);h(C.data)}catch(C){g(((o=(r=C.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to load Procurement")}finally{d(!1)}})()},[m]),n.useEffect(()=>{var l,r;console.log("Procurement Status:",t==null?void 0:t.status),console.log("Requested By:",(l=t==null?void 0:t.requestedBy)==null?void 0:l._id),console.log("Current User:",a==null?void 0:a._id),(t==null?void 0:t.status)==="Approved"&&((r=t==null?void 0:t.requestedBy)==null?void 0:r._id)===(a==null?void 0:a._id)&&(setApprovalModal(!0),E(!0))},[t,a]);const D=()=>{i(`/rfq/create/${t._id}`)},R=()=>{i(`/po/create/${t._id}`)};return v?e.createElement(q,{color:"primary"}):f?e.createElement("div",null,f):t?e.createElement(_,null,e.createElement(T,null,e.createElement("h5",null,"Procurement Details"),e.createElement(s,{color:"secondary",onClick:()=>i(-1)},"Back to Procurement List")),e.createElement(M,null,e.createElement("h6",null,e.createElement("strong",null,"Procurement ID:")," ",t._id),e.createElement("h6",null,e.createElement("strong",null,"Title:")," ",t.title),e.createElement("h6",null,e.createElement("strong",null,"Department:")," ",t.department),e.createElement("h6",null,e.createElement("strong",null,"Status:")," ",e.createElement(w,{color:t.status==="Pending"?"warning":t.status==="Approved"?"success":"danger"},t.status)),e.createElement("h6",null,e.createElement("strong",null,"Requested By:")," ",((P=t.requestedBy)==null?void 0:P.email)||"Unknown"),e.createElement("h6",null,e.createElement("strong",null,"Procurement Date:")," ",new Date(t.procurementDate).toLocaleDateString()),e.createElement("h6",null,e.createElement("strong",null,"Delivery Date:")," ",new Date(t.deliveryDate).toLocaleDateString()),e.createElement("hr",null),e.createElement("h6",null,e.createElement("strong",null,"Products")),e.createElement(F,{hover:!0,responsive:!0},e.createElement(A,null,e.createElement(p,null,e.createElement(u,null,"Name"),e.createElement(u,null,"Quantity"),e.createElement(u,null,"Unit"),e.createElement(u,null,"Unit Price"))),e.createElement(N,null,((y=t.products)==null?void 0:y.length)>0?t.products.map((l,r)=>{var o;return e.createElement(p,{key:r},e.createElement(c,null,l.name),e.createElement(c,null,l.quantity),e.createElement(c,null,l.unit),e.createElement(c,null,"$",((o=l.unitPrice)==null?void 0:o.toFixed(2))||"N/A"))}):e.createElement(p,null,e.createElement(c,{colSpan:"4"},"No products added yet.")))),e.createElement("hr",null),e.createElement(U,{visible:!0,onClose:()=>E(!1)},e.createElement($,null,"Create RFQ or PO"),e.createElement(x,null,"Your procurement request has been approved. Would you like to create an RFQ or proceed directly with a PO?"),e.createElement(L,null,e.createElement(s,{color:"primary",onClick:D},"Create RFQ"),e.createElement(s,{color:"success",onClick:R},"Create PO"),e.createElement(s,{color:"secondary",onClick:()=>E(!1)},"Cancel"))))):e.createElement("div",null,"No Procurement found.")};export{te as default};
