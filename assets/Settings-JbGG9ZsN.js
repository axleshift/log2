import{j as s,P as a,i as S,r as l}from"./index-DEmdhtkv.js";import{f as w,g as R,h as _,j as k,k as $}from"./CNavItem-8rHQpnzQ.js";import{b as x}from"./CContainer-l_OEV5c6.js";import{C as B,a as M}from"./CRow-fCwqIY5j.js";import{C as D,a as P}from"./CCardBody-D_V14yWh.js";import{C as q,a as L,b as m,c,d as F,e as o}from"./CTable-DNInGac6.js";import"./CCloseButton-B-4_Krdy.js";const A=({visible:i,onClose:t,user:r})=>{var d;return console.log(r),s.jsxs(w,{visible:i,onClose:t,children:[s.jsx(R,{onClose:t,children:s.jsx(_,{children:"User Details"})}),s.jsx(k,{children:r?s.jsxs("div",{children:[s.jsxs("p",{children:[s.jsx("strong",{children:"User ID:"})," ",r._id]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Name:"})," ",r.name||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Email:"})," ",r.email]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Status:"})," ",r.status]}),r.role==="vendor"&&r.details?s.jsxs(s.Fragment,{children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Business Name:"})," ",r.details.businessName||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Full Name:"})," ",r.details.fullName||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Business Address:"})," ",r.details.businessAddress||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Contact Number:"})," ",r.details.contactNumber||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Tax ID:"})," ",r.details.taxId||"N/A"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Certifications:"})," ",((d=r.details.certifications)==null?void 0:d.join(", "))||"N/A"]})]}):s.jsx("p",{children:"No vendor details available."})]}):s.jsx("div",{children:"Loading details..."})}),s.jsx($,{children:s.jsx(x,{color:"secondary",onClick:t,children:"Close"})})]})};A.propTypes={visible:a.bool.isRequired,onClose:a.func.isRequired,user:a.shape({_id:a.string.isRequired,name:a.string,email:a.string.isRequired,status:a.string.isRequired,role:a.string.isRequired,details:a.shape({businessName:a.string,fullName:a.string,businessAddress:a.string,contactNumber:a.string,taxId:a.string,certifications:a.arrayOf(a.string)})})};const g="https://backend-log2.axleshift.com/api/v1/auth",K=()=>{const{accessToken:i}=S(),[t,r]=l.useState([]),[d,b]=l.useState(!0),[N,u]=l.useState(!1),[v,y]=l.useState(null),[f,h]=l.useState(null);l.useEffect(()=>{if(!i)return;(async()=>{try{const n=await fetch(`${g}/users`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const p=await n.json();r(Array.isArray(p.users)?p.users:[])}catch(n){console.error("Error fetching users:",n),r([])}finally{b(!1)}})()},[i]);const C=(e,n)=>{r(p=>p.map(j=>j._id===e?{...j,status:n}:j))},T=async e=>{if(i){h(e);try{const n=await fetch(`${g}/approve/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});n.ok?C(e,"Approved"):console.error("Error approving user",n.statusText)}catch(n){console.error("Error approving user:",n)}finally{h(null)}}},U=async e=>{if(i){h(e);try{const n=await fetch(`${g}/cancel-approval/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});n.ok?C(e,"Pending"):console.error("Error canceling approval:",n.statusText)}catch(n){console.error("Error canceling approval:",n)}finally{h(null)}}},E=e=>{y(e),u(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(B,{children:s.jsx(M,{xs:"12",children:s.jsx(D,{children:s.jsxs(P,{children:[s.jsx("h4",{children:"User Management"}),d?s.jsx("div",{children:"Loading..."}):s.jsxs(q,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[s.jsx(L,{children:s.jsxs(m,{children:[s.jsx(c,{children:"User ID"}),s.jsx(c,{children:"Name"}),s.jsx(c,{children:"Email"}),s.jsx(c,{children:"Status"}),s.jsx(c,{children:"Actions"})]})}),s.jsx(F,{children:t.length>0?t.map(e=>s.jsxs(m,{children:[s.jsx(o,{children:e._id}),s.jsx(o,{children:(e==null?void 0:e.name)||"N/A"}),s.jsx(o,{children:e.email}),s.jsx(o,{children:e.status}),s.jsxs(o,{children:[s.jsx(x,{color:"info",onClick:()=>E(e),children:"View Details"}),e.status==="Approved"?s.jsx(x,{color:"warning",onClick:()=>U(e._id),className:"ml-2",disabled:f===e._id,children:"Cancel Approval"}):s.jsx(x,{color:"success",onClick:()=>T(e._id),className:"ml-2",disabled:f===e._id,children:"Approve"})]})]},e._id)):s.jsx(m,{children:s.jsx(o,{colSpan:"5",className:"text-center",children:"No users found."})})})]})]})})})}),s.jsx(A,{visible:N,onClose:()=>u(!1),user:v})]})};export{K as default};
