import{u as se,r as s,R as e,C as le}from"./index-Df9FpgGG.js";import{a as p}from"./index-xsH4HHeE.js";import{c as P,a as T,b as c}from"./CRow-BRQUFdmN.js";import{g as ce,h as de,j as U,k as E,l as me,m as h,c as ue,d as ie,n as pe,e as Ee}from"./CTable-BOmMjUHN.js";import{C as he}from"./CForm-CkP86w7n.js";import{a as g}from"./CFormInput-9dqQqDLp.js";import{C as S}from"./CFormSelect-D_ITgft6.js";import{a as be,b as Ce,c as Pe,d as ge}from"./DefaultLayout-CeN2UJo9.js";import"./CCloseButton-Bj5E3YNr.js";import"./CFormTextarea-BVbqQ895.js";import"./index.esm-D2eU3ktu.js";import"./CCardBody-BAtN4vhT.js";import"./CCardHeader-B0KK86zY.js";import"./CAlert-DGrWNNSZ.js";import"./cil-user-Ddrdy7PS.js";import"./index-CQQWFoo2.js";const _="https://backend-log2.axleshift.com",z=`${_}/api/v1/purchaseOrder`,fe=`${_}/api/v1/procurement`,ve=`${_}/api/v1/vendor`,ye=`${_}/api/v1/product`,Ne="https://backend-log1.axleshift.com/api/v1/warehouseLoc/locations",Ie=()=>{const{accessToken:i}=se(),[L,O]=s.useState(!1),[R,F]=s.useState([]),[V,j]=s.useState([]),[H,W]=s.useState([]),[Q,G]=s.useState([]),[d,J]=s.useState([]),[K,x]=s.useState("PO-123456"),[Te,X]=s.useState(null),[m,A]=s.useState(1),f=5,Y=()=>{const[t,r]=K.split("-"),a=parseInt(r.replace(/^0+/,""))||0,n=String(a+1).padStart(6,"0"),o=`${t}-${n}`;return x(o),X(o),o},[l,b]=s.useState({procurementId:"",vendorId:"",shipTo:"",rfqId:"",poNumber:"",orderDate:"",receiveDate:"",carrier:"",additionalNotes:"",products:[{productId:"",description:"",quantity:0,unitPrice:0}]}),[v,D]=s.useState({show:!1,message:"",color:""}),[w,q]=s.useState(!1),B=async()=>{try{const[t,r,a,n,o]=await Promise.all([p.get(z,{headers:{Authorization:`Bearer ${i}`}}),p.get(fe,{headers:{Authorization:`Bearer ${i}`}}),p.get(ve,{headers:{Authorization:`Bearer ${i}`}}),p.get(ye,{headers:{Authorization:`Bearer ${i}`}}),p.get(Ne,{headers:{"Content-Type":"application/json","x-api-key":"0ad3f5c013c42d2d0537672a260978c71dcd5a7d508019d748f991deee3d65665a477e3523c6bbc83fd6a51a71dd5003"},withCredentials:!0})]);F(t.data),j(r.data),W(a.data),G(n.data),J(o.data);const u=t.data.map(oe=>oe.poNumber).filter(Boolean).sort(),I=u[u.length-1];I&&x(I)}catch(t){console.error("Failed to fetch data:",t)}},C=t=>{const{name:r,value:a}=t.target;b(n=>({...n,[r]:a}))},y=(t,r)=>{const{name:a,value:n}=t.target,o=[...l.products];o[r][a]=["quantity","unitPrice"].includes(a)?parseFloat(n):n,b(u=>({...u,products:o}))},Z=()=>{b(t=>({...t,products:[...t.products,{productId:"",description:"",quantity:0,unitPrice:0}]}))},ee=()=>{b({procurementId:"",vendorId:"",shipTo:"",rfqId:"",poNumber:"",orderDate:"",receiveDate:"",carrier:"",additionalNotes:"",warehouse_id:"",products:[{productId:"",description:"",quantity:0,unitPrice:0}]})},N=(t,r)=>{D({show:!0,message:t,color:r}),setTimeout(()=>D({show:!1,message:"",color:""}),5e3)},te=t=>{var r,a;return((a=(r=d==null?void 0:d.data)==null?void 0:r.find(n=>n._id===t))==null?void 0:a.warehouseName)||"—"},ae=async t=>{var r,a;if(t.preventDefault(),!i)return N("Not authenticated.","danger");q(!0);try{const n={...l,warehouse_id:l.shipTo};if(n.shipTo||delete n.shipTo,n.rfqId||delete n.rfqId,!n.products.length||n.products.some(o=>!o.productId||!o.description)){N("Each product must have a product and description","danger"),q(!1);return}await p.post(z,n,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),N("Purchase Order Created!","success"),ee(),B(),O(!1)}catch(n){console.error("❌ PO creation error:",n),N(((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.message)||"Error creating Purchase Order","danger")}finally{q(!1)}};s.useEffect(()=>{B()},[]);const re=()=>{const t=Y();b(r=>({...r,poNumber:t})),O(!0)},$=t=>{const r=Math.ceil(R.length/f);t==="next"&&m<r?A(m+1):t==="prev"&&m>1&&A(m-1)},k=(m-1)*f,ne=R.slice(k,k+f),M=Math.ceil(R.length/f);return e.createElement(e.Fragment,null,e.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},e.createElement("h4",null,"Purchase Orders"),e.createElement(P,{type:"button",color:"primary",onClick:()=>re()},"+ Create Purchase Order")),e.createElement(ce,{striped:!0,responsive:!0,hover:!0},e.createElement(de,null,e.createElement(U,null,e.createElement(E,null,"#"),e.createElement(E,null,"PO Number"),e.createElement(E,null,"Vendor"),e.createElement(E,null,"Procurement"),e.createElement(E,null,"Ship To"),e.createElement(E,null,"Products"))),e.createElement(me,null,ne.map((t,r)=>{var a,n,o;return e.createElement(U,{key:t._id},e.createElement(h,null,k+r+1),e.createElement(h,null,t.poNumber||"—"),e.createElement(h,null,((a=t.vendor)==null?void 0:a.businessName)||"—"),e.createElement(h,null,((n=t.procurementId)==null?void 0:n.title)||"—"),e.createElement(h,null,te(t.shipTo)),e.createElement(h,null,((o=t.details)==null?void 0:o.map((u,I)=>e.createElement("div",{key:I},u.description," — ",u.quantity," @ ",u.unitPrice)))||"—"))}))),e.createElement("div",{className:"d-flex justify-content-between align-items-center mt-3"},e.createElement("span",null,"Page ",m," of ",M),e.createElement("div",null,e.createElement(P,{color:"secondary",className:"me-2",size:"sm",onClick:()=>$("prev"),disabled:m===1},"← Prev"),e.createElement(P,{color:"secondary",size:"sm",onClick:()=>$("next"),disabled:m>=M},"Next →"))),e.createElement(ue,{visible:L,onClose:async()=>{O(!1)},size:"lg"},e.createElement(ie,null,e.createElement(pe,null,"Create Purchase Order")),e.createElement(Ee,null,e.createElement(he,{onSubmit:ae},e.createElement(T,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(g,{name:"poNumber",value:l.poNumber,onChange:C,label:"PO Number",required:!0})),e.createElement(c,{md:6},e.createElement(g,{type:"date",name:"orderDate",value:l.orderDate,onChange:C,label:"Order Date",required:!0}))),e.createElement(T,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(S,{name:"procurementId",value:l.procurementId,onChange:C,label:"Procurement",required:!0},e.createElement("option",{value:""},"Select Procurement"),V.map(t=>e.createElement("option",{key:t._id,value:t._id},t.title)))),e.createElement(c,{md:6},e.createElement(S,{name:"vendorId",value:l.vendorId,onChange:C,label:"Vendor",required:!0},e.createElement("option",{value:""},"Select Vendor"),H.map(t=>e.createElement("option",{key:t._id,value:t._id},t.businessName))))),d?e.createElement(T,{className:"mb-3"},e.createElement(c,{md:6},e.createElement(S,{name:"shipTo",value:l.shipTo,onChange:C,label:"Ship To (Warehouse)"},e.createElement("option",{value:""},"Select Warehouse"),Array.isArray(d==null?void 0:d.data)&&d.data.map(t=>e.createElement("option",{key:t._id,value:t._id},t.warehouseName))))):e.createElement("div",null),e.createElement("h6",{className:"mt-3"},"Products"),l.products.map((t,r)=>e.createElement(T,{className:"mb-3",key:r},e.createElement(c,{md:4},e.createElement(S,{name:"productId",label:"Product",value:t.productId,onChange:a=>y(a,r),required:!0},e.createElement("option",{value:""},"Select Product"),Q.map(a=>e.createElement("option",{key:a._id,value:a._id},a.name)))),e.createElement(c,{md:4},e.createElement(g,{type:"text",name:"description",label:"Description",value:t.description,onChange:a=>y(a,r),required:!0})),e.createElement(c,{md:2},e.createElement(g,{type:"number",name:"quantity",label:"Qty",value:t.quantity,onChange:a=>y(a,r),required:!0})),e.createElement(c,{md:2},e.createElement(g,{type:"number",name:"unitPrice",label:"Unit Price",value:t.unitPrice,onChange:a=>y(a,r),required:!0})))),e.createElement(P,{onClick:Z,color:"secondary",className:"mb-3"},"+ Add Product"),e.createElement("div",{className:"text-end"},e.createElement(P,{type:"submit",color:"success",disabled:w},w?e.createElement(le,{size:"sm"}):"Create PO"))))),e.createElement(be,{placement:"top-end"},v.show&&e.createElement(Ce,{autohide:!0,visible:!0,color:v.color},e.createElement(Pe,{closeButton:!0},v.color==="success"?"Success":"Error"),e.createElement(ge,null,v.message))))},Fe=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4"},"CreatePurchaseOrder"),e.createElement(Ie,null));export{Fe as default};
