import{R as e,P as c,u as _,l as H,r as d,C as L}from"./index-DZfE5c-b.js";import{a as A}from"./index-t--hEgTQ.js";import{C as U}from"./CFormTextarea-FED7pE9Z.js";import{C as $}from"./CFormSelect-BH_FWxaD.js";import{a as V}from"./CFormInput-eY5Z5ntw.js";import{c as E,a as P,b as o}from"./CRow-DcJW25wv.js";import{b as j,c as K,d as Q,f as G,g as X,h as B,j as R,k as J,l as S}from"./CTable-C8VLslgc.js";import{C as W,a as Y}from"./CCardBody-CJbgDnbm.js";import{C as Z,a as ee,b as te,c as ae,d as re}from"./DefaultLayout-BZ3SpNnn.js";import"./CCloseButton-BehUEh2q.js";import"./CForm-D8cqiWRb.js";import"./CCardHeader-Clixh7Cc.js";import"./CAlert-CA819VF8.js";import"./index.esm-Bvm-VaJ5.js";import"./cil-user-Ddrdy7PS.js";import"./index-Tvh2umWT.js";const m=({label:l,type:v="text",name:p,value:n,onChange:u,placeholder:D="",required:C=!1,options:f=[],rows:q=3,disabled:g=!1})=>v==="textarea"?e.createElement(U,{label:l,name:p,value:n,onChange:u,placeholder:D,required:C,rows:q,disabled:g,"aria-label":l}):v==="select"?e.createElement($,{label:l,name:p,value:n,onChange:u,required:C,disabled:g,"aria-label":l},e.createElement("option",{value:""},"Select ",l),f.map((y,N)=>e.createElement("option",{key:N,value:y},y))):e.createElement(V,{type:v,name:p,value:n,onChange:u,placeholder:D,label:l,required:C,disabled:g,"aria-label":l});m.propTypes={label:c.string.isRequired,type:c.oneOf(["text","number","date","textarea","select"]),name:c.string.isRequired,value:c.oneOfType([c.string,c.number]).isRequired,onChange:c.func.isRequired,placeholder:c.string,required:c.bool,options:c.arrayOf(c.string),rows:c.number,disabled:c.bool};const ne="https://backend-log2.axleshift.com",I=`${ne}/api/v1/procurement`,le=()=>{const{accessToken:l,user:v}=_(),p=H(),[n,u]=d.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[D,C]=d.useState([]),[f,q]=d.useState(!1),[g,y]=d.useState(!1),[N,w]=d.useState([]),[se,ce]=d.useState(!1),[oe,me]=d.useState(null);d.useEffect(()=>{(async()=>{if(l)try{const r=await A.get(I,{headers:{Authorization:`Bearer ${l}`}});w(r.data)}catch(r){console.error("Error fetching procurements:",r)}})()},[l]);const b=t=>{const{name:r,value:a}=t.target;u(s=>({...s,[r]:a}))},T=(t,r)=>{const{name:a,value:s}=r.target,i=[...n.products];i[t]={...i[t],[a]:a==="quantity"||a==="unitPrice"?s===""?"":parseFloat(s):s};const k=i.reduce((h,F)=>h+(F.unitPrice||0)*(F.quantity||0),0);u(h=>({...h,products:i,estimatedCost:parseFloat(k.toFixed(2))}))},M=()=>{u(t=>({...t,products:[...t.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},z=t=>{const r=n.products.filter((a,s)=>s!==t);u(a=>({...a,products:r,estimatedCost:r.reduce((s,i)=>s+(i.unitPrice*i.quantity||0),0)}))},O=async t=>{var r,a;if(t.preventDefault(),!f){q(!0);try{if(!l)throw new Error("Authentication error. Please log in again.");const s={Authorization:`Bearer ${l}`,"Content-Type":"application/json"},i={...n,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null},k=await A.post(I,i,{headers:s});w(h=>[...h,k.data]),u({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),y(!1),x("âœ… Procurement Request created successfully!","success")}catch(s){x(((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{q(!1)}}},x=(t,r)=>{C(a=>[...a,{id:Date.now(),message:t,color:r}]),setTimeout(()=>C(a=>a.slice(1)),5e3)};return e.createElement(e.Fragment,null,e.createElement(E,{color:"primary",onClick:()=>y(!0),className:"mb-3"},"+ Create Procurement"),e.createElement(j,{visible:g,onClose:()=>y(!1),size:"lg"},e.createElement(K,null,"Create Procurement Request"),e.createElement(Q,null,e.createElement("form",{onSubmit:O},e.createElement(P,{className:"mb-3"},e.createElement(o,{md:6},e.createElement(m,{label:"Title",name:"title",value:n.title,onChange:b,required:!0})),e.createElement(o,{md:6},e.createElement(m,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:b,required:!0}))),e.createElement(m,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:b,required:!0,rows:3}),e.createElement(P,{className:"mb-3"},e.createElement(o,{md:6},e.createElement(m,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:b})),e.createElement(o,{md:6},e.createElement(m,{label:"Department",type:"select",name:"department",value:n.department,onChange:b,options:["HR","Finance","Logistics","IT","Procurement"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((t,r)=>e.createElement(P,{key:r,className:"mb-2"},e.createElement(o,{md:2},e.createElement(m,{label:"Product Name",name:"name",value:t.name,onChange:a=>T(r,a),required:!0})),e.createElement(o,{md:2},e.createElement(m,{label:"Quantity",type:"number",name:"quantity",value:t.quantity,min:"0",onChange:a=>T(r,a),required:!0})),e.createElement(o,{md:2},e.createElement(m,{label:"Unit",type:"select",name:"unit",value:t.unit,onChange:a=>T(r,a),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(o,{md:2},e.createElement(m,{label:"Unit Price",type:"number",name:"unitPrice",value:t.unitPrice,min:"0",onChange:a=>T(r,a),required:!0})),e.createElement(o,{md:2},e.createElement(E,{color:"danger",onClick:()=>z(r)},"Remove")))),e.createElement(P,{className:"mt-3"},e.createElement(o,{md:6},e.createElement(E,{color:"primary",onClick:M},"Add Product"))),e.createElement(P,{className:"mt-3 text-end"},e.createElement(o,null,e.createElement("h5",null,"Estimated Cost: ",n.estimatedCost.toFixed(2)))),e.createElement(P,{className:"mt-4"},e.createElement(o,{md:12,className:"text-center"},e.createElement(E,{color:"success",type:"submit",disabled:f},f?e.createElement(L,{size:"sm"}):"Submit")))))),e.createElement(W,null,e.createElement(Y,null,e.createElement("h5",null,"Procurement Requests"),e.createElement(G,{responsive:!0},e.createElement(X,null,e.createElement(B,null,e.createElement(R,null,"Title"),e.createElement(R,null,"Department"),e.createElement(R,null,"Status"),e.createElement(R,null,"Actions"))),e.createElement(J,null,N.map(t=>e.createElement(B,{key:t._id},e.createElement(S,null,t.title),e.createElement(S,null,t.department),e.createElement(S,null,e.createElement(Z,{color:t.status==="Approved"?"success":"warning"},t.status)),e.createElement(S,{className:"text-center"},e.createElement(E,{color:"info",size:"sm",onClick:()=>p(`/procurement/${t._id}`)},"View")," ",t.status==="Approved"&&e.createElement(e.Fragment,null,e.createElement(E,{color:"primary",size:"sm",onClick:()=>p(`/rfq/create/${t._id}`)},"Create RFQ")," ",e.createElement(E,{color:"success",size:"sm",onClick:()=>p("/procurement/po-payments")},"Create PO"))))))))),e.createElement(ee,{placement:"top-end"},D.map(t=>e.createElement(te,{key:t.id,autohide:!0,visible:!0,color:t.color},e.createElement(ae,{closeButton:!0},t.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(re,null,t.message)))))},Re=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(le,null));export{Re as default};
