import{r as s,i as G,R as e}from"./index-D-OjWQES.js";import{C as M}from"./index.esm-CdbheKKh.js";import{a as h}from"./index-C88pvD_q.js";import{a as k,b as L}from"./CContainer-Cq52eSeb.js";import{C as N,a as _}from"./CRow-CDQaQMcK.js";import{C as j}from"./CCardGroup-qJ-NNN6U.js";import{C as Y,a as z}from"./CCardBody-BZHwh40R.js";import{C as H}from"./CForm-DVMN_51j.js";import{C as w,a as g}from"./CInputGroupText-BE524GP1.js";import{c as J}from"./cil-user-Ddrdy7PS.js";import{C as E}from"./CFormInput-D-rK_OXt.js";import"./CFormControlWrapper-DhhdGZWh.js";const y="https://backend-log2.axleshift.com/api/v1/auth",le=()=>{const[c,S]=s.useState(""),[d,O]=s.useState(""),[p,T]=s.useState(""),[C,x]=s.useState(""),[P,a]=s.useState(!1),[v,r]=s.useState(""),[b,i]=s.useState(""),[m,q]=s.useState(!1),[u,R]=s.useState(!1),A=G(),F=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),I=async t=>await h.post(`${y}/forgot-password`,t),V=async t=>await h.post(`${y}/verify-otp`,t),$=async t=>await h.post(`${y}/change-password`,t),U=async t=>{var n,o;if(t.preventDefault(),a(!0),r(""),i(""),!c){r("Email is required."),a(!1);return}if(!F(c)){r("Please enter a valid email address."),a(!1);return}try{(await I({email:c})).status===200&&(i("A reset code has been sent to your email. Please check your inbox."),q(!0))}catch(l){const f=((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.message)||"An error occurred while sending the OTP.";r(f)}finally{a(!1)}},B=async t=>{var n,o;if(t.preventDefault(),a(!0),r(""),!d){r("OTP is required."),a(!1);return}try{(await V({email:c,otp:d})).status===200&&(i("OTP verified successfully! You can now set a new password."),R(!0))}catch(l){const f=((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.message)||"An error occurred while verifying the OTP.";r(f)}finally{a(!1)}},D=async t=>{var n,o;if(t.preventDefault(),a(!0),r(""),i(""),!p||!d){r("Both OTP and new password fields are required."),a(!1);return}if(p.length<6){r("New password must be at least 6 characters long."),a(!1);return}if(p!==C){r("Passwords do not match."),a(!1);return}try{(await $({email:c,otp:d,newPassword:p})).status===200&&(i("Password changed successfully. Redirecting to login..."),setTimeout(()=>A("/login"),2e3))}catch(l){const f=((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.message)||"An error occurred while changing the password.";r(f)}finally{a(!1)}};return e.createElement("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center"},e.createElement(k,null,e.createElement(N,{className:"justify-content-center"},e.createElement(_,{md:5},e.createElement(j,null,e.createElement(Y,{className:"p-4"},e.createElement(z,null,e.createElement(H,{onSubmit:u?D:m?B:U},e.createElement("h1",null,u?"Change Password":m?"Verify OTP":"Forgot Password"),e.createElement("p",{className:"text-body-secondary"},u?"Enter your new password":m?"Enter the OTP sent to your email":"Enter your email to reset your password"),v&&e.createElement("div",{className:"alert alert-danger"},v),b&&e.createElement("div",{className:"alert alert-success"},b),!m&&e.createElement(w,{className:"mb-4"},e.createElement(g,null,e.createElement(M,{icon:J})),e.createElement(E,{type:"email",placeholder:"Email",autoComplete:"email",value:c,onChange:t=>{S(t.target.value),r(""),i("")},required:!0})),m&&!u&&e.createElement(w,{className:"mb-4"},e.createElement(g,null,"OTP"),e.createElement(E,{type:"text",placeholder:"Enter OTP",value:d,onChange:t=>O(t.target.value),required:!0})),u&&e.createElement(e.Fragment,null,e.createElement(w,{className:"mb-4"},e.createElement(g,null,"New Password"),e.createElement(E,{type:"password",placeholder:"Enter New Password",value:p,onChange:t=>T(t.target.value),required:!0})),e.createElement(w,{className:"mb-4"},e.createElement(g,null,"Confirm Password"),e.createElement(E,{type:"password",placeholder:"Confirm New Password",value:C,onChange:t=>x(t.target.value),required:!0}))),e.createElement(N,null,e.createElement(L,{type:"submit",color:"primary",disabled:P},P?e.createElement("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):u?"Change Password":m?"Verify OTP":"Send Reset Code"))))))))))};export{le as default};
