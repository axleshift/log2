import{u as V,r as c,R as e,C as y}from"./index-Dbh7qAQo.js";import{a as j,b as R,c as u}from"./CRow-CKCNacdJ.js";import{C as M,a as P}from"./CCardBody-C_3c75SN.js";import{e as z,f as L,g as h,h as d,j as H,k as m,l as F,m as O,p as G,n as Z,o as q}from"./CTable-DPQMGb4T.js";import{C as I}from"./DefaultLayout-CDyQGtxP.js";import"./CCloseButton-Bf1kVb3D.js";import"./index-xsH4HHeE.js";import"./CFormInput-Dk1eMsHi.js";import"./CFormTextarea-CoT500o5.js";import"./CFormSelect-DcZx626G.js";import"./CForm-B5UoGkfV.js";import"./index.esm-CG_5JtWz.js";import"./CCardHeader-DvKbsVKd.js";import"./CAlert-DBUYWMWT.js";import"./cil-user-Ddrdy7PS.js";import"./index-HhGqFKIr.js";const C="https://backend-log2.axleshift.com/api/v1/auth",b="https://backend-log2.axleshift.com/api/v1/vendor",me=()=>{const{accessToken:a}=V(),[g,p]=c.useState([]),[T,N]=c.useState(!0),[A,E]=c.useState(!1),[r,_]=c.useState(null),[n,$]=c.useState(null),[f,i]=c.useState(null);c.useEffect(()=>{if(!a)return;(async()=>{try{const l=await fetch(`${C}/users`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!l.ok)throw new Error(`HTTP error! Status: ${l.status}`);const s=(await l.json()).users.filter(B=>B.role==="vendor");p(s)}catch(l){console.error("Error fetching users:",l),p([])}finally{N(!1)}})()},[a]);const w=async t=>{try{const l=await fetch(`${b}/user/${t}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(l.ok){const o=await l.json();$(o)}else console.error("Error fetching vendor details:",l.statusText)}catch(l){console.error("Error fetching vendor details:",l)}},v=(t,l)=>{p(o=>o.map(s=>s._id===t?{...s,status:l}:s))},k=async t=>{if(a){i(t);try{const l=await fetch(`${C}/approve/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});l.ok?v(t,"Approved"):console.error("Error approving user",l.statusText)}catch(l){console.error("Error approving user:",l)}finally{i(null)}}},x=async t=>{if(a){i(t);try{const l=await fetch(`${C}/cancel-approval/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});l.ok?v(t,"Pending"):console.error("Error canceling approval:",l.statusText)}catch(l){console.error("Error canceling approval:",l)}finally{i(null)}}},D=async t=>{i(t);try{const l=await fetch(`${b}/user/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});l.ok?p(o=>o.filter(s=>s._id!==t)):console.error("Error deleting vendor:",l.statusText)}catch(l){console.error("Error deleting vendor:",l)}finally{i(null)}},S=t=>{_(t),w(t._id),E(!0)},U=t=>{switch(t){case"Approved":return"success";case"Pending":return"warning";default:return"secondary"}};return e.createElement(e.Fragment,null,e.createElement(j,null,e.createElement(R,{xs:"12"},e.createElement(M,{className:"shadow-lg"},e.createElement(P,null,e.createElement("h4",{className:"text-primary"},"Vendor Management"),T?e.createElement("div",{className:"d-flex justify-content-center"},e.createElement(y,{color:"primary"})):e.createElement(z,{striped:!0,bordered:!0,hover:!0,responsive:!0},e.createElement(L,{className:"bg-transparent"},e.createElement(h,null,e.createElement(d,null,"User ID"),e.createElement(d,null,"Email"),e.createElement(d,null,"Status"),e.createElement(d,null,"Role"),e.createElement(d,null,"Actions"))),e.createElement(H,null,g.length>0?g.map(t=>e.createElement(h,{key:t._id,className:"text-center"},e.createElement(m,null,t._id),e.createElement(m,null,t.email),e.createElement(m,null,e.createElement(I,{color:U(t.status)},t.status)),e.createElement(m,null,t.role),e.createElement(m,null,e.createElement(u,{color:"info",onClick:()=>S(t),className:"mr-2"},"View Details"),t.status==="Approved"?e.createElement(u,{color:"warning",onClick:()=>x(t._id),className:"ml-2",disabled:f===t._id},"Cancel Approval"):e.createElement(u,{color:"success",onClick:()=>k(t._id),className:"ml-2",disabled:f===t._id},"Approve"),e.createElement(u,{color:"danger",onClick:()=>D(t._id),className:"ml-2",disabled:f===t._id},f===t._id?e.createElement(y,{size:"sm"}):"Delete")))):e.createElement(h,null,e.createElement(m,{colSpan:"5",className:"text-center"},"No vendors found.")))))))),e.createElement(F,{visible:A,onClose:()=>E(!1)},e.createElement(O,{onClose:()=>E(!1)},e.createElement(G,null,"User Details")),e.createElement(Z,null,r&&n&&e.createElement("div",null,e.createElement("p",null,e.createElement("strong",null,"User ID:")," ",r._id),e.createElement("p",null,e.createElement("strong",null,"Username:")," ",(r==null?void 0:r.username)||"N/A"),e.createElement("p",null,e.createElement("strong",null,"Email:")," ",r.email),e.createElement("p",null,e.createElement("strong",null,"Status:")," ",r.status),e.createElement("p",null,e.createElement("strong",null,"Role:")," ",r.role),e.createElement("h5",{className:"mt-3"},"Vendor Profile"),e.createElement("p",null,e.createElement("strong",null,"Business Name:")," ",n.businessName),e.createElement("p",null,e.createElement("strong",null,"Full Name:")," ",n.fullName),e.createElement("p",null,e.createElement("strong",null,"Business Address:")," ",n.businessAddress),e.createElement("p",null,e.createElement("strong",null,"Contact Number:")," ",n.contactNumber),e.createElement("p",null,e.createElement("strong",null,"Tax ID:")," ",n.taxId),e.createElement("h5",{className:"mt-3"},"Documents"),n.documents&&Object.values(n.documents).some(t=>t)?e.createElement("ul",null,Object.entries(n.documents).map(([t,l])=>l?e.createElement("li",{key:t},e.createElement("a",{href:l,target:"_blank",rel:"noopener noreferrer"},t.replace(/([A-Z])/g," $1").replace(/^./,o=>o.toUpperCase()))):null)):e.createElement("p",null,"No uploaded documents."))),e.createElement(q,null,e.createElement(u,{color:"secondary",onClick:()=>E(!1)},"Close"))))};export{me as default};
