import{r as o,_ as ae,b as m,j as K,F as oe,R as e,a as _,c as se,P as n,w as le,D as ie,i as ce,k as ue,C as Q}from"./index-CQ5bThOo.js";import{a as L}from"./index-C88pvD_q.js";import{C as fe,a as de,b as me,c as pe}from"./CToaster-BmyxsD3g.js";import{C as ve,a as he}from"./CCardBody-40k0tZjq.js";import{C as ge}from"./CCardHeader-o14WNGm5.js";import{C as Ce,a as Ee,b as $,c as B,d as be,e as R}from"./CTable-CF2NB-O5.js";import{k as W,u as ye,j as Te}from"./CNavItem-8e7SXcnn.js";import{u as Pe}from"./CCloseButton-Bt_Fn3tX.js";import{b as F}from"./CContainer-ezbfUEXV.js";import{C as Re,a as we,b as je,c as ke}from"./CModalHeader-BjwXGJ0z.js";import{C as Se}from"./CFormTextarea-zLRXAeMj.js";import"./CFormControlWrapper-BsUibFdB.js";var Ne=function(t){if(!t)return 0;var a=window.getComputedStyle(t),s=a.transitionDuration,i=a.transitionDelay,p=Number.parseFloat(s),c=Number.parseFloat(i);return!p&&!c?0:(s=s.split(",")[0],i=i.split(",")[0],(Number.parseFloat(s)+Number.parseFloat(i))*1e3)},X=function(t){typeof t=="function"&&t()},Ae=function(t){t.dispatchEvent(new Event("transitionend"))},Be=function(t,a,s){if(s===void 0&&(s=!0),!s){X(t);return}var i=5,p=Ne(a)+i,c=!1,u=function(h){var f=h.target;f===a&&(c=!0,a.removeEventListener("transitionend",u),X(t))};a.addEventListener("transitionend",u),setTimeout(function(){c||Ae(a)},p)},Fe=function(t,a){switch(t){case"right":return W(a)?"left":"right";case"left":return W(a)?"right":"left";default:return t}},x=o.forwardRef(function(t,a){var s=t.children,i=t.animation,p=i===void 0?!0:i,c=t.className,u=t.container,h=t.content,f=t.delay,v=f===void 0?0:f,w=t.fallbackPlacements,j=w===void 0?["top","right","bottom","left"]:w,y=t.offset,g=y===void 0?[0,6]:y,T=t.onHide,d=t.onShow,k=t.placement,D=k===void 0?"top":k,r=t.popperConfig,l=t.trigger,C=l===void 0?["hover","focus"]:l,H=t.visible,Y=ae(t,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),E=o.useRef(null),b=o.useRef(null),Z=Pe(a,E),O="tooltip".concat(o.useId()),z=o.useState(!1),S=z[0],I=z[1],U=o.useState(H),P=U[0],V=U[1],M=ye(),ee=M.initPopper,te=M.destroyPopper,re=M.updatePopper,G=typeof v=="number"?{show:v,hide:v}:v,J={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:j}},{name:"offset",options:{offset:g}}],placement:Fe(D,b.current)},ne=m(m({},J),typeof r=="function"?r(J):r);o.useEffect(function(){if(H){N();return}A()},[H]),o.useEffect(function(){if(S&&b.current&&E.current){ee(b.current,E.current,ne),setTimeout(function(){V(!0)},G.show);return}!S&&b.current&&E.current&&te()},[S]),o.useEffect(function(){!P&&b.current&&E.current&&Be(function(){I(!1)},E.current)},[P]);var N=function(){I(!0),d&&d()},A=function(){setTimeout(function(){V(!1),T&&T()},G.hide)};return o.useEffect(function(){re()},[h]),K(oe,{children:[e.cloneElement(s,m(m(m(m(m({},P&&{"aria-describedby":O}),{ref:b}),(C==="click"||C.includes("click"))&&{onClick:function(){return P?A():N()}}),(C==="focus"||C.includes("focus"))&&{onFocus:function(){return N()},onBlur:function(){return A()}}),(C==="hover"||C.includes("hover"))&&{onMouseEnter:function(){return N()},onMouseLeave:function(){return A()}})),_(Te,{container:u,portal:!0,children:S&&K("div",{...m({className:se("tooltip","bs-tooltip-auto",{fade:p,show:P},c),id:O,ref:Z,role:"tooltip"},Y),children:[_("div",{className:"tooltip-arrow"}),_("div",{className:"tooltip-inner",children:h})]})})]})});x.propTypes={animation:n.bool,children:n.node,container:n.any,content:n.oneOfType([n.string,n.node]),delay:n.oneOfType([n.number,n.shape({show:n.number.isRequired,hide:n.number.isRequired})]),fallbackPlacements:ie,offset:n.any,onHide:n.func,onShow:n.func,placement:n.oneOf(["auto","top","right","bottom","left"]),popperConfig:n.oneOfType([n.func,n.object]),trigger:le,visible:n.bool};x.displayName="CTooltip";const q="https://backend-log2.axleshift.com/api/v1/procurement",Ve=()=>{ce();const{accessToken:t}=ue(),[a,s]=o.useState([]),[i,p]=o.useState(!0),[c,u]=o.useState(!1),[h,f]=o.useState(!1),[v,w]=o.useState(null),[j,y]=o.useState(""),[g,T]=o.useState({visible:!1,message:"",color:""});o.useEffect(()=>{(async()=>{try{const l=await L.get(`${q}?status=Pending`,{headers:{Authorization:`Bearer ${t}`}});s(l.data)}catch(l){console.error("Error fetching procurements:",l)}finally{p(!1)}})()},[t]);const d=(r,l)=>{T({visible:!0,message:r,color:l}),setTimeout(()=>T({visible:!1,message:"",color:""}),3e3)},k=async r=>{try{u(!0),await L.patch(`${q}/${r}/approve`,{},{headers:{Authorization:`Bearer ${t}`}}),s(a.filter(l=>l._id!==r)),d("Procurement approved successfully!","success")}catch{d("Failed to approve procurement","danger")}finally{u(!1)}},D=async()=>{if(!j.trim()){d("Please provide a rejection reason.","warning");return}try{u(!0),await L.patch(`${q}/${v}/reject`,{rejectionReason},{headers:{Authorization:`Bearer ${t}`}}),s(a.filter(r=>r._id!==v)),d("Procurement rejected.","danger"),f(!1),y("")}catch{d("Failed to reject procurement","danger")}finally{u(!1)}};return i?e.createElement(Q,{color:"primary"}):e.createElement(e.Fragment,null,e.createElement(fe,{position:"top-end"},g.visible&&e.createElement(de,{color:g.color,autohide:!0},e.createElement(me,{closeButton:!0},g.color==="danger"?"Error":"Success"),e.createElement(pe,null,g.message))),e.createElement(ve,null,e.createElement(ge,null,e.createElement("h5",null,"Approval List")),e.createElement(he,null,e.createElement(Ce,{hover:!0,responsive:!0},e.createElement(Ee,null,e.createElement($,null,e.createElement(B,null,"Title"),e.createElement(B,null,"Department"),e.createElement(B,null,"Requested By"),e.createElement(B,null,"Actions"))),e.createElement(be,null,a.length>0?a.map(r=>{var l;return e.createElement($,{key:r._id},e.createElement(R,null,r.title),e.createElement(R,null,r.department),e.createElement(R,null,((l=r.requestedBy)==null?void 0:l.email)||"Unknown"),e.createElement(R,null,e.createElement(x,{content:"Approve procurement request"},e.createElement(F,{color:"success",className:"me-2",onClick:()=>k(r._id),disabled:c},c?e.createElement(Q,{size:"sm"}):"Approve")),e.createElement(x,{content:"Reject with a reason"},e.createElement(F,{color:"danger",onClick:()=>{w(r._id),f(!0)}},"Reject"))))}):e.createElement($,null,e.createElement(R,{colSpan:"4",className:"text-center text-muted"},"No pending Procurement Requests.")))))),e.createElement(Re,{visible:h,onClose:()=>f(!1)},e.createElement(we,null,"Reject Procurement"),e.createElement(je,null,e.createElement(Se,{placeholder:"Enter rejection reason...",value:j,onChange:r=>y(r.target.value)})),e.createElement(ke,null,e.createElement(F,{color:"secondary",onClick:()=>f(!1)},"Cancel"),e.createElement(F,{color:"danger",onClick:D},"Confirm Reject"))))};export{Ve as default};
