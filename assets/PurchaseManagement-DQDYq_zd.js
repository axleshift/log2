import{k as x,r as n,R as t,C as B}from"./index-C0MG7gOk.js";import{a as E}from"./index-C88pvD_q.js";import{C as w}from"./CForm-DtS9q7U2.js";import{C as v,a as m}from"./CRow-BGJ5cvM-.js";import{C as I}from"./CFormSelect-mTZBDF6Z.js";import{C}from"./CFormInput-DduD42bU.js";import{b as T}from"./CContainer-BYftmdTc.js";import{C as F,a as z,b as D,c as L}from"./CToaster-C0IyRbsE.js";import"./CFormControlWrapper-CkGG_RsJ.js";import"./CCloseButton-DkKfOC9_.js";import"./CNavItem-B6b82TVt.js";const M="https://backend-log2.axleshift.com/api/v1/purchase-order",U="https://backend-log2.axleshift.com/api/v1/procurement",Q="https://backend-log2.axleshift.com/api/v1/vendor",j=()=>{const{accessToken:i}=x(),[o,d]=n.useState({procurementId:"",vendorId:"",products:[{name:"",quantity:0,price:0}],status:"Issued"}),[S,N]=n.useState([]),[h,q]=n.useState([]),[g,p]=n.useState(!1),[_,s]=n.useState(!1),[k,c]=n.useState(""),[b,l]=n.useState("");n.useEffect(()=>{A(),R()},[]);const A=async()=>{try{const{data:e}=await E.get(U,{headers:{Authorization:`Bearer ${i}`}});N(e)}catch(e){console.error("Error fetching procurements:",e)}},R=async()=>{try{const{data:e}=await E.get(Q,{headers:{Authorization:`Bearer ${i}`}});q(e)}catch(e){console.error("Error fetching vendors:",e)}},P=e=>{const{name:a,value:r}=e.target;d({...o,[a]:r})},f=(e,a)=>{const{name:r,value:u}=e.target,y=[...o.products];y[a][r]=u,d({...o,products:y})},O=()=>{d(e=>({...e,products:[...e.products,{name:"",quantity:0,price:0}]}))},V=()=>{if(!o.procurementId||!o.vendorId)return c("Procurement and Vendor must be selected."),l("danger"),s(!0),setTimeout(()=>s(!1),5e3),!1;for(const e of o.products)if(!e.name||e.quantity<=0||e.price<=0)return c("Please provide valid product details."),l("danger"),s(!0),setTimeout(()=>s(!1),5e3),!1;return!0},$=async e=>{var a,r;if(e.preventDefault(),p(!0),!i){c("Authentication error. Please log in again."),l("danger"),s(!0),setTimeout(()=>s(!1),5e3),p(!1);return}if(!V()){p(!1);return}try{const u={Authorization:`Bearer ${i}`,"Content-Type":"application/json"};await E.post(M,o,{headers:u}),c("Purchase Order created successfully!"),l("success"),s(!0),setTimeout(()=>s(!1),5e3),d({procurementId:"",vendorId:"",products:[{name:"",quantity:0,price:0}],status:"Issued"})}catch(u){c(((r=(a=u.response)==null?void 0:a.data)==null?void 0:r.message)||"Error creating Purchase Order"),l("danger"),s(!0),setTimeout(()=>s(!1),5e3)}finally{p(!1)}};return t.createElement(t.Fragment,null,t.createElement(w,{onSubmit:$},t.createElement(v,{className:"mb-3"},t.createElement(m,{md:6},t.createElement(I,{name:"procurementId",value:o.procurementId,onChange:P,label:"Select Procurement",required:!0},t.createElement("option",{value:""},"Choose Procurement"),S.map(e=>t.createElement("option",{key:e._id,value:e._id},e.title)))),t.createElement(m,{md:6},t.createElement(I,{className:"custom-dropdown",name:"vendorId",value:o.vendorId,onChange:P,label:"Select Vendor",required:!0},t.createElement("option",{value:""},"Choose Vendor"),h&&h.length>0?h.map(e=>t.createElement("option",{key:e._id,value:e._id},e.fullName," ",e.user?`(${e.email})`:"")):t.createElement("option",{disabled:!0},"No vendors available")))),t.createElement("h5",null,"Products"),o.products.map((e,a)=>t.createElement(v,{className:"mb-3",key:a},t.createElement(m,{md:4},t.createElement(C,{type:"text",name:"name",value:e.name,onChange:r=>f(r,a),placeholder:"Product Name",label:"Product Name",required:!0})),t.createElement(m,{md:4},t.createElement(C,{type:"number",name:"quantity",value:e.quantity,onChange:r=>f(r,a),placeholder:"Quantity",label:"Quantity",required:!0})),t.createElement(m,{md:4},t.createElement(C,{type:"number",name:"price",value:e.price,onChange:r=>f(r,a),placeholder:"Price",label:"Price",required:!0})))),t.createElement(T,{color:"secondary",onClick:O,className:"mb-3"},"+ Add Product"),t.createElement(T,{color:"success",type:"submit",disabled:g},g?t.createElement(B,{size:"sm"}):"Create Purchase Order")),t.createElement(F,{position:"top-center",visible:_?"true":"false"},t.createElement(z,{color:b},t.createElement(D,{closeButton:!0},b==="success"?"Success":"Error"),t.createElement(L,null,k))))},ae=()=>t.createElement("div",{className:"p-6"},t.createElement("h1",{className:"text-2xl font-bold mb-4"},"CreatePurchaseOrder"),t.createElement(j,null));export{ae as default};
