import{n as k,u as B,r,R as e,C as R}from"./index-D8dcmZku.js";import{a as d}from"./index-xsH4HHeE.js";import{C as P,a as S}from"./CCardBody-BXDHfi6T.js";import{C as $}from"./CCardHeader-CmBIry2J.js";import{g as M,h as _,j as p,k as m,l as w,m as l,c as x,d as F,e as z,f as H}from"./CTable-BEFPcFQk.js";import{c as i}from"./CRow-CaSEyrQu.js";import{C as L}from"./CFormTextarea-r_ol_0dm.js";import"./CCloseButton-CIVrGVIc.js";import"./CFormInput-DzoaQ3uG.js";const E="https://backend-log2.axleshift.com/api/v1/procurement",Q=()=>{k();const{accessToken:n}=B(),[o,u]=r.useState([]),[g,j]=r.useState(!0),[C,c]=r.useState(!1),[v,s]=r.useState(!1),[f,A]=r.useState(null),[h,y]=r.useState("");r.useEffect(()=>{(async()=>{try{const a=await d.get(`${E}?status=Pending`,{headers:{Authorization:`Bearer ${n}`}});u(a.data)}catch(a){console.error("Error fetching procurements:",a)}finally{j(!1)}})()},[n]);const T=async t=>{try{c(!0),await d.patch(`${E}/${t}/approve`,{},{headers:{Authorization:`Bearer ${n}`}}),u(o.filter(a=>a._id!==t))}catch{alert("Failed to approve procurement")}finally{c(!1)}},b=async()=>{if(!h.trim()){alert("Please provide a rejection reason.");return}try{c(!0),await d.patch(`${E}/${f}/reject`,{rejectionReason},{headers:{Authorization:`Bearer ${n}`}}),u(o.filter(t=>t._id!==f)),s(!1),y("")}catch(t){console.error("Failed to reject procurement:",t),alert("Failed to reject procurement")}finally{c(!1)}};return g?e.createElement(R,{color:"primary"}):e.createElement(P,null,e.createElement($,null,e.createElement("h5",null,"Approval List")),e.createElement(S,null,e.createElement(M,{hover:!0,responsive:!0},e.createElement(_,null,e.createElement(p,null,e.createElement(m,null,"Title"),e.createElement(m,null,"Department"),e.createElement(m,null,"Requested By"),e.createElement(m,null,"Actions"))),e.createElement(w,null,o.length>0?o.map(t=>{var a;return e.createElement(p,{key:t._id},e.createElement(l,null,t.title),e.createElement(l,null,t.department),e.createElement(l,null,((a=t.requestedBy)==null?void 0:a.email)||"Unknown"),e.createElement(l,null,e.createElement(i,{color:"success",className:"me-2",onClick:()=>T(t._id),disabled:C},C?e.createElement(R,{size:"sm"}):"Approve"),e.createElement(i,{color:"danger",onClick:()=>{A(t._id),s(!0)}},"Reject")))}):e.createElement(p,null,e.createElement(l,{colSpan:"4"},"No pending Procurement Request."))))),e.createElement(x,{visible:v,onClose:()=>s(!1)},e.createElement(F,null,"Reject Procurement"),e.createElement(z,null,e.createElement(L,{placeholder:"Enter rejection reason...",value:h,onChange:t=>y(t.target.value)})),e.createElement(H,null,e.createElement(i,{color:"secondary",onClick:()=>s(!1)},"Cancel"),e.createElement(i,{color:"danger",onClick:b},"Confirm Reject"))))};export{Q as default};
