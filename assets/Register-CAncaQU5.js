import{r as E,R as e,P as h,i as k,C as B,q as F}from"./index-CVXZKmLB.js";import{a as I,u as j,F as U,c as $}from"./index.esm-BA6OgNs3.js";import{C as y}from"./index.esm-5r6SQQg7.js";import{C as u}from"./CAlert-2eDP0SyD.js";import{C as R}from"./CForm-CknhkglT.js";import{C as o,a as c}from"./CInputGroupText-B912L933.js";import{C as i}from"./CFormInput-Clsh0Ufx.js";import{b as x,a as D}from"./CContainer-CUBQWJe-.js";import{c as w}from"./cil-user-Ddrdy7PS.js";import{C as H,a as Z}from"./CRow-DsyirR-w.js";import{C as M,a as J}from"./CCardBody-Dgfl31BA.js";import{C as G}from"./CFormSelect-DBxcADRr.js";import"./CCloseButton-Ep9ySGeW.js";import"./CFormControlWrapper-B3qIZ7fL.js";var _=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M469.666,216.45,271.078,33.749a34,34,0,0,0-47.062.98L41.373,217.373,32,226.745V496H208V328h96V496H480V225.958ZM248.038,56.771c.282,0,.108.061-.013.18C247.9,56.832,247.756,56.771,248.038,56.771ZM448,464H336V328a32,32,0,0,0-32-32H208a32,32,0,0,0-32,32V464H64V240L248.038,57.356c.013-.012.014-.023.024-.035L448,240Z' class='ci-primary'/>"],z=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M449.366,89.648l-.685-.428L362.088,46.559,268.625,171.176l43,57.337a88.529,88.529,0,0,1-83.115,83.114l-57.336-43L46.558,362.088l42.306,85.869.356.725.429.684a25.085,25.085,0,0,0,21.393,11.857h22.344A327.836,327.836,0,0,0,461.222,133.386V111.041A25.084,25.084,0,0,0,449.366,89.648Zm-20.144,43.738c0,163.125-132.712,295.837-295.836,295.837h-18.08L87,371.76l84.18-63.135,46.867,35.149h5.333a120.535,120.535,0,0,0,120.4-120.4v-5.333l-35.149-46.866L371.759,87l57.463,28.311Z' class='ci-primary'/>"];function V({email:a,setEmail:l,otpVerified:d,setOtpVerified:P,apiUrl:s}){const[T,O]=E.useState(!1),[N,C]=E.useState(""),[g,p]=E.useState(!1),[f,n]=E.useState({message:"",type:""}),q=async()=>{if(!a){n({message:"Please enter an email address.",type:"danger"});return}p(!0),n({message:"",type:""});try{const r=await fetch(`${s}/register/send-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})});if(r.ok)O(!0),n({message:"OTP sent to your email. Check your inbox.",type:"success"});else{const b=await r.json();n({message:b.message,type:"danger"})}}catch{n({message:"Network error. Please try again later.",type:"danger"})}finally{p(!1)}},v=async()=>{if(!N){n({message:"Please enter the OTP.",type:"danger"});return}p(!0),n({message:"",type:""});try{const r=await fetch(`${s}/register/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,otp:N})});if(r.ok)P(!0),n({message:"OTP verified successfully!",type:"success"});else{const b=await r.json();n({message:b.message,type:"danger"})}}catch{n({message:"Network error. Please try again later.",type:"danger"})}finally{p(!1)}};return e.createElement(e.Fragment,null,f.message&&e.createElement(u,{color:f.type},f.message),!T&&!d?e.createElement(R,{onSubmit:r=>{r.preventDefault(),q()}},e.createElement("h1",null,"Register"),e.createElement("p",{className:"text-body-secondary"},"Enter your email to receive an OTP"),e.createElement(o,{className:"mb-3"},e.createElement(c,null,"@"),e.createElement(i,{type:"email",placeholder:"Email",autoComplete:"email",value:a,onChange:r=>l(r.target.value)})),e.createElement("div",{className:"d-grid"},e.createElement(x,{color:"success",type:"submit",disabled:g||!a},g?"Sending OTP...":"Send OTP"))):!d&&e.createElement(R,{onSubmit:r=>{r.preventDefault(),v()}},e.createElement("h1",null,"Verify OTP"),e.createElement("p",{className:"text-body-secondary"},"Enter the OTP sent to your email"),e.createElement(o,{className:"mb-3"},e.createElement(c,null,"OTP"),e.createElement(i,{type:"text",placeholder:"Enter OTP",value:N,onChange:r=>C(r.target.value)})),e.createElement("div",{className:"d-grid"},e.createElement(x,{color:"success",type:"submit",disabled:g||!N},g?"Verifying OTP...":"Verify OTP"))))}V.propTypes={email:h.string.isRequired,setEmail:h.func.isRequired,otpVerified:h.bool.isRequired,setOtpVerified:h.func.isRequired,apiUrl:h.string.isRequired};function K(){const{register:a,formState:{errors:l}}=I();return e.createElement("div",null,e.createElement("h5",null,"Vendor Details"),e.createElement(o,{className:"mb-3"},e.createElement(c,null,e.createElement(y,{icon:_})),e.createElement(i,{placeholder:"Business Name",...a("businessName",{required:"Business Name is required"})})),l.businessName&&e.createElement(u,{color:"danger"},l.businessName.message),e.createElement(o,{className:"mb-3"},e.createElement(c,null,e.createElement(y,{icon:w})),e.createElement(i,{placeholder:"Full Name",...a("fullName",{required:"Full Name is required"})})),l.fullName&&e.createElement(u,{color:"danger"},l.fullName.message),e.createElement(o,{className:"mb-3"},e.createElement(c,null,"Address"),e.createElement(i,{placeholder:"Business Address",...a("businessAddress",{required:"Business Address is required"})})),l.businessAddress&&e.createElement(u,{color:"danger"},l.businessAddress.message),e.createElement(o,{className:"mb-3"},e.createElement(c,null,e.createElement(y,{icon:z})),e.createElement(i,{placeholder:"Contact Number",...a("contactNumber",{required:"Contact Number is required"})})),l.contactNumber&&e.createElement(u,{color:"danger"},l.contactNumber.message),e.createElement(o,{className:"mb-3"},e.createElement(c,null,"Certifications"),e.createElement(i,{placeholder:"Comma separated certifications",...a("certifications")})),e.createElement(o,{className:"mb-3"},e.createElement(c,null,"Tax ID"),e.createElement(i,{placeholder:"Tax ID",...a("taxId")})))}function me(){const a="https://backend-log2.axleshift.com/api/v1/auth",l=j(),{register:d,handleSubmit:P,formState:{errors:s},watch:T,reset:O}=l,N=k(),[C,g]=E.useState(!1),[p,f]=E.useState({message:"",type:""}),[n,q]=E.useState(""),[v,r]=E.useState(!1),b=T("role","user"),A=async t=>{try{const m=await fetch(`${a}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!m.ok){const S=await m.json();throw new Error(S.message||"Registration failed. Please try again.")}return m.json()}catch(m){throw new Error(m.message||"Something went wrong.")}},L=async t=>{g(!0),f({message:"",type:""});try{if(!n)throw new Error("Email verification is required.");const m={firstName:t.firstName,lastName:t.lastName,username:t.username,email:n,password:t.password,role:t.role||"user"};t.role==="vendor"&&(m.vendorDetails={businessName:t.businessName,fullName:t.fullName,businessAddress:t.businessAddress,contactNumber:t.contactNumber,certifications:t.certifications?t.certifications.split(","):[],taxId:t.taxId});const S=await A(m);F.set("token",S.accessToken,{expires:1}),F.set("refreshToken",S.refreshToken,{expires:1}),f({message:"Registration Successful! Redirecting...",type:"success"}),O(),setTimeout(()=>N("/login"),2e3)}catch(m){f({message:m.message,type:"danger"})}finally{g(!1)}};return e.createElement("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center"},e.createElement(D,null,e.createElement(H,{className:"justify-content-center"},e.createElement(Z,{md:9,lg:7,xl:6},e.createElement(M,{className:"mx-4"},e.createElement(J,{className:"p-4"},v?e.createElement(U,{...l},e.createElement(R,{onSubmit:P(L)},e.createElement("h1",{className:"text-center mb-4"},"Complete Registration"),p.message&&e.createElement(u,{color:p.type},p.message),e.createElement(o,{className:`mb-3 ${s.firstName?"is-invalid":""}`},e.createElement(c,null,e.createElement(y,{icon:w})),e.createElement(i,{placeholder:"First Name",...d("firstName",{required:"First Name is required"}),onFocus:t=>t.target.style.borderColor="var(--c-primary)",onBlur:t=>t.target.style.borderColor=""})),s.firstName&&e.createElement(u,{color:"danger"},s.firstName.message),e.createElement(o,{className:`mb-3 ${s.lastName?"is-invalid":""}`},e.createElement(c,null,e.createElement(y,{icon:w})),e.createElement(i,{placeholder:"Last Name",...d("lastName",{required:"Last Name is required"}),onFocus:t=>t.target.style.borderColor="var(--c-primary)",onBlur:t=>t.target.style.borderColor=""})),s.lastName&&e.createElement(u,{color:"danger"},s.lastName.message),e.createElement(o,{className:`mb-3 ${s.username?"is-invalid":""}`},e.createElement(c,null,e.createElement(y,{icon:w})),e.createElement(i,{placeholder:"Username",...d("username",{required:"Username is required"}),onFocus:t=>t.target.style.borderColor="var(--c-primary)",onBlur:t=>t.target.style.borderColor=""})),s.username&&e.createElement(u,{color:"danger"},s.username.message),e.createElement(o,{className:`mb-3 ${s.password?"is-invalid":""}`},e.createElement(c,null,e.createElement(y,{icon:$})),e.createElement(i,{type:"password",placeholder:"Password",...d("password",{required:"Password is required"}),onFocus:t=>t.target.style.borderColor="var(--c-primary)",onBlur:t=>t.target.style.borderColor=""})),s.password&&e.createElement(u,{color:"danger"},s.password.message),e.createElement(o,{className:"mb-3"},e.createElement(c,null,"Role"),e.createElement(G,{...d("role")},e.createElement("option",{value:"user"},"User"),e.createElement("option",{value:"admin"},"Admin"),e.createElement("option",{value:"super admin"},"Super Admin"),e.createElement("option",{value:"vendor"},"Vendor"),e.createElement("option",{value:"buyer"},"Buyer"),e.createElement("option",{value:"finance"},"Finance"))),b==="vendor"&&e.createElement(K,null),e.createElement("div",{className:"d-grid"},e.createElement(x,{color:"primary",type:"submit",disabled:C},C?e.createElement(B,{color:"light"}):"Register")))):e.createElement(V,{email:n,setEmail:q,otpVerified:v,setOtpVerified:r,apiUrl:a})))))))}export{me as default};
