import{R as e,P as m,k as B,r as P,C as O,i as I}from"./index-BymYdVf9.js";import{a as N}from"./index-C88pvD_q.js";import{C as M}from"./CFormTextarea-BL88QNNQ.js";import{C as U}from"./CFormSelect-CY0d7-J5.js";import{C as z}from"./CFormInput-iYJg6Lcv.js";import{C as D,a as i}from"./CRow-DBpbnMc3.js";import{b as f}from"./CContainer-BW6RyZoO.js";import{C as L,a as H,b as G,c as K}from"./CToaster-96IQN7z-.js";import{C as Q,a as j}from"./CCardBody-DKAj1_EX.js";import{C as J,a as V,b as x,c as R,d as W,e as S}from"./CTable-BSOgMIVc.js";import{C as X}from"./DefaultLayout-CguGU2D0.js";import{C as Y,a as Z,b as ee,c as te}from"./CModalHeader-CSRrgwEo.js";import"./CFormControlWrapper-Dr-zH9-Z.js";import"./CCloseButton-CoMusDxn.js";import"./CNavItem-BBtPj2Ni.js";import"./index.esm-Cw0dBaxO.js";import"./cil-user-Ddrdy7PS.js";import"./index-CiGjFrqD.js";const d=({label:s,type:n="text",name:o,value:g,onChange:p,placeholder:v="",required:E=!1,options:T=[],rows:h=3,disabled:C=!1})=>n==="textarea"?e.createElement(M,{label:s,name:o,value:g,onChange:p,placeholder:v,required:E,rows:h,disabled:C,"aria-label":s}):n==="select"?e.createElement(U,{label:s,name:o,value:g,onChange:p,required:E,disabled:C,"aria-label":s},e.createElement("option",{value:""},"Select ",s),T.map((u,b)=>e.createElement("option",{key:b,value:u},u))):e.createElement(z,{type:n,name:o,value:g,onChange:p,placeholder:v,label:s,required:E,disabled:C,"aria-label":s});d.propTypes={label:m.string.isRequired,type:m.oneOf(["text","number","date","textarea","select"]),name:m.string.isRequired,value:m.oneOfType([m.string,m.number]).isRequired,onChange:m.func.isRequired,placeholder:m.string,required:m.bool,options:m.arrayOf(m.string),rows:m.number,disabled:m.bool};const ae="https://backend-log2.axleshift.com",re=`${ae}/api/v1/procurement`,ne=()=>{const{accessToken:s}=B(),[n,o]=P.useState({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),[g,p]=P.useState([]),[v,E]=P.useState(!1),[T,h]=P.useState("PHP"),C=["PHP","USD","EUR","GBP","JPY"],u=a=>{const{name:r,value:t}=a.target;o(c=>({...c,[r]:t}))},b=(a,r)=>{const{name:t,value:c}=r.target,y=[...n.products];y[a]={...y[a],[t]:t==="quantity"||t==="unitPrice"?c===""?"":parseFloat(c):c};const $=y.reduce((k,A)=>k+(A.unitPrice||0)*(A.quantity||0),0);o(k=>({...k,products:y,estimatedCost:parseFloat($.toFixed(2))}))},l=()=>{o(a=>({...a,products:[...a.products,{name:"",quantity:0,unit:"",unitPrice:0}]}))},q=a=>{const r=n.products.filter((t,c)=>c!==a);o(t=>({...t,products:r,estimatedCost:r.reduce((c,y)=>c+(y.unitPrice*y.quantity||0),0)}))},_=async a=>{var r,t;if(a.preventDefault(),!v){E(!0);try{if(!s)throw new Error("Authentication error. Please log in again.");const c={Authorization:`Bearer ${s}`,"Content-Type":"application/json"},y={...n,deliveryDate:n.deliveryDate?new Date(n.deliveryDate).toISOString():null};await N.post(re,y,{headers:c}),o({title:"",description:"",procurementDate:"",status:"Pending",deliveryDate:"",department:"",products:[{name:"",quantity:0,unit:"",unitPrice:0}],estimatedCost:0}),w("âœ… Procurement Request created successfully! Wait for Approval","success")}catch(c){w(((t=(r=c.response)==null?void 0:r.data)==null?void 0:t.message)||"ðŸš¨ Failed to create procurement.","danger")}finally{E(!1)}}},w=(a,r)=>{p(t=>[...t,{id:Date.now(),message:a,color:r}]),setTimeout(()=>p(t=>t.slice(1)),5e3)};return e.createElement("form",{onSubmit:_},e.createElement(D,{className:"mb-3"},e.createElement(i,{md:6},e.createElement(d,{label:"Title",name:"title",value:n.title,onChange:u,required:!0})),e.createElement(i,{md:6},e.createElement(d,{label:"Procurement Date",type:"date",name:"procurementDate",value:n.procurementDate,onChange:u,required:!0}))),e.createElement(d,{label:"Description",type:"textarea",name:"description",value:n.description,onChange:u,required:!0,rows:3}),e.createElement(D,{className:"mb-3"},e.createElement(i,{md:6},e.createElement(d,{label:"Expected Delivery Date",type:"date",name:"deliveryDate",value:n.deliveryDate,onChange:u})),e.createElement(i,{md:6},e.createElement(d,{label:"Department",type:"select",name:"department",value:n.department,onChange:u,options:["HR","Finance","Logistics","IT","Procurement","Operations"],required:!0}))),e.createElement("h5",null,"Products"),n.products.map((a,r)=>e.createElement(D,{key:r,className:"mb-2"},e.createElement(i,{md:2},e.createElement(d,{label:"Product Name",name:"name",value:a.name,onChange:t=>b(r,t),required:!0})),e.createElement(i,{md:2},e.createElement(d,{label:"Quantity",type:"number",name:"quantity",value:a.quantity,min:"0",onChange:t=>b(r,t),required:!0})),e.createElement(i,{md:2},e.createElement(d,{label:"Unit",type:"select",name:"unit",value:a.unit,onChange:t=>b(r,t),options:["KG","L","M","PCS","BOX","PACK"],required:!0})),e.createElement(i,{md:2},e.createElement(d,{label:"Unit Price",type:"number",name:"unitPrice",value:a.unitPrice,min:"0",onChange:t=>b(r,t),required:!0})),e.createElement(D,{className:"mt-3"},e.createElement(i,{md:6},e.createElement("label",{htmlFor:"currency"},"Select Currency:"),e.createElement("select",{id:"currency",value:T,onChange:t=>h(t.target.value),className:"form-control"},C.map(t=>e.createElement("option",{key:t,value:t},t))))),e.createElement(D,{className:"mt-3 text-end"},e.createElement(i,null,e.createElement("h5",null,"Estimated Cost: ",T," ",n.estimatedCost.toFixed(2)))),e.createElement(i,{md:2},e.createElement(f,{color:"danger",onClick:()=>q(r)},"Remove")))),e.createElement(D,{className:"mt-3"},e.createElement(i,{md:6},e.createElement(f,{color:"primary",onClick:l},"Add Product"))),e.createElement(D,{className:"mt-4"},e.createElement(i,{md:12,className:"text-center"},e.createElement(f,{color:"success",type:"submit",disabled:v},v?e.createElement(O,{size:"sm"}):"Create Procurement"))),e.createElement(L,{placement:"top-end"},g.map(a=>e.createElement(H,{key:a.id,autohide:!0,visible:!0,color:a.color},e.createElement(G,{closeButton:!0},a.color==="success"?"âœ… Success":"ðŸš¨ Error"),e.createElement(K,null,a.message)))))},F="https://backend-log2.axleshift.com/api/v1/procurement",le=()=>{const s=I(),{user:n,accessToken:o}=B(),[g,p]=P.useState([]),[v,E]=P.useState(!0),[T,h]=P.useState(!1),[C,u]=P.useState(null);P.useEffect(()=>{(async()=>{if(!o){console.error("No authentication token found"),E(!1);return}try{const q=await N.get(F,{headers:{Authorization:`Bearer ${o}`}});console.log("Procurements Data:",q.data),p(q.data)}catch(q){console.error("Error fetching procurements:",q)}finally{E(!1)}})()},[o]);const b=async()=>{if(!(!C||!o))try{await N.delete(`${F}/${C}`,{headers:{Authorization:`Bearer ${o}`}}),p(g.filter(l=>l._id!==C)),h(!1)}catch(l){console.error("Error deleting procurement:",l),alert("Failed to delete procurement.")}};return e.createElement(Q,null,e.createElement(j,null,e.createElement("h5",null,"Procurement Requests"),e.createElement(J,{responsive:!0},e.createElement(V,null,e.createElement(x,null,e.createElement(R,null,"Title"),e.createElement(R,null,"Department"),e.createElement(R,null,"Status"),e.createElement(R,null,"Actions"))),e.createElement(W,null,g.map(l=>e.createElement(x,{key:l._id},e.createElement(S,null,l.title),e.createElement(S,null,l.department),e.createElement(S,null,e.createElement(X,{color:l.status==="Approved"?"success":"warning"},l.status)),e.createElement(S,{className:"text-center"},e.createElement(f,{color:"info",size:"sm",onClick:()=>s(`/procurement/${l._id}`)},"View")," ",e.createElement(f,{color:"danger",size:"sm",onClick:()=>{u(l._id),h(!0)}},"Delete")," ",l.status==="Approved"&&e.createElement(e.Fragment,null,e.createElement(f,{color:"primary",size:"sm",onClick:()=>s(`/rfq/create/${l._id}`)},"Create RFQ")," ",e.createElement(f,{color:"success",size:"sm",onClick:()=>s(`/po/create/${l._id}`)},"Create PO")))))))),e.createElement(Y,{visible:T,onClose:()=>h(!1)},e.createElement(Z,null,"Confirm Deletion"),e.createElement(ee,null,"Are you sure you want to delete this procurement request?"),e.createElement(te,null,e.createElement(f,{color:"secondary",onClick:()=>h(!1)},"Cancel"),e.createElement(f,{color:"danger",onClick:b},"Delete"))))},Te=()=>e.createElement("div",{className:"p-6"},e.createElement("h1",{className:"text-2xl font-bold mb-4 text-center"},"ðŸ›’ Procurement Request"),e.createElement(ne,null),e.createElement("div",{className:"mt-6"},e.createElement(le,null)));export{Te as default};
