import{r as n,R as e,C as ie,P as z}from"./index-QHt0BNF-.js";import{a as H}from"./index-xsH4HHeE.js";import{M as me,T as ue,a as de,P as pe,o as Ee,u as ge}from"./opencage-api.min-adJclXQX.js";import{C as q,a as G}from"./CCardBody-DTdIa86a.js";import{C as U}from"./CCardHeader-BvbB9qDc.js";import{a as j,b as d,c as K}from"./CRow-Ce6guADD.js";import{a as W}from"./CFormInput-BdJGZwOp.js";import{C as Y}from"./CFormSelect-BKzCe16h.js";import{e as fe,f as he,g as $,h as p,j as Ce,k as E}from"./CTable-DhIoX8qk.js";import{C as ve}from"./CAlert-ZjTU6H8E.js";import{C as Se}from"./DefaultLayout-B8VGAksF.js";import"./CCloseButton-DubpZP9d.js";import"./CFormTextarea-OgHKVdzt.js";import"./CForm-B7FIKFam.js";import"./index.esm-D1lQqmIc.js";import"./cil-user-Ddrdy7PS.js";import"./index-C0QOyGfk.js";const ye="https://backend-log2.axleshift.com",J=`${ye}/api/v1/shipment`,be="308bf4d7a22d42f68b7ddc52e93d735f",Q=({center:s})=>{const C=ge();return n.useEffect(()=>{s&&C.setView(s,13)},[s]),null},_e=s=>{switch(s==null?void 0:s.toLowerCase()){case"delivered":return"success";case"in transit":return"info";case"delayed":return"danger";case"pending":return"secondary";default:return"warning"}},qe=()=>{var L;const[s,C]=n.useState([]),[X,g]=n.useState([]),[Z,ee]=n.useState("All"),[te,ne]=n.useState(""),[i,k]=n.useState(""),[A,v]=n.useState(!1),[m,w]=n.useState(null),[c,N]=n.useState(null),[S,R]=n.useState(null),[y,D]=n.useState(null),[I,f]=n.useState(null),[b,ae]=n.useState(!1),_=n.useRef(null);n.useEffect(()=>{(async()=>{var r;try{const a=((r=(await H.get(J)).data)==null?void 0:r.shipments)||[];C(a),g(a)}catch(l){console.error("Failed to fetch shipments",l)}})()},[]);const re=t=>{if(ee(t),t==="All")g(s);else{const r=s.filter(l=>{var a;return((a=l.delivery)==null?void 0:a.status)===t});g(r)}},le=t=>{ne(t);const r=t.toLowerCase(),l=s.filter(a=>{var u;return(u=a.tracking_id)==null?void 0:u.toString().toLowerCase().includes(r)});g(l)},T=async t=>{var r,l,a,u,P,O,x,F;if(!t.trim()){f("Please enter a tracking number");return}v(!0),f(null),w(null),N(null),R(null),D(null);try{const o=((await H.get(J)).data.shipments||[]).find(ce=>{var V;return((V=ce.tracking_id)==null?void 0:V.toString())===t});if(!o){f("Tracking number not found."),v(!1);return}R(o),o.vehicle&&D(o.vehicle);const B=((a=(l=(r=o.shipping)==null?void 0:r.shipping_details)==null?void 0:l.land)==null?void 0:a.destination_address)||((u=o.consignee)==null?void 0:u.consignee_company_address)||"Philippines",h=await Ee.geocode({q:B,key:be});if(!h||!h.results||h.results.length===0)throw new Error("Geolocation not found for address.");const oe=h.results[0].geometry;N(oe),w({status:((P=o.delivery)==null?void 0:P.status)||"N/A",estimatedArrival:(F=(x=(O=o.shipping)==null?void 0:O.shipping_details)==null?void 0:x.sea)!=null&&F.estimated_arrival_date?new Date(o.shipping.shipping_details.sea.estimated_arrival_date).toLocaleDateString():"Not provided",currentLocation:B})}catch(M){console.error(M),f("Error fetching shipment or location data.")}finally{v(!1)}};n.useEffect(()=>(b&&i?_.current=setInterval(()=>{T(i)},3e4):clearInterval(_.current),()=>clearInterval(_.current)),[b,i]);const se=t=>{k(t.tracking_id),T(t.tracking_id)};return e.createElement(q,{className:"shadow-sm border-0"},e.createElement(U,{className:"bg-primary text-white"},e.createElement("h5",{className:"mb-0"},"ðŸšš Shipments & Delivery Tracking")),e.createElement(G,null,e.createElement(j,{className:"mb-3 gap-3"},e.createElement(d,{md:4},e.createElement(W,{placeholder:"Search by Tracking ID",value:te,onChange:t=>le(t.target.value)})),e.createElement(d,{md:3},e.createElement(Y,{value:Z,onChange:t=>re(t.target.value)},e.createElement("option",{value:"All"},"All"),e.createElement("option",{value:"Pending"},"Pending"),e.createElement("option",{value:"In Transit"},"In Transit"),e.createElement("option",{value:"Delivered"},"Delivered"),e.createElement("option",{value:"Delayed"},"Delayed")))),e.createElement(fe,{hover:!0,responsive:!0},e.createElement(he,null,e.createElement($,null,e.createElement(p,null,"Tracking ID"),e.createElement(p,null,"Status"),e.createElement(p,null,"Consignee"),e.createElement(p,null,"Driver"),e.createElement(p,null,"Action"))),e.createElement(Ce,null,X.map(t=>{var r,l,a;return e.createElement($,{key:t._id},e.createElement(E,null,t.tracking_id),e.createElement(E,null,((r=t.delivery)==null?void 0:r.status)||"N/A"),e.createElement(E,null,((l=t.consignee)==null?void 0:l.consignee_company_name)||"N/A"),e.createElement(E,null,((a=t.vehicle)==null?void 0:a.driver_name)||"N/A"),e.createElement(E,null,e.createElement(K,{size:"sm",color:"primary",onClick:()=>se(t)},"View")))}))),e.createElement(q,{className:"mt-4"},e.createElement(U,null,e.createElement("h6",null,"ðŸ“¦ Delivery Tracking")),e.createElement(G,null,I&&e.createElement(ve,{color:"danger"},I),e.createElement(j,{className:"mb-3"},e.createElement(d,{md:8},e.createElement(W,{placeholder:"Enter Tracking Number",value:i,onChange:t=>k(t.target.value)})),e.createElement(d,{md:2},e.createElement(K,{color:"primary",disabled:A,onClick:()=>T(i)},A?e.createElement(ie,{size:"sm"}):"Track")),e.createElement(d,{md:2},e.createElement(Y,{value:b?"On":"Off",onChange:t=>ae(t.target.value==="On")},e.createElement("option",{value:"Off"},"Auto Refresh Off"),e.createElement("option",{value:"On"},"Auto Refresh On")))),m&&e.createElement("div",null,e.createElement("p",null,e.createElement("strong",null,"Status:")," ",e.createElement(Se,{color:_e(m.status)},m.status)),e.createElement("p",null,e.createElement("strong",null,"Estimated Arrival:")," ",m.estimatedArrival),e.createElement("p",null,e.createElement("strong",null,"Current Location:")," ",m.currentLocation)),c&&e.createElement(me,{center:[c.lat,c.lng],zoom:13,style:{height:"300px",width:"100%"}},e.createElement(Q,{center:[c.lat,c.lng]}),e.createElement(ue,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.createElement(de,{position:[c.lat,c.lng]},e.createElement(pe,null,e.createElement("div",null,e.createElement("strong",null,"Shipment Info"),e.createElement("br",null),"Tracking #: ",i,e.createElement("br",null),"Consignee: ",((L=S==null?void 0:S.consignee)==null?void 0:L.consignee_company_name)||"N/A",e.createElement("br",null),"Vehicle: ",(y==null?void 0:y.plate_number)||"N/A"))))))))};Q.propTypes={center:z.arrayOf(z.number).isRequired};export{qe as default};
