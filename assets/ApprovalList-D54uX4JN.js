import{i as S,r,R as e,C as y}from"./index-CBDYk9Ao.js";import{a as u}from"./index-C88pvD_q.js";import{C as T,a as k}from"./CCardBody-E11mcyvL.js";import{C as M}from"./CCardHeader-BshgPxRz.js";import{C as _,a as A,b as d,c as s,d as B,e as l}from"./CTable-Di3XAasM.js";import{b as m}from"./CContainer-BVTxmlXV.js";import{C as $,a as w,b as x,c as F}from"./CModalHeader-BKFu_ZhO.js";import{C as H}from"./CFormTextarea-Cq-VIqwu.js";import"./CCloseButton-DIWbhS5b.js";import"./CNavItem-BCds_oRM.js";import"./CFormControlWrapper-BjTevJ5s.js";const p="https://backend-log2.axleshift.com/api/v1/procurement",Q=()=>{S();const[n,i]=r.useState([]),[R,g]=r.useState(!0),[C,o]=r.useState(!1),[j,c]=r.useState(!1),[E,v]=r.useState(null),[f,h]=r.useState("");r.useEffect(()=>{(async()=>{try{const a=await u.get(`${p}?status=Pending`);i(a.data)}catch(a){console.error("Error fetching procurements:",a)}finally{g(!1)}})()},[]);const b=async t=>{try{o(!0),await u.patch(`${p}/${t}/approve`),i(n.filter(a=>a._id!==t))}catch{alert("Failed to approve procurement")}finally{o(!1)}},P=async()=>{if(!f.trim()){alert("Please provide a rejection reason.");return}try{o(!0),await u.patch(`${p}/${E}/reject`,{rejectionReason}),i(n.filter(t=>t._id!==E)),c(!1),h("")}catch(t){console.error("Failed to reject procurement:",t),alert("Failed to reject procurement")}finally{o(!1)}};return R?e.createElement(y,{color:"primary"}):e.createElement(T,null,e.createElement(M,null,e.createElement("h5",null,"Approval List")),e.createElement(k,null,e.createElement(_,{hover:!0,responsive:!0},e.createElement(A,null,e.createElement(d,null,e.createElement(s,null,"Title"),e.createElement(s,null,"Department"),e.createElement(s,null,"Requested By"),e.createElement(s,null,"Actions"))),e.createElement(B,null,n.length>0?n.map(t=>{var a;return e.createElement(d,{key:t._id},e.createElement(l,null,t.title),e.createElement(l,null,t.department),e.createElement(l,null,((a=t.requestedBy)==null?void 0:a.email)||"Unknown"),e.createElement(l,null,e.createElement(m,{color:"success",className:"me-2",onClick:()=>b(t._id),disabled:C},C?e.createElement(y,{size:"sm"}):"Approve"),e.createElement(m,{color:"danger",onClick:()=>{v(t._id),c(!0)}},"Reject")))}):e.createElement(d,null,e.createElement(l,{colSpan:"4"},"No pending Procurement Request."))))),e.createElement($,{visible:j,onClose:()=>c(!1)},e.createElement(w,null,"Reject Procurement"),e.createElement(x,null,e.createElement(H,{placeholder:"Enter rejection reason...",value:f,onChange:t=>h(t.target.value)})),e.createElement(F,null,e.createElement(m,{color:"secondary",onClick:()=>c(!1)},"Cancel"),e.createElement(m,{color:"danger",onClick:P},"Confirm Reject"))))};export{Q as default};
