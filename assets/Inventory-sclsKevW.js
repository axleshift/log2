import{u as ne,r as n,R as e,C as le}from"./index-Czk1en48.js";import{a as m}from"./index-xsH4HHeE.js";import{C as se,a as oe}from"./CCardBody-Fly4LOGC.js";import{C as ce}from"./CCardHeader-DYgh3k3A.js";import{C as ue,a as me}from"./CInputGroupText-DoEgWi_L.js";import{a as f,C as c}from"./CFormInput-BMJoeGH4.js";import{c as i}from"./CRow-COWDqcej.js";import{e as ie,f as de,g as _,h as d,j as he,k as u,l as L,m as U,p as B,n as F,o as M}from"./CTable-D_U4Alk1.js";import{C as W}from"./CFormCheck-C2gFnly9.js";import{C as pe}from"./CForm-DpxG6y2y.js";import{C as S}from"./CFormSelect-DbfrKTkb.js";import"./CCloseButton-jv1sHiMY.js";const A="https://backend-log2.axleshift.com",w=`${A}/api/v1/inventory`,Ee=`${A}/api/v1/shipment`,ye=`${A}/api/v1/product`,Ce="https://backend-log1.axleshift.com/api/v1/warehouseLoc/locations",qe=()=>{const{accessToken:h}=ne(),[O,N]=n.useState(!1),[p,k]=n.useState(new Set),[g,z]=n.useState([]),[P,H]=n.useState([]),[q,j]=n.useState([]),[x,Q]=n.useState([]),[b,V]=n.useState(""),[K,D]=n.useState(!1),[T,o]=n.useState(""),[G,E]=n.useState(!1),[Y,y]=n.useState(!1),[r,s]=n.useState({shipment:"",warehouse_id:"",product:"",sku:"",quantity:"",stock_level:"",status:"In Stock"});n.useEffect(()=>{C(),J(),X(),Z();const t=setInterval(()=>{C()},3e4);return()=>clearInterval(t)},[]);const C=async()=>{D(!0);try{const t=await m.get(w,{headers:{Authorization:`Bearer ${h}`}});z(Array.isArray(t.data)?t.data:[])}catch{o("Error fetching inventory data.")}finally{D(!1)}},J=async()=>{var t;try{const a=await m.get(Ee,{headers:{Authorization:`Bearer ${h}`}});console.log("Shipments fetched:",a.data),H(((t=a.data)==null?void 0:t.shipments)||[])}catch(a){console.error("Failed to fetch shipments",a)}},X=async()=>{try{const t=await m.get(ye,{headers:{Authorization:`Bearer ${h}`}});j(t.data||[])}catch{console.error("Failed to fetch products")}},Z=async()=>{var t;try{const a=await m.get(Ce,{headers:{"Content-Type":"application/json","x-api-key":"0ad3f5c013c42d2d0537672a260978c71dcd5a7d508019d748f991deee3d65665a477e3523c6bbc83fd6a51a71dd5003"}});Q(((t=a.data)==null?void 0:t.data)||[])}catch(a){console.error("Failed to fetch warehouses",a)}},R=n.useMemo(()=>g.filter(t=>{var a;return(((a=t.shipment)==null?void 0:a.tracking_id)||"").toLowerCase().includes(b.toLowerCase())}),[g,b]),ee=t=>{const a=t.target.checked;N(a),k(a?new Set(g.map(l=>l._id)):new Set)},te=(t,a)=>{const l=new Set(p);t.target.checked?l.add(a):l.delete(a),k(l)},ae=async()=>{if(!p.size)return o("Please select items to delete.");try{await Promise.all(Array.from(p).map(t=>m.delete(`${w}/${t}`,{headers:{Authorization:`Bearer ${h}`}}))),o("Selected items deleted successfully."),k(new Set),N(!1),C()}catch{o("Error deleting selected items.")}finally{E(!1)}},re=async t=>{var v,$;t.preventDefault();const a=I=>/^[a-f\d]{24}$/i.test(I);if(!a(r.shipment)||!a(r.product)||!a(r.warehouse_id))return o("Shipment, Product, and Warehouse must be valid ObjectIDs.");const l={...r,quantity:Number(r.quantity),stock_level:Number(r.stock_level)};try{await m.post(w,l,{headers:{Authorization:`Bearer ${h}`}}),o("New inventory item created."),s({shipment:"",warehouse_id:"",product:"",sku:"",quantity:"",stock_level:"",status:"In Stock"}),y(!1),C()}catch(I){o((($=(v=I.response)==null?void 0:v.data)==null?void 0:$.error)||"Failed to create item.")}};return e.createElement(se,null,e.createElement(ce,{className:"text-center py-3"},"Warehouse Inventory"),e.createElement(oe,null,T&&e.createElement("div",{className:"alert alert-info"},T),e.createElement("div",{className:"d-flex justify-content-between align-items-center mb-4"},e.createElement(ue,{style:{maxWidth:"400px"}},e.createElement(me,null,"Search"),e.createElement(f,{type:"text",placeholder:"Search by Tracking ID",value:b,onChange:t=>V(t.target.value)})),e.createElement("div",{className:"d-flex gap-2"},e.createElement(i,{color:"success",onClick:()=>{const l=`${`In-${Date.now()}`}-SKU`;s(v=>({...v,sku:l})),y(!0)}},"+ New Item"),e.createElement(i,{color:"danger",onClick:()=>E(!0)},"Delete"))),K?e.createElement("div",{className:"text-center py-5"},e.createElement(le,{color:"primary"})):e.createElement(ie,{striped:!0,hover:!0,responsive:!0},e.createElement(de,null,e.createElement(_,null,e.createElement(d,null,e.createElement(W,{checked:O,onChange:ee})),e.createElement(d,null,"Tracking ID"),e.createElement(d,null,"Product"),e.createElement(d,null,"SKU"),e.createElement(d,null,"Quantity"),e.createElement(d,null,"Stock Level"))),e.createElement(he,null,R.length>0?R.map(t=>{var a;return e.createElement(_,{key:t._id},e.createElement(u,null,e.createElement(W,{checked:p.has(t._id),onChange:l=>te(l,t._id)})),e.createElement(u,null,t.shipment?t.shipment.tracking_id:"N/A"),e.createElement(u,null,((a=t.product)==null?void 0:a.name)||"N/A"),e.createElement(u,null,t.sku),e.createElement(u,null,t.quantity),e.createElement(u,null,t.stock_level))}):e.createElement(_,null,e.createElement(u,{colSpan:"6",className:"text-center"},"No inventory records found."))))),e.createElement(L,{visible:Y,onClose:()=>y(!1)},e.createElement(U,null,e.createElement(B,null,"New Inventory Item")),e.createElement(pe,{onSubmit:re},e.createElement(F,null,e.createElement("div",{className:"mb-3"},e.createElement(c,null,"Shipment"),e.createElement(S,{value:r.shipment,onChange:t=>s({...r,shipment:t.target.value}),required:!0},e.createElement("option",{value:""},"Select Shipment"),Array.isArray(P)&&P.map(t=>e.createElement("option",{key:t._id,value:t._id},t.tracking_id||"Unnamed Shipment")))),e.createElement("div",{className:"mb-3"},e.createElement(c,null,"Product"),e.createElement(S,{value:r.product,onChange:t=>s({...r,product:t.target.value}),required:!0},e.createElement("option",{value:""},"Select Product"),Array.isArray(q)&&q.map(t=>e.createElement("option",{key:t._id,value:t._id},t.name||"Unnamed Product")))),e.createElement("div",{className:"mb-3"},e.createElement(c,null,"Warehouse"),e.createElement(S,{value:r.warehouse_id,onChange:t=>s({...r,warehouse_id:t.target.value}),required:!0},e.createElement("option",{value:""},"Select Warehouse"),Array.isArray(x)&&x.map(t=>e.createElement("option",{key:t._id,value:t._id},t.warehouseName," - ",t.address," ")))),e.createElement("div",{className:"mb-3"},e.createElement(c,null,"SKU"),e.createElement(f,{value:r.sku,onChange:t=>s({...r,sku:t.target.value}),required:!0})),e.createElement("div",{className:"mb-3"},e.createElement(c,null,"Quantity"),e.createElement(f,{type:"number",value:r.quantity,onChange:t=>s({...r,quantity:t.target.value}),required:!0})),e.createElement("div",{className:"mb-3"},e.createElement(c,null,"Stock Level"),e.createElement(f,{type:"number",value:r.stock_level,onChange:t=>s({...r,stock_level:t.target.value}),required:!0})),e.createElement("div",{className:`
              mb-3`},e.createElement(c,null,"Status"),e.createElement(S,{value:r.status,onChange:t=>s({...r,status:t.target.value})},e.createElement("option",{value:"In Stock"},"In Stock"),e.createElement("option",{value:"Out of Stock"},"Out of Stock")))),e.createElement(M,null,e.createElement(i,{color:"secondary",onClick:()=>y(!1)},"Cancel"),e.createElement(i,{color:"primary",type:"submit"},"Create")))),e.createElement(L,{visible:G,onClose:()=>E(!1)},e.createElement(U,null,e.createElement(B,null,"Confirm Deletion")),e.createElement(F,null,"Are you sure you want to delete selected inventory items?"),e.createElement(M,null,e.createElement(i,{color:"secondary",onClick:()=>E(!1)},"Cancel"),e.createElement(i,{color:"danger",onClick:ae},"Delete"))))};export{qe as default};
